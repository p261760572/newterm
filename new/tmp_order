db_dfunc.pc:       FROM MSG_KEY WHERE MSG_TYPE = :pub_data_stru->in_msg_type;
db_dfunc.pc:		dcs_log(0, 0, "at %s(%s:%d) sqlcode=%d, select msg_key error !\n msg_type=[%s]",__FUNCTION__,__FILE__,__LINE__, sqlca.sqlcode, pub_data_stru->in_msg_type);
db_dfunc.pc:    if(0 > pack_key(pub_data_stru->timeout_table.key, sizeof(pub_data_stru->timeout_table.key), field_id_set, pub_data_stru, pub_data_stru->in_msg_type, 0, 0))
db_dfunc.pc:    WHERE KEY = :pub_data_stru->timeout_table.key FOR UPDATE;
db_dfunc.pc:		dcs_log(0, 0, "at %s(%s:%d) sqlcode=%d, SELECT TRANSTIMEOUT Error. key[%s]",__FUNCTION__,__FILE__,__LINE__, sqlca.sqlcode, pub_data_stru->timeout_table.key);
db_dfunc.pc:    memcpy(&pub_data_stru->timeout_table, &timeout_table, sizeof(timeout_stru));
db_dfunc.pc:    snprintf(pub_data_stru->in_trans_type,5,"%s",pub_data_stru->timeout_table.trans_type);
db_dfunc.pc:    rtrim(pub_data_stru->timeout_table.key);
db_dfunc.pc:    EXEC SQL DELETE FROM TRANSTIMEOUT WHERE KEY = :pub_data_stru->timeout_table.key;
db_dfunc.pc:		dcs_log(0, 0, "at %s(%s:%d) sqlcode=%d, delete TRANSTIMEOUT Error. key[%s]",__FUNCTION__,__FILE__,__LINE__, sqlca.sqlcode, pub_data_stru->timeout_table.key);
db_ifunc.pc:        if(strcmp(pub_data_stru->in_msg_type,gl_db_iproc[i].name)==0)
db_ifunc.pc:		if(memcmp(pub_data_stru->in_trans_type, "0051", 4) == 0 || 
db_ifunc.pc:				memcmp(pub_data_stru->in_trans_type, "0003", 4) == 0) 
db_ifunc.pc:    WHERE (TRANS_TYPE = :pub_data_stru->in_trans_type or trans_type ='*') and ( in_msg_type='*' or in_msg_type= :pub_data_stru->in_msg_type)
db_ifunc.pc:        dcs_log(0, 0, "at %s(%s:%d) sqlcode=%d, OPEN TRANSLOG_SAVE_SET_CUR, in_msg_type=[%S] trans_type[%s] Error",__FUNCTION__,__FILE__,__LINE__, sqlca.sqlcode, pub_data_stru->in_msg_type, pub_data_stru->in_trans_type);
db_ifunc.pc:            dcs_log(0, 0, "at %s(%s:%d) sqlcode=%d, FETCH TRANSLOG_SAVE_SET_CUR, in_msg_type=[%S] trans_type[%s] Error",__FUNCTION__,__FILE__,__LINE__, sqlca.sqlcode, pub_data_stru->in_msg_type, pub_data_stru->in_trans_type);
db_ifunc.pc:            strcpy_s(msg_type, pub_data_stru->in_msg_type, sizeof(msg_type));
db_ifunc.pc:            strcpy_s(msg_type, pub_data_stru->route_msg_type, sizeof(msg_type));
db_ifunc.pc:    strcpy_s(translog.acq_insti_code, pub_data_stru->insti_code, sizeof(translog.acq_insti_code));
db_ifunc.pc:    SetTransLog(&translog, "ACQ_MSG_TYPE", pub_data_stru->in_msg_type, 0, pub_data_stru);
db_ifunc.pc:    SetTransLog(&translog, "ACQ_TRANS_TYPE", pub_data_stru->in_trans_type, 0, pub_data_stru);
db_ifunc.pc:    SetTransLog(&translog, "APP_TYPE", pub_data_stru->app_type, 0, pub_data_stru);
db_ifunc.pc:    if(pub_data_stru->step_type == 1) {
db_ifunc.pc:        SetTransLog(&translog, "PAY_MSG_TYPE", pub_data_stru->route_msg_type, 0, pub_data_stru);
db_ifunc.pc:        SetTransLog(&translog, "PAY_TRANS_TYPE", pub_data_stru->route_trans_type, 0, pub_data_stru);
db_ifunc.pc:    } else if(pub_data_stru->step_type == 2) {
db_ifunc.pc:        SetTransLog(&translog, "APP_MSG_TYPE", pub_data_stru->route_msg_type, 0, pub_data_stru);
db_ifunc.pc:        SetTransLog(&translog, "APP_TRANS_TYPE", pub_data_stru->route_trans_type, 0, pub_data_stru);
db_ifunc.pc:    SetTransLog(&translog, "RESP_CD_RCV", pub_data_stru->center_result_code, 0, pub_data_stru);
db_ifunc.pc:    sprintf(field_val, "%d", pub_data_stru->route_num);
db_ifunc.pc:    if(pub_data_stru->in_cry_flag) SetTransLog(&translog, "ACQ_CRY_TYPE","1", 0, pub_data_stru);
db_ifunc.pc://  if(pub_data_stru->timeout_table.flag[0] == '1' ||  pub_data_stru->timeout_table.flag[0] == '2')
db_ifunc.pc:    translog.permit_void[0]=pub_data_stru->permit_void;
db_ifunc.pc:              translog.permit_void,pub_data_stru->permit_void);
db_ifunc.pc:    if(0 > _get_field_data_safe(pub_data_stru, FIELD_MAC, pub_data_stru->in_msg_type, translog.acq_mac,0,17)) {
db_ifunc.pc:    memset(pub_data_stru->timeout_table.first_key, 0, sizeof(pub_data_stru->timeout_table.first_key));
db_ifunc.pc:    snprintf(pub_data_stru->timeout_table.first_key,sizeof(pub_data_stru->timeout_table.first_key), "%s,%s,%s,%s,%s,%s,%s",
db_ifunc.pc:             pub_data_stru->in_msg_type, translog.sys_date,translog.acq_insti_code,translog.acq_tra_no,translog.acq_date,translog.acq_term_id1,translog.acq_term_id2);
db_ifunc.pc:	timeout_stru *timeout_table = &pub_data_stru->timeout_table;
db_ifunc.pc:        FROM MSG_KEY WHERE MSG_TYPE = :pub_data_stru->route_msg_type;
db_ifunc.pc:			dcs_log(0, 0, "at %s(%s:%d) sqlcode=%d, select msg_key error !\n msg_type=[%s]",__FUNCTION__,__FILE__,__LINE__, sqlca.sqlcode, pub_data_stru->route_msg_type);
db_ifunc.pc:        if(0 > pack_key(timeout_table->key, sizeof(timeout_table->key), field_id_set, pub_data_stru, pub_data_stru->route_msg_type, 1, 0))
db_ifunc.pc:        timeout_table->invalid_time += pub_data_stru->timeout <= 0 ? SYS_TIME_OUT : pub_data_stru->timeout;
db_ifunc.pc:    strcpy_s(timeout_table->trans_type, pub_data_stru->route_trans_type, sizeof(timeout_table->trans_type));
db_ifunc.pc:    if(strcmp(pub_data_stru->center_result_code,"00") != 0) return 0;
db_ifunc.pc:    len=_get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type, buf,0,sizeof(buf));
db_ifunc.pc:    len=_get_field_data_safe(pub_data_stru, FIELD_TERM_ID2, pub_data_stru->in_msg_type,
db_ifunc.pc:    len=_get_field_data_safe(pub_data_stru, FIELD_TERM_ID1, pub_data_stru->in_msg_type,
db_ifunc.pc:    len=_get_field_data_safe(pub_data_stru, FIELD_TRA_NO, pub_data_stru->in_msg_type,
db_ifunc.pc:    len=_get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type,
db_qfunc.pc:             msg_type =:pub_data_stru->in_msg_type;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__, sqlca.sqlcode, pub_data_stru->in_msg_type);
db_qfunc.pc:             pub_data_stru->in_msg_type, 0, 0);
db_qfunc.pc:                   where msg_type= :pub_data_stru->in_msg_type and app_key=:tmp_buf2;
db_qfunc.pc:                    __FUNCTION__,__FILE__,__LINE__, sqlca.sqlcode, pub_data_stru->in_msg_type,tmp_buf2);
db_qfunc.pc:        strcpy_s(pub_data_stru->app_type, app_type, sizeof(pub_data_stru->app_type));
db_qfunc.pc:        strcpy_s(pub_data_stru->in_trans_type, trans_type, sizeof(pub_data_stru->in_trans_type));
db_qfunc.pc:        pub_data_stru->open_flag=open_flag[0]-0x30;     //业务是否打开
db_qfunc.pc:        pub_data_stru->permit_void=permit_void[0]; //该业务是否允许冲正
db_qfunc.pc:                  __FUNCTION__,__FILE__,__LINE__,pub_data_stru->in_msg_type,app_type,trans_type, permit_void[0]);
db_qfunc.pc:    if(0 > _get_field_data_safe(pub_data_stru, FIELD_RECODE, pub_data_stru->in_msg_type,
db_qfunc.pc:    if(0 > E2E(pub_data_stru->insti_code, acq_code, pub_data_stru->center_result_code, 5)) return -1;
db_qfunc.pc:    EXEC SQL SELECT PROC_NAME INTO :proc_name FROM END_PROC WHERE MSG_TYPE = :pub_data_stru->in_msg_type and TRANS_TYPE = :pub_data_stru->in_trans_type;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__, sqlca.sqlcode, pub_data_stru->in_msg_type,pub_data_stru->in_trans_type);
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__, sqlca.sqlcode, pub_data_stru->in_msg_type,pub_data_stru->in_trans_type);
db_qfunc.pc:            dcs_debug(0, 0, "at %s(%s:%d) trans_type=[%s]",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->in_trans_type);
db_qfunc.pc:    strcpy_s(tmsg_type,pub_data_stru->in_msg_type,sizeof(tmsg_type));
db_qfunc.pc:    strcpy_s(ttrans_type,pub_data_stru->in_trans_type,sizeof(ttrans_type));
db_qfunc.pc:    strcpy_s(tapp_type,pub_data_stru->app_type,sizeof(tapp_type));
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__, sqlca.sqlcode, pub_data_stru->in_msg_type, pub_data_stru->app_type, pub_data_stru->in_trans_type);
db_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code, CODE_SYSTEM_ERR, sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:                    __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->in_msg_type, pub_data_stru->app_type, pub_data_stru->in_trans_type);
db_qfunc.pc:            strcpy_s(pub_data_stru->center_result_code, CODE_SYSTEM_ERR, sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:         from insti_info where insti_code = :pub_data_stru->insti_code;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->insti_code);
db_qfunc.pc:    strcpy_s(pub_data_stru->in_mac_index,mac_index,sizeof(pub_data_stru->in_mac_index));
db_qfunc.pc:    strcpy_s(pub_data_stru->in_mac_key,mac_key,sizeof(pub_data_stru->in_mac_key));
db_qfunc.pc:    strcpy_s(pub_data_stru->in_pin_index,pin_index,sizeof(pub_data_stru->in_pin_index));
db_qfunc.pc:    strcpy_s(pub_data_stru->in_pin_key,pin_key,sizeof(pub_data_stru->in_pin_key));
db_qfunc.pc:    strcpy_s(pub_data_stru->in_data_index,data_index,sizeof(pub_data_stru->in_data_index));
db_qfunc.pc:    strcpy_s(pub_data_stru->in_data_key,data_key,sizeof(pub_data_stru->in_data_key));
db_qfunc.pc:    pub_data_stru->is_check_mac=is_check_mac[0]-0x30;
db_qfunc.pc:    pub_data_stru->insti_open_flag=open_flag[0]-0x30;
db_qfunc.pc:    pub_data_stru->insti_work_type=work_type[0]-0x30;
db_qfunc.pc:    pub_data_stru->insti_link_type=link_type[0]-0x30;
db_qfunc.pc:        where msg_type= :pub_data_stru->in_msg_type;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->in_msg_type);
db_qfunc.pc:        pub_data_stru->filed_key_num++;
db_qfunc.pc:        if(pub_data_stru->filed_key_num >5) {
db_qfunc.pc:        id=get_pub_field_id(pub_data_stru->in_msg_type,tmp);
db_qfunc.pc:        pub_data_stru->filed_key_field_id[pub_data_stru->filed_key_num]=id;
db_qfunc.pc:        n=get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,tmp,sizeof(tmp));
db_qfunc.pc:        snprintf(pub_data_stru->msg_key+offset,60-offset,"%s",tmp);
db_qfunc.pc:    exec sql select out_trans_type ,step_type, timeout_flag, TIMEOUT into :out_trans_type, :step_type, :timeout_flag, :timeout from trans_from_code where app_type=:pub_data_stru->app_type
db_qfunc.pc:              and step =:pub_data_stru->route_num and insti_code = :pub_data_stru->route_insti_code;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->app_type, pub_data_stru->route_num, pub_data_stru->route_insti_code);
db_qfunc.pc:    strcpy_s(pub_data_stru->route_trans_type, out_trans_type, sizeof(pub_data_stru->route_trans_type));
db_qfunc.pc:    strcpy_s(pub_data_stru->timeout_table.flag, timeout_flag, sizeof(pub_data_stru->timeout_table.flag));
db_qfunc.pc:    pub_data_stru->timeout = timeout;
db_qfunc.pc:    pub_data_stru->step_type=step_type;//判断是支付渠道，还是应用渠道
db_qfunc.pc:        where msg_type = :pub_data_stru->route_msg_type and app_type=:pub_data_stru->app_type
db_qfunc.pc:          and step =:pub_data_stru->route_num;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->app_type, pub_data_stru->route_num, pub_data_stru->route_msg_type);
db_qfunc.pc:    strcpy_s(pub_data_stru->route_trans_type, out_trans_type, sizeof(pub_data_stru->route_trans_type));
db_qfunc.pc:    strcpy_s(pub_data_stru->timeout_table.flag, timeout_flag, sizeof(pub_data_stru->timeout_table.flag));
db_qfunc.pc:    pub_data_stru->timeout = timeout;
db_qfunc.pc:    pub_data_stru->step_type=step_type;//判断是支付渠道，还是应用渠道
db_qfunc.pc:       WHERE APP_TYPE = :pub_data_stru->app_type AND STEP = :pub_data_stru->route_num;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->app_type, pub_data_stru->route_num);
db_qfunc.pc:            strcpy_s(pub_data_stru->route_insti_code, insti_code, sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:                    strcpy_s(pub_data_stru->route_insti_code, insti_code_bak, sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:            strcpy_s(pub_data_stru->route_insti_code, insti_code_bak, sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:                    strcpy_s(pub_data_stru->route_insti_code, insti_code, sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:            if(!pub_data_stru->req_flag) {
db_qfunc.pc:                                     DB_MSG_TYPE, pub_data_stru->route_insti_code, 2,9);
db_qfunc.pc:                                     DB_MSG_TYPE, pub_data_stru->route_trans_type, 2,5);
db_qfunc.pc:                strcpy_s(pub_data_stru->route_insti_code, pub_data_stru->insti_code, sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:                strcpy_s(pub_data_stru->route_trans_type, pub_data_stru->in_trans_type, sizeof(pub_data_stru->route_trans_type));
db_qfunc.pc:            pub_data_stru->switch_src_flag=1;
db_qfunc.pc:            strcpy_s(pub_data_stru->route_insti_code, insti_code, sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:                    strcpy_s(pub_data_stru->route_insti_code, insti_code_bak, sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:            strcpy_s(pub_data_stru->route_insti_code, insti_code_bak, sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:                    strcpy_s(pub_data_stru->route_insti_code, insti_code, sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:    EXEC SQL SELECT route_field_name INTO :route_field_name FROM ROUTE_STEP_FIELD WHERE APP_TYPE = :pub_data_stru->app_type AND STEP =  :pub_data_stru->route_num;
db_qfunc.pc:        get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, route_no,20);
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->app_type, pub_data_stru->route_num);
db_qfunc.pc:    if(pub_data_stru->req_flag)
db_qfunc.pc:        return get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, route_field_name),
db_qfunc.pc:                                   pub_data_stru->in_msg_type, route_no,20);
db_qfunc.pc:    if(0>=get_field_data_safe(pub_data_stru, FIELD_TERM_ID1, pub_data_stru->in_msg_type, term_id1,17))
db_qfunc.pc:        get_field_data_safe(pub_data_stru, FIELD_PSAM_NO, pub_data_stru->in_msg_type, term_id1,17);
db_qfunc.pc:    EXEC SQL SELECT TERM_CLASS INTO :term_class FROM TERM_ROUTE_CLASS WHERE TERM_ID1= :term_id1 AND APP_TYPE = :pub_data_stru->app_type;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, term_id1,pub_data_stru->app_type);
db_qfunc.pc:            strcpy_s(pub_data_stru->route_insti_code, insti_code,sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:                    strcpy_s(pub_data_stru->route_insti_code, insti_code_bak,sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:            strcpy_s(pub_data_stru->route_insti_code, insti_code_bak,sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:                    strcpy_s(pub_data_stru->route_insti_code, insti_code,sizeof(pub_data_stru->route_insti_code));
db_qfunc.pc:    if(strcmp(pub_data_stru->route_msg_type,"TPOS") ==0) {
db_qfunc.pc:        dcs_debug(0,0,"at %s(%s:%d), center ret_code=%s",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->center_result_code);
db_qfunc.pc:        if(memcmp(pub_data_stru->center_result_code,"00000",strlen(pub_data_stru->center_result_code))==0)
db_qfunc.pc:        WHERE MSG_TYPE = :pub_data_stru->route_msg_type AND trans_type=:pub_data_stru->route_trans_type AND flag =:c;
db_qfunc.pc:        WHERE MSG_TYPE = :pub_data_stru->route_msg_type AND trans_type=:pub_data_stru->route_trans_type AND STEP = :pub_data_stru->route_num;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->route_msg_type, pub_data_stru->route_trans_type, pub_data_stru->route_num);
db_qfunc.pc:        pub_data_stru->route_set.field.field_id[i] = get_pub_field_id(pub_data_stru->route_msg_type,tmp);
db_qfunc.pc:        if(pub_data_stru->route_set.field.field_id[i] <0) {
db_qfunc.pc:                    __FUNCTION__,__FILE__,__LINE__,pub_data_stru->route_msg_type, tmp);
db_qfunc.pc:        snprintf(pub_data_stru->route_set.field.field_name[i],sizeof(pub_data_stru->route_set.field.field_name[i]),"%s",tmp);
db_qfunc.pc:        pub_data_stru->route_set.field.from[i] = 1;
db_qfunc.pc:        //pub_data_stru->route_set.field.indx[i] = i;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,pub_data_stru->route_msg_type, pub_data_stru->route_trans_type);
db_qfunc.pc:    pub_data_stru->route_set.num = i;
db_qfunc.pc:        field_id= get_pub_field_id(pub_data_stru->route_msg_type,tmp);
db_qfunc.pc:                    __FUNCTION__,__FILE__,__LINE__,pub_data_stru->route_msg_type, tmp);
db_qfunc.pc:        for(j = 0; j < pub_data_stru->route_set.num; j++) {
db_qfunc.pc:            if(pub_data_stru->route_set.field.field_id[j] == field_id &&
db_qfunc.pc:               strcmp(pub_data_stru->route_set.field.field_name[j],tmp)==0) {
db_qfunc.pc:                //pub_data_stru->route_set.field.from[j] = 0;
db_qfunc.pc:                n = _get_field_data_safe(pub_data_stru,field_id, pub_data_stru->in_msg_type,
db_qfunc.pc:                add_pub_field(pub_data_stru,field_id,pub_data_stru->route_msg_type,n,tmp, 1);
db_qfunc.pc:        if(j >= pub_data_stru->route_set.num) {
db_qfunc.pc:    if(strcmp(pub_data_stru->route_msg_type,"TPOS") ==0) {
db_qfunc.pc:        if(0>=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"FUNC_CODE"),
db_qfunc.pc:                                  pub_data_stru->route_msg_type,tmp,sizeof(tmp)))
db_qfunc.pc:            add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"FUNC_CODE"),
db_qfunc.pc:                          pub_data_stru->route_msg_type, strlen(field_db),field_db,1);
db_qfunc.pc:            update_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"FUNC_CODE"),
db_qfunc.pc:                             pub_data_stru->route_msg_type, strlen(field_db),field_db,1);
db_qfunc.pc:    dcs_debug(0,0,"at %s(%s:%d), work_type=%d ,is_check_mac=%d",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->route_insti_work_type,pub_data_stru->route_is_check_mac);
db_qfunc.pc:    if(pub_data_stru->req_flag!=1 && pub_data_stru->route_is_check_mac && pub_data_stru->route_insti_work_type) { //获取终端模式密钥
db_qfunc.pc:            if(strcmp(pub_data_stru->route_msg_type,gl_terminfo_qproc[i].name)==0)
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,pub_data_stru->route_msg_type);
db_qfunc.pc:    } else if(pub_data_stru->req_flag ==1 && pub_data_stru->switch_src_flag==1 && pub_data_stru->route_insti_work_type) {
db_qfunc.pc:        dcs_debug(0,0,"at %s(%s:%d), tmp_order[0]=%02x",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->tmp_order[0]);
db_qfunc.pc:        if(pub_data_stru->tmp_order[0]!= 0x31) { //请求报文直接应答获取终端密钥方式
db_qfunc.pc:            memcpy(pub_data_stru->route_mac_index,pub_data_stru->in_mac_index,6);
db_qfunc.pc:            memcpy(pub_data_stru->route_mac_key,pub_data_stru->in_mac_key,33);
db_qfunc.pc:            dcs_debug(0,0,"at %s(%s:%d), route_mac_key=%s",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->route_mac_key);
db_qfunc.pc:                if(strcmp(pub_data_stru->route_msg_type,gl_terminfo_qproc[i].name)==0)
db_qfunc.pc:            dcs_log(0,0,"at %s(%s:%d), can not found terminfo proc msg_type=%s",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->route_msg_type);
db_qfunc.pc:               where msg_type= :pub_data_stru->in_msg_type;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->in_msg_type);
db_qfunc.pc:        n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,tmp),
db_qfunc.pc:                              pub_data_stru->in_msg_type,tmp,sizeof(tmp));
db_qfunc.pc:              msg_type= :pub_data_stru->in_msg_type and key=:str;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->in_msg_type,str);
db_qfunc.pc:        pub_data_stru->req_flag=1;
db_qfunc.pc:    strcpy_s(tapp_type,pub_data_stru->app_type,sizeof(tapp_type));
db_qfunc.pc:    strcpy_s(tmsg_type,pub_data_stru->in_msg_type,sizeof(tmsg_type));
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->in_msg_type,pub_data_stru->app_type);
db_qfunc.pc:                    __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->in_msg_type,pub_data_stru->app_type);
db_qfunc.pc:       WHERE MSG_TYPE = :pub_data_stru->route_msg_type AND TRANS_TYPE = :trans_type AND FIELD_NAME = :para;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->route_msg_type, trans_type, para);
db_qfunc.pc:    add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type, strlen(data), data, 1);
db_qfunc.pc:    if(pub_data_stru->is_route == 3)  //使用原始交易路由节点
db_qfunc.pc:       WHERE APP_TYPE = :pub_data_stru->app_type and STEP = :pub_data_stru->route_num;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->app_type, pub_data_stru->route_num);
db_qfunc.pc:    WHERE IN_MSG_TYPE = :pub_data_stru->in_msg_type and out_MSG_TYPE = :pub_data_stru->route_msg_type;
db_qfunc.pc:        WHERE IN_MSG_TYPE = :pub_data_stru->in_msg_type and out_MSG_TYPE = '*';
db_qfunc.pc:            WHERE OUT_MSG_TYPE = :pub_data_stru->route_msg_type and IN_MSG_TYPE = '*';
db_qfunc.pc:                    dcs_log(0, 0, "at %s(%s:%d) sqlcode=%d, select GENRATE_FIELD_CONVER, Error(*,*)route_msg=[%s],in_msg=[%s]",__FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->route_msg_type, pub_data_stru->in_msg_type);
db_qfunc.pc:                    __FUNCTION__,__FILE__,__LINE__,pub_data_stru->route_msg_type, pub_data_stru->route_trans_type, field_name);
db_qfunc.pc:    dcs_debug(0, 0, "at %s(%s:%d), msg_type[%s], trans_type[%s]",__FUNCTION__,__FILE__,__LINE__, pub_data_stru->route_msg_type, pub_data_stru->route_trans_type);
db_qfunc.pc:    WHERE MSG_TYPE=:pub_data_stru->route_msg_type AND (IN_MSG_TYPE=:pub_data_stru->in_msg_type  or IN_MSG_TYPE='*') AND
db_qfunc.pc:       (TRANS_TYPE = :pub_data_stru->route_trans_type or TRANS_TYPE ='*' ) order by seq;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->route_msg_type, pub_data_stru->route_trans_type);
db_qfunc.pc:                    __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->route_msg_type, pub_data_stru->route_trans_type);
db_qfunc.pc:        if(0 > (fldid = get_pub_field_id(pub_data_stru->route_msg_type, field_name))) {
db_qfunc.pc:                    __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->route_msg_type, field_name);
db_qfunc.pc:    WHERE APP_TYPE = :pub_data_stru->app_type AND STEP = :pub_data_stru->route_num;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->app_type, pub_data_stru->route_num);
db_qfunc.pc:                    __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->app_type, pub_data_stru->route_num);
db_qfunc.pc:    WHERE /*IN_ADD_DATA = :in_add_data AND */ ROUTE_TRANS_TYPE = :pub_data_stru->route_trans_type AND ROUTE_INSTI_CODE = :pub_data_stru->route_insti_code and app_type = :pub_data_stru->app_type;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->app_type, pub_data_stru->route_trans_type, pub_data_stru->route_insti_code);
db_qfunc.pc:        add_pub_field(pub_data_stru, FIELD_TERM_ID1, pub_data_stru->route_msg_type, l, term_id1, 1);
db_qfunc.pc:        add_pub_field(pub_data_stru, FIELD_TERM_ID2, pub_data_stru->route_msg_type, l, term_id2, 1);
db_qfunc.pc:    if(pub_data_stru->route_num > 0) {
db_qfunc.pc:        if(0>=get_field_data_safe(pub_data_stru, FIELD_TERM_ID1, pub_data_stru->in_msg_type,
db_qfunc.pc:            get_field_data_safe(pub_data_stru, 20, pub_data_stru->in_msg_type, in_term_id1,17);
db_qfunc.pc:        get_field_data_safe(pub_data_stru, FIELD_TERM_ID2, pub_data_stru->in_msg_type, in_term_id2,sizeof(in_term_id2));
db_qfunc.pc:         WHERE ROUTE_TRANS_TYPE = :para AND ROUTE_INSTI_CODE = :pub_data_stru->route_insti_code AND IN_TERM_ID1 = :in_term_id1 AND IN_TERM_ID2 = :in_term_id2;
db_qfunc.pc:        WHERE ROUTE_TRANS_TYPE = :pub_data_stru->route_trans_type AND ROUTE_INSTI_CODE = :pub_data_stru->route_insti_code AND IN_TERM_ID1 = :in_term_id1 AND IN_TERM_ID2 = :in_term_id2;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->route_trans_type, pub_data_stru->route_insti_code, in_term_id1, in_term_id2);
db_qfunc.pc:        add_pub_field(pub_data_stru, FIELD_TERM_ID1, pub_data_stru->route_msg_type, l, term_id1, 1);
db_qfunc.pc:        add_pub_field(pub_data_stru, FIELD_TERM_ID2, pub_data_stru->route_msg_type, l, term_id2, 1);
db_qfunc.pc:              term_id1,pub_data_stru->route_msg_type);
db_qfunc.pc:        memcpy(pub_data_stru->route_trans_type,t_out_add_data,4);
db_qfunc.pc:    snprintf(insti_code,9,"%s", flag ? pub_data_stru->route_insti_code : pub_data_stru->insti_code);
db_qfunc.pc:    WHERE  INSTI_CODE= :pub_data_stru->route_insti_code;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->route_insti_code);
db_qfunc.pc:    memcpy(tmp,pub_data_stru->route_insti_code,8);
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->route_insti_code);
db_qfunc.pc:    add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type, seqlen, seqStr, 1);
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->route_insti_code);
db_qfunc.pc:    add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type, seqlen, refStr, 1);
db_qfunc.pc:    strcpy_s(tmp,pub_data_stru->in_msg_type,sizeof(tmp));
db_qfunc.pc:        dcs_log(0, 0, "at %s(%s:%d) sqlcode=%d, SELECT APP_TYPE_DEF Error,MSG_TYPE[%s]",__FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->in_msg_type);
db_qfunc.pc:    if(0 > pack_key(keyBuf, sizeof(keyBuf), key_id, pub_data_stru, pub_data_stru->in_msg_type, 0, 0)) return -1;
db_qfunc.pc://  memcpy(tmp,pub_data_stru->in_msg_type,4);
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->in_msg_type, keyBuf);
db_qfunc.pc:    if(0 > _get_field_data_safe(pub_data_stru,FIELD_RECODE, pub_data_stru->in_msg_type,
db_qfunc.pc:    if(0 > E2E(pub_data_stru->insti_code, acq_code, pub_data_stru->center_result_code, 5)) return -1;
db_qfunc.pc:    dcs_debug(0,0,"at %s(%s:%d), center ret_code=%s",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->center_result_code);
db_qfunc.pc:    WHERE MSG_TYPE=:pub_data_stru->in_msg_type AND (APP_TYPE = :pub_data_stru->app_type or app_type='*') AND STEP = :pub_data_stru->route_num
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->in_msg_type, pub_data_stru->app_type, pub_data_stru->route_num);
db_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code, CODE_SYSTEM_ERR, sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:                    __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->in_msg_type, pub_data_stru->app_type, pub_data_stru->route_num);
db_qfunc.pc:            strcpy_s(pub_data_stru->center_result_code, CODE_SYSTEM_ERR, sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:            strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
db_qfunc.pc://  if(strcmp(pub_data_stru->center_result_code, "00"))return 0;
db_qfunc.pc:       WHERE APP_TYPE = :pub_data_stru->app_type AND STEP = :pub_data_stru->route_num AND FLAG = :pub_data_stru->timeout_table.flag;
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->app_type, pub_data_stru->route_num, pub_data_stru->timeout_table.flag);
db_qfunc.pc:    flag =  atoi(pub_data_stru->timeout_table.flag);
db_qfunc.pc:    strcpy_s(tmsg_type,pub_data_stru->route_msg_type,sizeof(tmsg_type));
db_qfunc.pc:    strcpy_s(ttrans_type,pub_data_stru->route_trans_type,sizeof(ttrans_type));
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->route_msg_type,pub_data_stru->route_trans_type);
db_qfunc.pc:        field_id=get_pub_field_id(pub_data_stru->route_msg_type,field_name);
db_qfunc.pc:        add_pub_field(pub_data_stru,field_id,pub_data_stru->route_msg_type, strlen(data),data, 1);
db_qfunc.pc:    strcpy_s(msgkey, pub_data_stru->timeout_table.first_key, sizeof(msgkey));
db_qfunc.pc:    snprintf(pub_data_stru->app_type,5,"%s", TransLog.app_type);
db_qfunc.pc:    pub_data_stru->route_num = atoi(TransLog.step) + 1;
db_qfunc.pc:    if(!pub_data_stru->req_flag) { //应答交易处理流程中 对交易请求时是否国密算法判别
db_qfunc.pc:        if(TransLog.acq_cry_type[0]==0x31) pub_data_stru->out_cry_flag =1;
db_qfunc.pc:    strcpy_s(insti_code,pub_data_stru->route_insti_code,sizeof(insti_code));
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode,pub_data_stru->route_insti_code);
db_qfunc.pc:                  8, pub_data_stru->route_insti_code, 1);
db_qfunc.pc:                  8, pub_data_stru->route_insti_code, 1);
db_qfunc.pc:    strcpy_s(pub_data_stru->route_msg_type, msg_type, sizeof(pub_data_stru->route_msg_type));
db_qfunc.pc:        memcpy(pub_data_stru->route_mac_index,mac_index,5);
db_qfunc.pc:        memcpy(pub_data_stru->route_mac_key,mac_key,32);
db_qfunc.pc:        memcpy(pub_data_stru->route_pin_index,pin_index,5);
db_qfunc.pc:        memcpy(pub_data_stru->route_pin_key,pin_key,32);
db_qfunc.pc:        memcpy(pub_data_stru->route_data_index,data_index,5);
db_qfunc.pc:        memcpy(pub_data_stru->route_data_key,data_key,5);
db_qfunc.pc:    strcpy_s(pub_data_stru->route_fold_name, fold_name, sizeof(pub_data_stru->route_fold_name));
db_qfunc.pc:    pub_data_stru->route_is_check_mac=is_check_mac[0]-0x30;
db_qfunc.pc:    pub_data_stru->route_insti_open_flag=open_flag[0]-0x30;
db_qfunc.pc:    pub_data_stru->route_insti_work_type=work_type[0]-0x30;
db_qfunc.pc:    pub_data_stru->route_insti_link_type=link_type[0]-0x30;
db_qfunc.pc:    if(cry_type[0] == 0x31) pub_data_stru->out_cry_flag =1;
db_qfunc.pc://  else pub_data_stru->out_cry_flag =0;
db_qfunc.pc:    dcs_debug(0,0,"at %s(%s:%d), route_pin_index=[%s] work_type=[%s]",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->route_pin_index,work_type);
db_qfunc.pc:    get_field_data_safe(pub_data_stru, FIELD_TERM_ID1, pub_data_stru->in_msg_type, term_id1,sizeof(term_id1));
db_qfunc.pc:    get_field_data_safe(pub_data_stru, FIELD_TERM_ID2, pub_data_stru->in_msg_type, term_id2,sizeof(term_id2));
db_qfunc.pc:    strcpy_s(tapp_type,pub_data_stru->app_type,sizeof(tapp_type));
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, term_id1, term_id2, pub_data_stru->app_type);
db_qfunc.pc:        WHERE APP_TYPE = :app_type AND TIMEOUT_FLAG = :pub_data_stru->timeout_table.flag;
db_qfunc.pc:        transflag[0] = pub_data_stru->timeout_table.flag[0] == '4' ? '1' : '0';
db_qfunc.pc:              __FUNCTION__,__FILE__,__LINE__,pub_data_stru->in_msg_type,transflag,app_type,pub_data_stru->timeout_table.flag);
db_qfunc.pc:                                         DB_MSG_TYPE, pub_data_stru->route_insti_code, 2,9))) {
db_qfunc.pc:        pub_data_stru->route_insti_code[len]=0x00;
db_qfunc.pc:    snprintf(pub_data_stru->route_trans_type,5,"%s", trans_type);
db_qfunc.pc:    if(memcmp(pub_data_stru->in_msg_type, "TPOS", 4) == 0) {
db_qfunc.pc:    		field_id = get_pub_field_id(pub_data_stru->in_msg_type, "09");
db_qfunc.pc:    		term_id1 = get_pub_field_id(pub_data_stru->in_msg_type, "PSAM_NO");
db_qfunc.pc:    		field_id = get_pub_field_id(pub_data_stru->in_msg_type, "44");
db_qfunc.pc:    if(0 > get_field_data_safe(pub_data_stru,field_id,pub_data_stru->in_msg_type, 
db_qfunc.pc:    get_field_data_safe(pub_data_stru, term_id1, pub_data_stru->in_msg_type, TransLog.acq_term_id1,17);
db_qfunc.pc:    get_field_data_safe(pub_data_stru, term_id2, pub_data_stru->in_msg_type, TransLog.acq_term_id2,17);
db_qfunc.pc:        SYS_DATE = TO_CHAR(SYSDATE, 'YYYYMMDD') AND ACQ_INSTI_CODE = :pub_data_stru->insti_code
db_qfunc.pc:                pub_data_stru->insti_code, TransLog.acq_term_id1, TransLog.acq_term_id2, TransLog.rcv_acct_no);
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code, CODE_NOT_EXIST);
db_qfunc.pc:                pub_data_stru->insti_code, TransLog.acq_term_id1, TransLog.acq_term_id2, TransLog.rcv_acct_no);
db_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code, TransLog.resp_cd_rcv, sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:    strcpy_s(pub_data_stru->center_result_code, CODE_TRANS_ERR, sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:    if(memcmp(pub_data_stru->in_msg_type, "TPOS", 4) == 0) {
db_qfunc.pc:    		field_id = get_pub_field_id(pub_data_stru->in_msg_type, "08");
db_qfunc.pc:    		term_id1 = get_pub_field_id(pub_data_stru->in_msg_type, "PSAM_NO");
db_qfunc.pc:    		field_id = get_pub_field_id(pub_data_stru->in_msg_type, "44");
db_qfunc.pc:    if(0 > get_field_data_safe(pub_data_stru,field_id,pub_data_stru->in_msg_type, 
db_qfunc.pc:    get_field_data_safe(pub_data_stru, term_id1, pub_data_stru->in_msg_type, TransLog.acq_term_id1,17);
db_qfunc.pc:    get_field_data_safe(pub_data_stru, term_id2, pub_data_stru->in_msg_type, TransLog.acq_term_id2,17);
db_qfunc.pc:        SYS_DATE = TO_CHAR(SYSDATE, 'YYYYMMDD') AND ACQ_INSTI_CODE = :pub_data_stru->insti_code
db_qfunc.pc:                pub_data_stru->insti_code, TransLog.acq_term_id1, TransLog.acq_term_id2, TransLog.pay_acct_no);
db_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code, CODE_NOT_EXIST, sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:        add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"48"),
db_qfunc.pc:                          pub_data_stru->in_msg_type, strlen(show_err),show_err,1);
db_qfunc.pc:                pub_data_stru->insti_code, TransLog.acq_term_id1, TransLog.acq_term_id2, TransLog.pay_acct_no);
db_qfunc.pc:    strcpy_s(pub_data_stru->center_result_code, "00", sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"48"),
db_qfunc.pc:                          pub_data_stru->in_msg_type, strlen(show_err),show_err,0);
db_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code, TransLog.resp_cd_rcv, sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:    strcpy_s(pub_data_stru->center_result_code, CODE_TRANS_ERR, sizeof(pub_data_stru->center_result_code)); */
db_qfunc.pc:    if(memcmp(pub_data_stru->in_msg_type, "TPOS", 4) == 0) {
db_qfunc.pc:    		field_id = get_pub_field_id(pub_data_stru->in_msg_type, "08");
db_qfunc.pc:    		term_id1 = get_pub_field_id(pub_data_stru->in_msg_type, "PSAM_NO");
db_qfunc.pc:    		field_id = get_pub_field_id(pub_data_stru->in_msg_type, "44");
db_qfunc.pc:    if(0 > get_field_data_safe(pub_data_stru,field_id,pub_data_stru->in_msg_type, 
db_qfunc.pc:    get_field_data_safe(pub_data_stru, term_id1, pub_data_stru->in_msg_type, TransLog.acq_term_id1,17);
db_qfunc.pc:    get_field_data_safe(pub_data_stru, term_id2, pub_data_stru->in_msg_type, TransLog.acq_term_id2,17);
db_qfunc.pc:        SYS_DATE = TO_CHAR(SYSDATE, 'YYYYMMDD') AND ACQ_INSTI_CODE = :pub_data_stru->insti_code
db_qfunc.pc:                pub_data_stru->insti_code, TransLog.acq_term_id1, TransLog.acq_term_id2, TransLog.pay_acct_no);
db_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code, CODE_NOT_EXIST, sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:                pub_data_stru->insti_code, TransLog.acq_term_id1, TransLog.acq_term_id2, TransLog.pay_acct_no);
db_qfunc.pc:    strcpy_s(pub_data_stru->center_result_code, TransLog.resp_cd_rcv, sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"48"),
db_qfunc.pc:                          pub_data_stru->in_msg_type, strlen(show_err),show_err,0);
db_qfunc.pc:       MSG_TYPE = :pub_data_stru->in_msg_type   AND
db_qfunc.pc:       (APP_TYPE = :pub_data_stru->app_type OR APP_TYPE = '*');
db_qfunc.pc:                __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->in_msg_type, pub_data_stru->app_type);
db_qfunc.pc:                    __FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->in_msg_type, pub_data_stru->app_type);
db_qfunc.pc:                p = pub_data_stru->route_msg_type;
db_qfunc.pc:                p = pub_data_stru->in_msg_type;
db_qfunc.pc:    if(0 > _get_field_data_safe(pub_data_stru, FIELD_RECODE, pub_data_stru->in_msg_type, acq_code, 0,5)) return -1;
db_qfunc.pc:    if(0 > E2E(pub_data_stru->insti_code, acq_code, pub_data_stru->center_result_code, 5)) return -1;
db_qfunc.pc:    WHERE APP_TYPE = :pub_data_stru->app_type;
db_qfunc.pc:        dcs_log(0, 0, "at %s(%s:%d) sqlcode=%d, app_type=%s",__FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->app_type);
db_qfunc.pc:    len = _get_field_data_safe(pub_data_stru, FIELD_INFO, pub_data_stru->in_msg_type, buf, 0,sizeof(buf));
db_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code,"30",sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code,"30",sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"30");
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"03");
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"96");
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"96");
db_qfunc.pc:    add_pub_field(pub_data_stru, FIELD_AMOUNT, pub_data_stru->route_msg_type, 12, buf, 1); //设置返回的押金金额
db_qfunc.pc:    add_pub_field(pub_data_stru, FIELD_INFO, pub_data_stru->route_msg_type, strlen(buf), buf, 1); //设置返回的押金单号和终端名称
db_qfunc.pc:    strcpy_s(pub_data_stru->center_result_code,"00",sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:    len = get_field_data_safe(pub_data_stru, FIELD_INFO, pub_data_stru->in_msg_type, buf,sizeof(buf));
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"30");
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"30");
db_qfunc.pc:    len = get_field_data_safe(pub_data_stru, 44, pub_data_stru->in_msg_type, buf,sizeof(buf));
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"30");
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"96");
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"96");
db_qfunc.pc:    len = get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type, buf,sizeof(buf));
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"30");
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"13");
db_qfunc.pc:    if(0 > (len=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "08"),
db_qfunc.pc:                                    pub_data_stru->in_msg_type, pwd,sizeof(pwd)))) {
db_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code,"30",sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:    if(pub_data_stru->insti_work_type) {
db_qfunc.pc:        if(0 > (len=get_field_data_safe(pub_data_stru, FIELD_PSAM_NO, pub_data_stru->in_msg_type, term_id,sizeof(term_id)))) {
db_qfunc.pc:            strcpy(pub_data_stru->center_result_code,"30");
db_qfunc.pc:            strcpy(pub_data_stru->center_result_code,"96");
db_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"TZ5");
db_qfunc.pc:    i = get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, cardno,sizeof(cardno));
db_qfunc.pc:    strcpy_s(pub_data_stru->center_result_code,CODE_NO_SUPPORT,sizeof(pub_data_stru->center_result_code));
db_qfunc.pc:    i = get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, cardno,sizeof(cardno));
db_qfunc.pc:    n = get_field_data_safe(pub_data_stru, FIELD_PSAM_NO, pub_data_stru->in_msg_type, psam_no,sizeof(psam_no));
db_qfunc.pc:    n = get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, cardno,sizeof(cardno));
db_qfunc.pc_bak:	     from insti_info where insti_code = :pub_data_stru->insti_code;
db_qfunc.pc_bak:		           __FUNCTION__,pub_data_stru->insti_code,sqlca.sqlerrm.sqlerrmc );
db_qfunc.pc_bak:	snprintf(pub_data_stru->in_mac_index,6,"%s",mac_index);
db_qfunc.pc_bak:	snprintf(pub_data_stru->in_mac_key,33,"%s",mac_key);
db_qfunc.pc_bak:	snprintf(pub_data_stru->in_pin_index,6,"%s",pin_index);
db_qfunc.pc_bak:	snprintf(pub_data_stru->in_pin_key,33,"%s",pin_key);
db_qfunc.pc_bak:	snprintf(pub_data_stru->in_data_index,6,"%s",data_index);
db_qfunc.pc_bak:	snprintf(pub_data_stru->in_data_key,33,"%s",data_key);
db_qfunc.pc_bak:	pub_data_stru->is_check_mac=is_check_mac[0]-0x30;
db_qfunc.pc_bak:	pub_data_stru->insti_open_flag=open_flag[0]-0x30;
db_qfunc.pc_bak:	pub_data_stru->insti_work_type=work_type[0]-0x30;
db_qfunc.pc_bak:	pub_data_stru->insti_link_type=link_type[0]-0x30;
db_qfunc.pc_bak:		 where msg_type= :pub_data_stru->in_msg_type;
db_qfunc.pc_bak:		        __FUNCTION__,pub_data_stru->in_msg_type,sqlca.sqlerrm.sqlerrmc );
db_qfunc.pc_bak:    pub_data_stru->filed_key_num++;
db_qfunc.pc_bak:    if( pub_data_stru->filed_key_num >5)
db_qfunc.pc_bak:    id=get_pub_field_id(pub_data_stru->in_msg_type,tmp);
db_qfunc.pc_bak:    pub_data_stru->filed_key_field_id[pub_data_stru->filed_key_num]=id;
db_qfunc.pc_bak:  	n=get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,tmp,sizeof(tmp));
db_qfunc.pc_bak:    snprintf(pub_data_stru->msg_key+offset,60-offset,"%s",tmp);
db_qfunc.pc_bak:		        where msg_type= :pub_data_stru->in_msg_type;
db_qfunc.pc_bak:		        __FUNCTION__,pub_data_stru->in_msg_type,sqlca.sqlerrm.sqlerrmc);
db_qfunc.pc_bak:   	n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,tmp),
db_qfunc.pc_bak:   	                      pub_data_stru->in_msg_type,tmp,sizeof(tmp));
db_qfunc.pc_bak:  	        msg_type= :pub_data_stru->in_msg_type and key=:str; 
db_qfunc.pc_bak:		        __FUNCTION__,pub_data_stru->in_msg_type,str,sqlca.sqlerrm.sqlerrmc );
db_qfunc.pc_bak:		pub_data_stru->req_flag=1;
db_qfunc.pc_bak:  	       msg_type =:pub_data_stru->in_msg_type ;
db_qfunc.pc_bak:  	       __FUNCTION__,pub_data_stru->in_msg_type,sqlca.sqlerrm.sqlerrmc );
db_qfunc.pc_bak:           pub_data_stru->in_msg_type, 0, 0);
db_qfunc.pc_bak:  	 	        where msg_type= :pub_data_stru->in_msg_type and app_key=:tmp_buf2;
db_qfunc.pc_bak:  	 	         __FUNCTION__,pub_data_stru->in_msg_type,tmp_buf2,sqlca.sqlerrm.sqlerrmc );
db_qfunc.pc_bak:  	 snprintf(pub_data_stru->app_type,5,"%s",app_type);
db_qfunc.pc_bak:  	 snprintf(pub_data_stru->in_trans_type,5,"%s",trans_type);
db_qfunc.pc_bak:  	 pub_data_stru->open_flag=open_flag[0]-0x30;     //业务是否打开
db_qfunc.pc_bak:  	 pub_data_stru->permit_void=permit_void[0]-0x30; //该业务是否允许冲正
db_qfunc.pc_bak:  	           __FUNCTION__,pub_data_stru->in_msg_type,app_type,trans_type,
db_tpos_qfunc.pc:    if(0<(i=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->route_msg_type,
db_tpos_qfunc.pc:                                "22"),pub_data_stru->route_msg_type,
db_tpos_qfunc.pc:        tmp1[1]=get_delay_time(pub_data_stru->route_trans_type);
db_tpos_qfunc.pc:                         get_pub_field_id(pub_data_stru->route_msg_type,"22"),
db_tpos_qfunc.pc:                         pub_data_stru->route_msg_type,i,tmp1,1);
db_tpos_qfunc.pc:    strcpy_s(tmp1,pub_data_stru->center_result_code, sizeof(tmp1));
db_tpos_qfunc.pc:              where ret_code=:pub_data_stru->center_result_code;
db_tpos_qfunc.pc:    if(strcmp(pub_data_stru->app_type,"004")==0 &&
db_tpos_qfunc.pc:       strcmp(pub_data_stru->center_result_code,"00")==0)
db_tpos_qfunc.pc:    else if(strcmp(pub_data_stru->center_result_code,"00")!=0)
db_tpos_qfunc.pc:        tmp[1]= get_delay_time(pub_data_stru->route_trans_type);
db_tpos_qfunc.pc:                        get_pub_field_id(pub_data_stru->route_msg_type,"22"),
db_tpos_qfunc.pc:                        pub_data_stru->route_msg_type,i+5,tmp,1)) {
db_tpos_qfunc.pc:    if(pub_data_stru->in_cry_flag) {
db_tpos_qfunc.pc:        memcpy(pub_data_stru->route_mac_key,mac_key1,32);
db_tpos_qfunc.pc:        snprintf(pub_data_stru->route_mac_index,5,"%s",sek_indx);
db_tpos_qfunc.pc:        memcpy(pub_data_stru->route_mac_key,mac_key1,32);
db_tpos_qfunc.pc:        strcpy_s(pub_data_stru->route_mac_index,sek_indx,sizeof(pub_data_stru->route_mac_index));
db_tpos_qfunc.pc:    strcpy_s(pub_data_stru->center_result_code,"00",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"39"),
db_tpos_qfunc.pc:                  pub_data_stru->route_msg_type,n,tmp,1);
db_tpos_qfunc.pc:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"28"),
db_tpos_qfunc.pc:                  pub_data_stru->route_msg_type,0,tmp,1);
db_tpos_qfunc.pc:    pub_data_stru->tmp_order[0]= 0x31;
db_tpos_qfunc.pc:    len = _get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "3E"),
db_tpos_qfunc.pc:                               pub_data_stru->in_msg_type, buf, 0,sizeof(buf));
db_tpos_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"30");
db_tpos_qfunc.pc:    len = _get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "09"),
db_tpos_qfunc.pc:                               pub_data_stru->in_msg_type, deposit_no, 0,sizeof(deposit_no));
db_tpos_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"30");
db_tpos_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"30");
db_tpos_qfunc.pc:                strcpy_s(pub_data_stru->center_result_code,"03",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:                strcpy_s(pub_data_stru->center_result_code,"96",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code,"96",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:    add_pub_field(pub_data_stru, FIELD_AMOUNT, pub_data_stru->route_msg_type, 12, buf, 1); //设置返回的押金金额
db_tpos_qfunc.pc://  add_pub_field(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "09"), strlen(buf), buf, 1, NULL); //设置返回的账单名称
db_tpos_qfunc.pc:    add_pub_field(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "3D"),
db_tpos_qfunc.pc:                  pub_data_stru->in_msg_type,strlen(buf), buf, 1); //设置返回的账单号
db_tpos_qfunc.pc:    strcpy_s(pub_data_stru->center_result_code,"00",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:    len = get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "3D"),
db_tpos_qfunc.pc:                              pub_data_stru->in_msg_type, buf,sizeof(buf));
db_tpos_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code,"30",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code,"30",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:            strcpy_s(pub_data_stru->center_result_code,"96",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:            strcpy_s(pub_data_stru->center_result_code,"96",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code,"96",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:    len = get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type, buf,sizeof(buf));
db_tpos_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code,"30",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code,"13",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:        strcpy_s(pub_data_stru->center_result_code,"13",sizeof(pub_data_stru->center_result_code));
db_tpos_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"96");
db_tpos_qfunc.pc:            strcpy(pub_data_stru->center_result_code,"96");
db_tpos_qfunc.pc:                strcpy(pub_data_stru->center_result_code,"96");
db_tpos_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"TZ6");
db_tpos_qfunc.pc:            strcpy(pub_data_stru->center_result_code,"96");
db_tpos_qfunc.pc:    add_pub_field(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "2B"),
db_tpos_qfunc.pc:                  pub_data_stru->route_msg_type, strlen(tmp), tmp, 1);
db_tpos_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"96");
db_tpos_qfunc.pc:        strcpy(pub_data_stru->center_result_code,"96");
db_tpos_qfunc.pc:    strcpy(pub_data_stru->center_result_code,"00");
db_tpos_qfunc.pc_bak:  if(0<(i=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->route_msg_type,
db_tpos_qfunc.pc_bak:  	                          "22"),pub_data_stru->route_msg_type,
db_tpos_qfunc.pc_bak:  		tmp1[1]=get_delay_time(pub_data_stru->route_trans_type);
db_tpos_qfunc.pc_bak:  		                  get_pub_field_id(pub_data_stru->route_msg_type,"22"),
db_tpos_qfunc.pc_bak:  		                  pub_data_stru->route_msg_type,i,tmp1,1);
db_tpos_qfunc.pc_bak:	strcpy(tmp1,pub_data_stru->center_result_code);
db_tpos_qfunc.pc_bak:		       where ret_code=:pub_data_stru->center_result_code;
db_tpos_qfunc.pc_bak:	if( strcmp(pub_data_stru->app_type,"004")==0 && 
db_tpos_qfunc.pc_bak:		strcmp(pub_data_stru->center_result_code,"00")==0 ) 
db_tpos_qfunc.pc_bak:	else if( strcmp(pub_data_stru->center_result_code,"00")!=0) 
db_tpos_qfunc.pc_bak:		tmp[1]= get_delay_time(pub_data_stru->route_trans_type);
db_tpos_qfunc.pc_bak:		                  get_pub_field_id(pub_data_stru->route_msg_type,"22"),
db_tpos_qfunc.pc_bak:		                  pub_data_stru->route_msg_type,i+5,tmp,1))
db_ufunc.pc:    EXEC SQL SELECT HANDLE, PARA INTO :handle, :para FROM DB_UPDATE_SET WHERE (APP_TYPE = :pub_data_stru->app_type or app_type='*') AND STEP = :pub_data_stru->route_num;
db_ufunc.pc:        dcs_log(0, 0, "at %s(%s:%d) sqlcode=%d, SELECT DB_UPDATE_SET, APP_TYPE[%s], STEP[%d]  Error",__FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->app_type, pub_data_stru->route_num);
db_ufunc.pc:    if(0 >=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "53"),
db_ufunc.pc:                               pub_data_stru->in_msg_type,buf,sizeof(buf))) {
db_ufunc.pc:        if(0 >=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "48"),
db_ufunc.pc:                                   pub_data_stru->in_msg_type,tmp,sizeof(tmp))) {
db_ufunc.pc:        if(0 >=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "96"),
db_ufunc.pc:                                   pub_data_stru->in_msg_type,tmp,sizeof(tmp))) {
db_ufunc.pc:        exec sql update INSTI_INFO set pin_key= :key where insti_code = :pub_data_stru->insti_code;
db_ufunc.pc:            exec sql update INSTI_INFO set mac_key= :key where insti_code = :pub_data_stru->insti_code;
db_ufunc.pc:                strcpy(pub_data_stru->center_result_code,"30");
db_ufunc.pc:        dcs_log(0, 0, "at %s(%s:%d) sqlcode=%d, UPDATE INSTI_INFO INSTI_CODE=[%s] error",__FUNCTION__,__FILE__,__LINE__,sqlca.sqlcode, pub_data_stru->insti_code);
db_ufunc.pc:        strcpy(pub_data_stru->center_result_code,"96");
db_ufunc.pc:    strcpy(pub_data_stru->center_result_code,"00");
db_user_func.pc:    if(0 > get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf))) {
db_user_func.pc:        strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
db_user_func.pc:    if(0 > get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, cardno,sizeof(cardno))) {
db_user_func.pc:    if(0 > get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf))) {
db_user_func.pc:    if(0 > get_field_data_safe(pub_data_stru, FIELD_BILL, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf))) {
db_user_func.pc:        strcpy(pub_data_stru->center_result_code, CODE_CARD_NO_ALLOW);
db_user_func.pc:            strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
db_user_func.pc:            if(0 > AddUpTrans(cardno, &addup_amount, &addup_count, pub_data_stru->app_type, 1))
db_user_func.pc:                strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
db_user_func.pc:                strcpy(pub_data_stru->center_result_code, CODE_COUNT_LIMIT);
db_user_func.pc:            strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
db_user_func.pc:            if(0 > AddUpTrans(cardno, &addup_amount, &addup_count, pub_data_stru->app_type, 1))
db_user_func.pc:                strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
db_user_func.pc:                strcpy(pub_data_stru->center_result_code, CODE_COUNT_LIMIT);
db_user_func.pc:    snprintf(pub_data_stru->route_insti_code,9,"%s", pay_org_no);
db_user_func.pc:    add_pub_field(pub_data_stru, FIELD_INFO, pub_data_stru->route_msg_type, strlen(bill_info), bill_info, 1);
db_user_func.pc:    add_pub_field(pub_data_stru, FIELD_TERM_ID2, pub_data_stru->route_msg_type,
db_user_func.pc:    add_pub_field(pub_data_stru, FIELD_TERM_ID1, pub_data_stru->route_msg_type,
db_user_func.pc:    if(0 > get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type,
db_user_func.pc:        strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
db_user_func.pc:    if(memcmp(pub_data_stru->in_msg_type, "TPOS", 4) == 0) 
db_user_func.pc:    	bill_id = get_pub_field_id(pub_data_stru->in_msg_type, "09");
db_user_func.pc:    	bill_id = get_pub_field_id(pub_data_stru->in_msg_type, "44");
db_user_func.pc:                                    pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf)))) {
db_user_func.pc:        strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
db_user_func.pc:        add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "48"),
db_user_func.pc:                      pub_data_stru->in_msg_type, strlen(tmpBuf), tmpBuf, 1);
db_user_func.pc:        strcpy(pub_data_stru->center_result_code, "25");
db_user_func.pc:        strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
db_user_func.pc:        strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
db_user_func.pc:    add_pub_field(pub_data_stru, FIELD_AMOUNT_REAL, pub_data_stru->in_msg_type, strlen(real_amount), real_amount, 0);
db_user_func.pc:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "48"),
db_user_func.pc:                  pub_data_stru->in_msg_type, strlen(tmpBuf), tmpBuf, 1);
db_user_func.pc:    strcpy(pub_data_stru->center_result_code, "00");
db_user_func.pc:消息格式 前4自己为消息类型(但消息类型不得为0001)，再接目的机构代码，后面接消息关键字(关键字为记录关键字，即pub_data_stru->timeout_table)
db_user_func.pc://  insti_to_folder_code(inst_code,pub_data_stru->timeout_table.foldname);
db_user_func.pc://  memcpy(pub_data_stru->timeout_table.foldname,inst_code,8);
db_user_func.pc:    memcpy(pub_data_stru->timeout_table.trans_type,para,4);
db_user_func.pc:    pub_data_stru->timeout_table.trans_type[4]=0x00;
db_user_func.pc:    sLen -= sizeof(pub_data_stru->timeout_table.remark);
db_user_func.pc:    memcpy(pub_data_stru->timeout_table.remark,inst_code,8);
db_user_func.pc:    sLen += strlen(pub_data_stru->timeout_table.remark) + 1;
db_user_func.pc:    pub_data_stru->timeout_table.flag[0]='6';
db_user_func.pc:    memcpy(buf +8, (char*)&(pub_data_stru->timeout_table), sLen);
db_zpos_qfunc.pc:    memcpy(pub_data_stru->in_mac_key,mac_key1,32);
db_zpos_qfunc.pc:    memcpy(pub_data_stru->route_mac_key,mac_key1,32);
db_zpos_qfunc.pc:    snprintf(pub_data_stru->route_mac_index,5,"%s",sek_indx);
db_zpos_qfunc.pc:    strcpy(pub_data_stru->center_result_code,"00");
db_zpos_qfunc.pc:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"48"),
db_zpos_qfunc.pc:                  pub_data_stru->route_msg_type,n,tmp,1);
db_zpos_qfunc.pc:         from INSTI_INFO where insti_code=:pub_data_stru->insti_code;
db_zpos_qfunc.pc:    memcpy(pub_data_stru->in_mac_key,mac_key1,32);
db_zpos_qfunc.pc:    memcpy(pub_data_stru->route_mac_key,mac_key1,32);
db_zpos_qfunc.pc:    snprintf(pub_data_stru->route_mac_index,5,"%s",mac_indx);
db_zpos_qfunc.pc:    strcpy(pub_data_stru->center_result_code,"00");
db_zpos_qfunc.pc:    if(memcmp(pub_data_stru->in_msg_type,"LINS",4)!=0) {
db_zpos_qfunc.pc:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"48"),
db_zpos_qfunc.pc:                  pub_data_stru->route_msg_type,n,tmp,1);
db_zpos_qfunc.pc:    if(0>insti_update_work_key(pub_data_stru->insti_code,pin_key1,mac_key1,cd_key1))
general_util.c:    pub_data_stru->src_buffer=NULL;
general_util.c:    pub_data_stru->src_len=0;
general_util.c:    pub_data_stru->req_flag=0; //1为请求交易，其他为应答交易
general_util.c:    pub_data_stru->switch_src_flag = 0; // 1为转接到原受理机构，其他为转接到其他目的机构
general_util.c:    pub_data_stru->insti_code[0]=0x00;    //发送报文的机构代码
general_util.c:    pub_data_stru->insti_fold_name[0] = 0x00;//发送报文通信用的fold名字
general_util.c:    pub_data_stru->insti_open_flag = 0x00;  //发送机构打开标识,0关闭,1打开
general_util.c:    pub_data_stru->insti_link_type =0x00;  //发送机构链路标识，0,长连接 1,短连接
general_util.c:    pub_data_stru->insti_work_type =0x00;  //发送机构交易接入模式 0,机构 ,1 终端
general_util.c:    pub_data_stru->in_priv_def = NULL;    //进入报文种类数据域定义指针
general_util.c:    pub_data_stru->in_msg_type[0] = 0x00; //进入报文的报文类型
general_util.c:    pub_data_stru->in_mastkey[0] = 0x00;
general_util.c:    pub_data_stru->in_mac_index[0] = 0x00;
general_util.c:    pub_data_stru->in_mac_key[0] = 0x00;
general_util.c:    pub_data_stru->in_pin_index[0] = 0x00;
general_util.c:    pub_data_stru->in_pin_key[0] = 0x00 ;
general_util.c:    pub_data_stru->in_data_index[0] = 0x00;
general_util.c:    pub_data_stru->in_data_key[0] = 0x00 ;
general_util.c:    pub_data_stru->is_check_mac = 0x00 ;//是否校验mac
general_util.c:    pub_data_stru->msg_key[0] = 0x00 ; //报文关键字
general_util.c:    pub_data_stru->app_type[0] = 0x00 ; //业务类型
general_util.c:    pub_data_stru->in_trans_type[0] = 0x00;//进入交易类型
general_util.c:    pub_data_stru->open_flag =0x00;//业务打开标识 0关闭，1打开
general_util.c:    pub_data_stru->is_route = 0x00;//是否路由 0：转发初始接入点，1：业务下一路由节点，2：处理结束,3:原始交易路由节点
general_util.c:    pub_data_stru->route_num = 0; //交易被路由的次数
general_util.c:    pub_data_stru->step_type = 1; // 1 支付渠道，2业务渠道
general_util.c:    pub_data_stru->route_insti_code[0] = 0x00;// 路由机构代码
general_util.c:    pub_data_stru->route_fold_name[0] = 0x00;//路由报文通信用的fold名字
general_util.c:    pub_data_stru->route_is_make_mac=0x00;//是否产生mac
general_util.c:    pub_data_stru->route_insti_open_flag=0x00;//路由机构打开标识 0关闭,1打开
general_util.c:    pub_data_stru->route_insti_link_type=0x00;  //路由机构链路标识，0,长连接 1,短连接
general_util.c:    pub_data_stru->route_insti_work_type = 0x00;  //路由机构交易接入模式 0,机构 ,1 终端
general_util.c:    pub_data_stru->route_is_check_mac = 0x00;
general_util.c:    pub_data_stru->route_msg_type[0] = 0x00;//路由转换的报文类型
general_util.c:    pub_data_stru->route_trans_type[0] = 0x00; //路由转换的交易类型
general_util.c:    pub_data_stru->route_priv_def = NULL;       //路由的报文种类数据域定义指针
general_util.c:    pub_data_stru->route_set.num=0;//转发的报文数据域ID集合
general_util.c:    pub_data_stru->route_mastkey[0] = 0x00;
general_util.c:    pub_data_stru->route_mac_index[0] =0x00;
general_util.c:    pub_data_stru->route_mac_key[0]= 0x00;
general_util.c:    pub_data_stru->route_pin_index[0] = 0x00;
general_util.c:    pub_data_stru->route_pin_key[0] =0x00 ;
general_util.c:    pub_data_stru->route_data_index[0] = 0x00;
general_util.c:    pub_data_stru->route_data_key[0] = 0x00;
general_util.c:    pub_data_stru->center_result_code[0] = 0x00;//中心处理结果代码
general_util.c:    pub_data_stru->is_void = 0x00;             //是否需要冲正处理 ,0不冲正，1需要
general_util.c:    pub_data_stru->permit_void = 0x00;         // 应用是否许可受理方发起冲正
general_util.c:    pub_data_stru->use_timeout = 0x00 ;         //使用超时表标志
general_util.c:    pub_data_stru->timeout_table.foldname[0]=0x00;//超时表存放的数据
general_util.c:    pub_data_stru->timeout_table.sys_date[0]=0x00;
general_util.c:    pub_data_stru->timeout_table.sys_time[0]=0x00;
general_util.c:    pub_data_stru->timeout_table.key[0]=0x00;
general_util.c:    pub_data_stru->timeout_table.flag[0]=0x00;
general_util.c:    pub_data_stru->timeout_table.num=0;
general_util.c:    pub_data_stru->timeout_table.invalid_time=0;
general_util.c:    pub_data_stru->timeout_table.first_key[0]=0x00;
general_util.c:    pub_data_stru->timeout_table.trans_type[0]=0x00;
general_util.c:    pub_data_stru->timeout_table.remark[0] = 0x00;
general_util.c:    pub_data_stru->filed_key_num=0; //关键域字段个数
general_util.c:    pub_data_stru->msg_field_num = 0; //报文域总数
general_util.c:    pub_data_stru->timeout = 0;
general_util.c://  memset(&pub_data_stru->data_rec[0],0x00,sizeof(field_data)*MAX_FIELD) ; //报文域数据解析
general_util.c:    memset(pub_data_stru->tmp_order,0x00,5);         //特殊报文使用的指令表示区
general_util.c:    pub_data_stru->in_cry_flag=0x00; // 进入国密算法应用标识 默认0不应用，1应用
general_util.c:    pub_data_stru->out_cry_flag=0x00; //出去国密算法应用标识 默认0不应用，1应用
general_util.c:    pub_data_stru->off_set=0;         //buffer使用偏移量
general_util.c:    pub_data_stru->buffer[0]=0x00; //数据存放区
general_util.c:    if((data_len <0) || ((MAX_BUFFER - pub_data_stru->off_set) < data_len)) {
general_util.c:    if(pub_data_stru->msg_field_num >=MAX_FIELD || id <0) {
general_util.c:    for(i=0 ; i<pub_data_stru->msg_field_num ; i++) {
general_util.c:        if(id == pub_data_stru->data_rec[i].field_id &&
general_util.c:           from == pub_data_stru->data_rec[i].from &&
general_util.c:           memcmp(msg_type,pub_data_stru->data_rec[i].msg_type,4)==0 &&
general_util.c:           pub_data_stru->data_rec[i].Off ==1) {
general_util.c:                pub_data_stru->data_rec[i].len=0;
general_util.c:                if(pub_data_stru->data_rec[i].data_addr+pub_data_stru->data_rec[i].len != pub_data_stru->buffer+pub_data_stru->off_set) {
general_util.c:                    if((MAX_BUFFER - pub_data_stru->off_set) <= (pub_data_stru->data_rec[i].len+1+data_len)) {
general_util.c:                    if(pub_data_stru->data_rec[i].len <2048) {
general_util.c:						//dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->data_rec[i].len);
general_util.c:                        memcpy(caBuf,pub_data_stru->data_rec[i].data_addr,pub_data_stru->data_rec[i].len);
general_util.c:                                __FUNCTION__,pub_data_stru->data_rec[i].len);
general_util.c:                    pub_data_stru->data_rec[i].data_addr= pub_data_stru->buffer+pub_data_stru->off_set;
general_util.c:                    pub_data_stru->off_set= pub_data_stru->off_set+pub_data_stru->data_rec[i].len;
general_util.c:					//dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->data_rec[i].len);
general_util.c:                    memcpy(pub_data_stru->data_rec[i].data_addr,caBuf,pub_data_stru->data_rec[i].len);
general_util.c:                pub_data_stru->buffer[pub_data_stru->off_set]=0x00;
general_util.c:                pub_data_stru->off_set++;
general_util.c:                pub_data_stru->data_rec[i].len++;
general_util.c:            pub_data_stru->msg_field_num--;
general_util.c:    if(s <0)  i=pub_data_stru->msg_field_num;
general_util.c:    pub_data_stru->data_rec[i].field_id = id;
general_util.c:        pub_data_stru->data_rec[i].data_addr=pub_data_stru->buffer+pub_data_stru->off_set;
general_util.c:    pub_data_stru->data_rec[i].Off=1;
general_util.c:    pub_data_stru->data_rec[i].from=from;
general_util.c:    memcpy(pub_data_stru->data_rec[i].data_addr+pub_data_stru->data_rec[i].len,data,data_len);
general_util.c:    memcpy(pub_data_stru->data_rec[i].msg_type, msg_type, 4); //2016/7/20 星期三 下午 4:54:48 data_rec.msg_type
general_util.c:    pub_data_stru->data_rec[i].len=pub_data_stru->data_rec[i].len+data_len;
general_util.c:    pub_data_stru->off_set=pub_data_stru->off_set+data_len;
general_util.c:    pub_data_stru->msg_field_num++;
general_util.c:    return pub_data_stru->data_rec[i].len;
general_util.c:    if((data_len <0) || ((MAX_BUFFER - pub_data_stru->off_set) < data_len)) {
general_util.c:    for(i=0 ; i<pub_data_stru->msg_field_num ; i++) {
general_util.c:        if(id == pub_data_stru->data_rec[i].field_id &&
general_util.c:           from == pub_data_stru->data_rec[i].from &&
general_util.c:           memcmp(msg_type,pub_data_stru->data_rec[i].msg_type,4)==0 &&
general_util.c:           pub_data_stru->data_rec[i].Off ==1) {
general_util.c:                pub_data_stru->data_rec[i].len=0;
general_util.c:            if(data_len > pub_data_stru->data_rec[i].len) {
general_util.c:                if(pub_data_stru->data_rec[i].data_addr+pub_data_stru->data_rec[i].len != pub_data_stru->buffer+pub_data_stru->off_set) {
general_util.c:        pub_data_stru->data_rec[i].data_addr=pub_data_stru->buffer+pub_data_stru->off_set;
general_util.c:    memcpy(pub_data_stru->data_rec[i].data_addr,data,data_len);
general_util.c:    pub_data_stru->data_rec[i].len=data_len;
general_util.c:        pub_data_stru->off_set=pub_data_stru->off_set+data_len;
general_util.c:        pub_data_stru->off_set= pub_data_stru->data_rec[i].data_addr - pub_data_stru->buffer+data_len;
general_util.c:    for(i=0 ; i<pub_data_stru->msg_field_num ; i++) {
general_util.c:        if(id == pub_data_stru->data_rec[i].field_id &&
general_util.c:           from == pub_data_stru->data_rec[i].from &&
general_util.c:           memcmp(msg_type,pub_data_stru->data_rec[i].msg_type,4)==0 &&
general_util.c:           pub_data_stru->data_rec[i].Off ==1) {
general_util.c://          pub_data_stru->data_rec[i].Off=0;                       // 2016/7/21 星期四 下午 2:37:58 modified
general_util.c:            if(i != pub_data_stru->msg_field_num-1) {            // 2016/7/21 星期四 下午 2:37:51 modified
general_util.c:                memcpy(&pub_data_stru->data_rec[i],
general_util.c:                       &pub_data_stru->data_rec[pub_data_stru->msg_field_num-1],
general_util.c:            pub_data_stru->data_rec[pub_data_stru->msg_field_num-1].len=0;
general_util.c:            pub_data_stru->msg_field_num--;
general_util.c:    for(i=0; i<pub_data_stru->msg_field_num; i++) {
general_util.c:        if(field_id == pub_data_stru->data_rec[i].field_id &&
general_util.c:           memcmp(msg_type, pub_data_stru->data_rec[i].msg_type,4)==0 &&
general_util.c:           pub_data_stru->data_rec[i].Off) {
general_util.c:            //dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,MIN(pub_data_stru->data_rec[i].len,size-1));
general_util.c:            memcpy(data,pub_data_stru->data_rec[i].data_addr,
general_util.c:                   MIN(pub_data_stru->data_rec[i].len,size-1));
general_util.c:            data[MIN(pub_data_stru->data_rec[i].len,size-1)]=0x00;
general_util.c:            return MIN(pub_data_stru->data_rec[i].len,size-1);
general_util.c:    for(i=0; i<pub_data_stru->msg_field_num; i++) {
general_util.c:        if(field_id == pub_data_stru->data_rec[i].field_id &&
general_util.c:           memcmp(msg_type,pub_data_stru->data_rec[i].msg_type,4)==0 &&
general_util.c:           pub_data_stru->data_rec[i].Off &&
general_util.c:           pub_data_stru->data_rec[i].from== flag) {
general_util.c:            //dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,MIN(pub_data_stru->data_rec[i].len,size-1));
general_util.c:            memcpy(data,pub_data_stru->data_rec[i].data_addr,
general_util.c:                   MIN(pub_data_stru->data_rec[i].len,size-1));
general_util.c:            data[MIN(pub_data_stru->data_rec[i].len,size-1)]=0x00;
general_util.c:            return MIN(pub_data_stru->data_rec[i].len,size-1);
general_util.c:    return snprintf(msg_type,size,"%s",pub_data_stru->in_msg_type);
general_util.c:    return snprintf(pub_data_stru->center_result_code,5,"%s",ret_code);
general_util.c:    return !pub_data_stru->route_insti_open_flag;
general_util.c:    return pub_data_stru->route_insti_link_type;
general_util.c:    return pub_data_stru->insti_open_flag;
general_util.c:        dcs_log(0, 0, "<%s>接收机构[%s]已关闭！",   __FUNCTION__, pub_data_stru->route_insti_code);
general_util.c:    iDescFid = fold_locate_folder(pub_data_stru->route_fold_name);
general_util.c:        dcs_log(0, 0, "<%s>取接收机构fold name[%s]出错！",  __FUNCTION__, pub_data_stru->route_fold_name);
general_util.c:        if(IsReady((const char *)pub_data_stru->route_fold_name) < 0) {
general_util.c:        pub_data_stru->in_cry_flag =1;
general_util.c:        pub_data_stru->in_cry_flag =0;
general_util.c:        pub_data_stru->out_cry_flag =1;
general_util.c:        pub_data_stru->out_cry_flag =0;
general_util.c:    set = &pub_data_stru->route_set;
general_util.c:    set = &pub_data_stru->route_set;
general_util.c:    switch(pub_data_stru->timeout_table.flag[0]) {
general_util.c:            pub_data_stru->timeout_table.flag[0]++;
general_util.c:    write_voidtrans_to_fold(&pub_data_stru->timeout_table);
general_util.c://  add_pub_field(pub_data_stru,FIELD_DATE_TIME_Y, pub_data_stru->route_msg_type,
general_util.c:            add_pub_field(pub_data_stru,fldid, pub_data_stru->route_msg_type,
general_util.c:            add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c:            add_pub_field(pub_data_stru,fldid, pub_data_stru->route_msg_type,
general_util.c:            add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c:    if(0 <= get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,para),
general_util.c:                                pub_data_stru->in_msg_type, tmpBuf,2)) {
general_util.c:                                       pub_data_stru->in_msg_type, tmpBuf,1)) {
general_util.c:                                       pub_data_stru->in_msg_type,tmpBuf,1)) {
general_util.c:                                pub_data_stru->route_msg_type, tmpBuf,1)) {
general_util.c:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type, 3,
general_util.c:                    msgtype = pub_data_stru->route_msg_type;
general_util.c:                    msgtype = pub_data_stru->in_msg_type;
general_util.c:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c:                                   get_pub_field_id(pub_data_stru->in_msg_type,para),
general_util.c:                                   pub_data_stru->in_msg_type,fieldVal,sizeof(fieldVal));
general_util.c:    if(flag && memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) == 0)
general_util.c:        return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c:    return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c:    if(pub_data_stru->route_num == 0 && pub_data_stru->switch_src_flag == 1)
general_util.c:            return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c:    return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c:    return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c:    if((flag && pub_data_stru->out_cry_flag) ||
general_util.c:       (!flag && pub_data_stru->in_cry_flag)) {
general_util.c:        if(pub_data_stru->out_cry_flag)
general_util.c:            i = GenMacSM(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, buf, bufLen, macAsc);
general_util.c:            i = GenMac3Des(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, buf, bufLen, macAsc);
general_util.c:        if(pub_data_stru->in_cry_flag)
general_util.c:            i= GenMacSM(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc);
general_util.c:            i = GenMac3Des(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc);
general_util.c:    if(pub_data_stru->out_cry_flag) {
general_util.c:        i = GenMac(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, buf, bufLen, macAsc);
general_util.c:        i = GenMac(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc);
general_util.c:    dcs_debug(0,0,"<%s> POS_ENTRY_MD_CD=%d, req_flag=%d,fldid=%d",__FUNCTION__,POS_ENTRY_MD_CD,pub_data_stru->req_flag,fldid);
general_util.c:    if(pub_data_stru->req_flag) {
general_util.c:        if(0>=get_field_data_safe(pub_data_stru,POS_ENTRY_MD_CD,  pub_data_stru->in_msg_type,
general_util.c:        l = get_field_data_safe(pub_data_stru,inFldid, pub_data_stru->in_msg_type,
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c:            l = get_field_data_safe(pub_data_stru,FIELD_CARD_NO,  pub_data_stru->in_msg_type,
general_util.c:                strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c:        if(0>DESTRANSPIN2(reCode,  pub_data_stru->in_pin_index, pub_data_stru->route_pin_index, pub_data_stru->in_pin_key, pub_data_stru->route_pin_key, pinBin, inPan, pinNewBuf, outPan)) {
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_PIN_ERR);
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_PIN_ERR);
general_util.c:            add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,16,
general_util.c:            add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c:    len = _get_field_data_safe(pub_data_stru,fieldid,pub_data_stru->route_msg_type,
general_util.c:            i=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, tmp),
general_util.c:                                  pub_data_stru->in_msg_type,
general_util.c:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c:    if(strcmp(pub_data_stru->in_msg_type,"TPOS")==0 &&
general_util.c:                              pub_data_stru->in_msg_type,fieldVal,sizeof(fieldVal))) >0) {
general_util.c:            return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c:            i=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, tmp),
general_util.c:                                  pub_data_stru->in_msg_type,
general_util.c:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c:            i=get_field_data_safe(pub_data_stru,atoi(tmp), pub_data_stru->in_msg_type,
general_util.c:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c:            return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c:            return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c:        else return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c:    len=get_field_data_safe(pub_data_stru,POS_ENTRY_MD_CD, pub_data_stru->route_msg_type,
general_util.c:        add_pub_field(pub_data_stru,fldid,pub_data_stru->route_msg_type,
general_util.c:        add_pub_field(pub_data_stru,fldid,pub_data_stru->route_msg_type,
general_util.c:    if(pub_data_stru->route_num == 0 && pub_data_stru->switch_src_flag == 1) return 1;
general_util.c:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c:    len=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "3D"),
general_util.c:                            pub_data_stru->in_msg_type,tmp,sizeof(tmp));
general_util.c:        del_pub_field(pub_data_stru,fldid,pub_data_stru->in_msg_type,1);
general_util.c:    i=get_field_data_safe(pub_data_stru, 917, pub_data_stru->in_msg_type,
general_util.c:    if(memcmp(pub_data_stru->route_insti_code,tmp,8)==0) {
general_util.c:        memcpy(pub_data_stru->route_trans_type,tmp,4);
general_util.c:    i=get_field_data_safe(pub_data_stru, POS_ENTRY_MD_CD, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf));
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c:        l = get_field_data_safe(pub_data_stru, FIELD_TRACK2, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf));
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c:        add_pub_field(pub_data_stru, FIELD_CARD_NO, pub_data_stru->route_msg_type, i, tmpBuf, 1);
general_util.c:        l = get_field_data_safe(pub_data_stru, FIELD_IC_DATA, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf));
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c:                      pub_data_stru->route_msg_type, strlen(tmpBuf), tmpBuf, 1);
general_util.c:        if(0 < (l = get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf)))) {
general_util.c:            add_pub_field(pub_data_stru, FIELD_CARD_NO, pub_data_stru->route_msg_type, l, tmpBuf, 1);
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c:        if(0 < (l = get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf)))) {
general_util.c:            add_pub_field(pub_data_stru, FIELD_CARD_NO, pub_data_stru->route_msg_type, l, tmpBuf, 1);
general_util.c:    if(0 <(l= get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf)))) {
general_util.c:    if(0 >(ret= get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, cardno,sizeof(cardno)))) {
general_util.c:                                     pub_data_stru->route_msg_type, card_attr, 2,sizeof(card_attr)))) {
general_util.c:    if(0 >(ret= get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf)))) {
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_CARD_NO_ALLOW);
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_CARD_NO_ALLOW);
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
general_util.c:            if(0 > AddUpTrans(cardno, &addup_amount, &addup_count, pub_data_stru->app_type, 0))
general_util.c:                strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
general_util.c:                strcpy(pub_data_stru->center_result_code, CODE_COUNT_LIMIT);
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
general_util.c:            if(0 > AddUpTrans(cardno, &addup_amount, &addup_count, pub_data_stru->app_type, 0))
general_util.c:                strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
general_util.c:                strcpy(pub_data_stru->center_result_code, CODE_COUNT_LIMIT);
general_util.c:    if(!pub_data_stru->is_check_mac) return 1;
general_util.c:    macLen = _get_field_data_safe(pub_data_stru, FIELD_MAC, pub_data_stru->in_msg_type, inMacBuf, 0,sizeof(inMacBuf));
general_util.c:        if(0 == strcmp(pub_data_stru->center_result_code, "00") || pub_data_stru->center_result_code[0] == 0) {
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c:    def=get_priv_field_def_for_id(FIELD_MAC,match_priv_stru(pub_data_stru->in_msg_type,&gl_def_set));
general_util.c:    headLen = _get_field_data_safe(pub_data_stru, FIELD_TPDU, pub_data_stru->in_msg_type, tmpBuf, 0,sizeof(tmpBuf));
general_util.c:    def=get_priv_field_def_for_id(FIELD_TPDU,match_priv_stru(pub_data_stru->in_msg_type,&gl_def_set));
general_util.c:        bufLen = pub_data_stru->src_len;
general_util.c:        buf = pub_data_stru->src_buffer;
general_util.c:        bufLen = pub_data_stru->src_len;
general_util.c:        buf = pub_data_stru->src_buffer;
general_util.c:    if(0 > GenMac(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc)) {
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c:    def=get_priv_field_def_for_id(FIELD_MAC,match_priv_stru(pub_data_stru->in_msg_type,&gl_def_set));
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c:    if(!pub_data_stru->is_check_mac) return 1;
general_util.c:    macLen = _get_field_data_safe(pub_data_stru, FIELD_MAC, pub_data_stru->in_msg_type, inMacBuf, 0,sizeof(inMacBuf));
general_util.c:        if(0 == strcmp(pub_data_stru->center_result_code, "00") || pub_data_stru->center_result_code[0] == 0) {
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c:    def=get_priv_field_def_for_id(FIELD_MAC,match_priv_stru(pub_data_stru->in_msg_type,&gl_def_set));
general_util.c:    if(0<(headLen = _get_field_data_safe(pub_data_stru, FIELD_TPDU, pub_data_stru->in_msg_type, tmpBuf, 0,sizeof(tmpBuf)))) {
general_util.c:        def=get_priv_field_def_for_id(FIELD_TPDU,match_priv_stru(pub_data_stru->in_msg_type,&gl_def_set));
general_util.c:    bufLen = pub_data_stru->src_len - headLen;
general_util.c:    buf = pub_data_stru->src_buffer+headLen;
general_util.c:    if(pub_data_stru->in_cry_flag) {
general_util.c:    if(pub_data_stru->in_cry_flag) {
general_util.c:        if(0 > GenMacSM(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc)) {
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c:        if(0 > GenMac3Des(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc)) {
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c:    if(!pub_data_stru->is_check_mac) return 1;
general_util.c:    macLen = _get_field_data_safe(pub_data_stru, FIELD_MAC, pub_data_stru->in_msg_type, inMacBuf, 0,sizeof(inMacBuf));
general_util.c:        if(0 == strcmp(pub_data_stru->center_result_code, "00") || pub_data_stru->center_result_code[0] == 0) {
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c:    headLen = _get_field_data_safe(pub_data_stru, FIELD_TPDU, pub_data_stru->in_msg_type, tmpBuf, 0,sizeof(tmpBuf));
general_util.c:    bufLen = pub_data_stru->src_len;
general_util.c:        buf = pub_data_stru->src_buffer + headLen;
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c:    len = get_field_data_safe(pub_data_stru, FIELD_ORG_TRANS_INFO, pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
general_util.c:    get_field_data_safe(pub_data_stru, FIELD_INSTI_CODE, pub_data_stru->in_msg_type, TransLog.acq_insti_code,9);
general_util.c:        len=get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
general_util.c:        if(0>(len=get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal)))) {
general_util.c:                strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
general_util.c:        strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
general_util.c:    if(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) != 0 &&
general_util.c:       strcmp(pub_data_stru->center_result_code, CODE_NOT_EXIST) != 0) {
general_util.c:        if(0 < pub_data_stru->timeout_table.num--) {
general_util.c:            pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
general_util.c:        dcs_debug(0,0,"<%s> timeout num=[%d]",__FUNCTION__,pub_data_stru->timeout_table.num);
general_util.c:                strcpy(msgkey, pub_data_stru->timeout_table.first_key);
general_util.c:                    dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
general_util.c:    snprintf(msgkey,sizeof(msgkey),"%s", pub_data_stru->timeout_table.first_key);
general_util.c:        dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
general_util.c:    if(!(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) == 0 ||
general_util.c:         strcmp(pub_data_stru->center_result_code, CODE_NOT_EXIST) == 0)) {
general_util.c:            pub_data_stru->timeout_table.flag[0]  = '2';
general_util.c:            write_voidtrans_to_fold(&pub_data_stru->timeout_table);
general_util.c:    if(64 > get_field_data_safe(pub_data_stru, FIELD_KEY, pub_data_stru->in_msg_type, tmpbuf,sizeof(tmpbuf))) {
general_util.c:    memcpy(pub_data_stru->in_mac_key, tmpbuf, 32);
general_util.c:    memcpy(pub_data_stru->in_pin_key, tmpbuf, 32);
general_util.c:    return update_key(pub_data_stru->insti_code, pub_data_stru->in_mac_key, pub_data_stru->in_pin_key);
general_util.c:    i=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "121"),
general_util.c:                          pub_data_stru->in_msg_type, tmp,sizeof(tmp));
general_util.c:    dcs_debug(0,0,"<%s> flag=[%c],center_result_code=[%s]",__FUNCTION__,flag,pub_data_stru->center_result_code);
general_util.c:    if(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) != 0 ||
general_util.c:        if(0 < pub_data_stru->timeout_table.num--) {
general_util.c:            pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
general_util.c:        snprintf(msgkey,sizeof(msgkey),"%s", pub_data_stru->timeout_table.first_key);
general_util.c:            dcs_log(0, 0, "<FILE:%s,LINE:%d %s>解析first_key[%s]失败！", __FILE__, __LINE__, __FUNCTION__,pub_data_stru->timeout_table.first_key);
general_util.c:        i=_get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "15"),
general_util.c:                               pub_data_stru->in_msg_type, tmp,0 ,sizeof(tmp));
general_util.c:            if(0 < pub_data_stru->timeout_table.num--) {
general_util.c:                pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
general_util.c:    strcpy(ret_code,pub_data_stru->center_result_code);
general_util.c:    if(memcmp(pub_data_stru->center_result_code, "FC", strlen(pub_data_stru->center_result_code)) ==0) {
general_util.c:        if(0 < pub_data_stru->timeout_table.num--) {
general_util.c:            pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
general_util.c:        strcpy(msgkey, pub_data_stru->timeout_table.first_key);
general_util.c:            dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
general_util.c:        i=_get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "15"),
general_util.c:                               pub_data_stru->in_msg_type, tmp,0 ,sizeof(tmp));
general_util.c:            if(0 < pub_data_stru->timeout_table.num--) {
general_util.c:                pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
general_util.c:    if(strcmp(pub_data_stru->in_msg_type,"ZPOS")==0) {
general_util.c:        snprintf(pub_data_stru->route_msg_type,5,"%s",pub_data_stru->in_msg_type);
general_util.c:        snprintf(pub_data_stru->route_insti_code,9,"%s",pub_data_stru->insti_code);
general_util.c:        snprintf(pub_data_stru->route_fold_name,40,"%s",pub_data_stru->insti_fold_name);
general_util.c:        snprintf(pub_data_stru->route_trans_type,5,"%s",pub_data_stru->in_trans_type);
general_util.c:        pub_data_stru->tmp_order[0]=0x30;
general_util.c:    len = get_field_data_safe(pub_data_stru, FIELD_ORG_TRANS_INFO, pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
general_util.c:    if(strcmp(pub_data_stru->in_msg_type,"ZPOS")==0) {
general_util.c:        get_field_data_safe(pub_data_stru, 20, pub_data_stru->in_msg_type, TransLog.acq_term_id1,17);
general_util.c:    } else if(strcmp(pub_data_stru->in_msg_type,"LINS")==0) {
general_util.c:        get_field_data_safe(pub_data_stru, 41, pub_data_stru->in_msg_type, TransLog.acq_term_id1,17);
general_util.c:        get_field_data_safe(pub_data_stru, 42, pub_data_stru->in_msg_type, TransLog.acq_term_id2,17);
general_util.c:    get_field_data_safe(pub_data_stru, FIELD_INSTI_CODE, pub_data_stru->in_msg_type, TransLog.acq_insti_code,9);
general_util.c:        len=get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
general_util.c:        memset(pub_data_stru->timeout_table.first_key, 0, sizeof(pub_data_stru->timeout_table.first_key));
general_util.c:        snprintf(pub_data_stru->timeout_table.first_key,sizeof(pub_data_stru->timeout_table.first_key), "%s,%s,%s,%s,%s,%s,%s",
general_util.c:                 pub_data_stru->in_msg_type, TransLog.sys_date,TransLog.acq_insti_code,TransLog.acq_tra_no,TransLog.acq_date,TransLog.acq_term_id1,TransLog.acq_term_id2);
general_util.c://      sprintf(pub_data_stru->timeout_table.first_key, "%s,%s,%s,%s,%s,%s", TransLog.
general_util.c:        memcpy(pub_data_stru->timeout_table.sys_date, tmp, 8);
general_util.c:        memcpy(pub_data_stru->timeout_table.sys_time, tmp + 8, 6);
general_util.c:        strcpy(pub_data_stru->timeout_table.foldname, SYSTEM_FOLDNAME);
general_util.c:        snprintf(pub_data_stru->timeout_table.key,sizeof(pub_data_stru->timeout_table.key) ,"%s",pub_data_stru->timeout_table.first_key);
general_util.c:        pub_data_stru->timeout_table.num = 30;
general_util.c:        strcpy(pub_data_stru->timeout_table.flag, "2");
general_util.c:        write_voidtrans_to_fold(&pub_data_stru->timeout_table);
general_util.c:            strcpy(pub_data_stru->center_result_code, "00");
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_PROCESSING);
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_NOT_EXIST);
general_util.c:    if(0 > get_key_info(pub_data_stru->insti_code, mac_tek_indx, sizeof(mac_tek_indx), mac_tm_key, sizeof(mac_tm_key),
general_util.c:    if(0 > DESTMKGETPIKMAK2(return_code, pub_data_stru->in_mac_index, mac_tek_indx, mac_tm_key, key_data1, key_data2, check_value, "Y", "Y")) {
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c:    memcpy(pub_data_stru->in_mac_key, key_data1, 32);
general_util.c:    if(0 > DESTMKGETPIKMAK2(return_code, pub_data_stru->in_pin_index, pin_tek_indx, pin_tm_key, key_data1, key_data2, check_value, "Y", "Y")) {
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c:    memcpy(pub_data_stru->in_pin_key, key_data1, 32);
general_util.c:    add_pub_field(pub_data_stru, FIELD_KEY, pub_data_stru->in_msg_type, 64, tmpbuf, 1);
general_util.c:    return update_key(pub_data_stru->insti_code, pub_data_stru->in_mac_key, pub_data_stru->in_pin_key);
general_util.c:    f_len = _get_field_data_safe(pub_data_stru, d_fldid, pub_data_stru->in_msg_type, buff, d_flag,sizeof(buff));
general_util.c:    return SetFieldData(pub_data_stru->timeout_table.remark, fldid, t_buf, sizeof(pub_data_stru->timeout_table.remark), 1);
general_util.c:    f_len = GetFieldData(pub_data_stru->timeout_table.remark, d_fldid, buff, sizeof(buff), 1);
general_util.c:    return add_pub_field(pub_data_stru, fldid, pub_data_stru->in_msg_type, f_len, t_buf, 1);
general_util.c:    msg_type = flag ? pub_data_stru->route_msg_type : pub_data_stru->in_msg_type;
general_util.c:        ret = GenMac3Des(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, macBuf, mac_offset, mac);
general_util.c:        ret = GenMac3Des(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, macBuf, mac_offset, mac);
general_util.c:    if(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code))) {
general_util.c:            pub_data_stru->timeout_table.flag[0] = '2';
general_util.c:            pub_data_stru->timeout_table.flag[0] = '0';
general_util.c:    strcpy(TransLog.resp_cd_rcv, pub_data_stru->center_result_code);
general_util.c:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_RECODE, pub_data_stru->in_msg_type,
general_util.c:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_AUTH_ID, pub_data_stru->in_msg_type,
general_util.c:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_SYS_REF_NO, pub_data_stru->in_msg_type,
general_util.c:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_SETTLE_DATE, pub_data_stru->in_msg_type,
general_util.c:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
general_util.c:    if(pub_data_stru->timeout_table.flag[0] == '1' ||  pub_data_stru->timeout_table.flag[0] == '2')
general_util.c:        SetTransLog(&TransLog, "APP_MSG_TYPE", pub_data_stru->route_msg_type, 0, pub_data_stru);
general_util.c:        SetTransLog(&TransLog, "APP_TRANS_TYPE", pub_data_stru->route_trans_type, 0, pub_data_stru);
general_util.c:        if(0 <(len=_get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type,
general_util.c:        if(0 <(len= _get_field_data_safe(pub_data_stru, FIELD_INSTI_CODE, pub_data_stru->in_msg_type,
general_util.c:        if(0 < (len= _get_field_data_safe(pub_data_stru, FIELD_TERM_ID1, pub_data_stru->in_msg_type,
general_util.c:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TERM_ID2, pub_data_stru->in_msg_type,
general_util.c:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_DATE, pub_data_stru->in_msg_type,
general_util.c:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TIME, pub_data_stru->in_msg_type,
general_util.c:        if(0 <(len= _get_field_data_safe(pub_data_stru, FIELD_TRA_NO, pub_data_stru->in_msg_type,
general_util.c:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_RECODE, pub_data_stru->in_msg_type,
general_util.c:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_AUTH_ID, pub_data_stru->in_msg_type,
general_util.c:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_SYS_REF_NO, pub_data_stru->in_msg_type,
general_util.c:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_SETTLE_DATE, pub_data_stru->in_msg_type,
general_util.c:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
general_util.c:    if(pub_data_stru->timeout_table.flag[0] == '1' ||  pub_data_stru->timeout_table.flag[0] == '2')
general_util.c:        strcpy(TransLog.resp_cd_rcv, pub_data_stru->center_result_code);
general_util.c:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_RECODE, pub_data_stru->in_msg_type,
general_util.c:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
general_util.c:        SetTransLog(&TransLog, "PAY_MSG_TYPE", pub_data_stru->route_msg_type, 0, pub_data_stru);
general_util.c:        SetTransLog(&TransLog, "PAY_TRANS_TYPE", pub_data_stru->route_trans_type, 0, pub_data_stru);
general_util.c:        if(0 <(len=_get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type,
general_util.c:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_INSTI_CODE, pub_data_stru->in_msg_type,
general_util.c:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TERM_ID1, pub_data_stru->in_msg_type,
general_util.c:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TERM_ID2, pub_data_stru->in_msg_type,
general_util.c:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_DATE, pub_data_stru->in_msg_type,
general_util.c:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TIME, pub_data_stru->in_msg_type,
general_util.c:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TRA_NO, pub_data_stru->in_msg_type,
general_util.c:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_RECODE, pub_data_stru->in_msg_type,
general_util.c:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
general_util.c:    if(0>folder_to_insti_code(pub_data_stru->insti_fold_name,
general_util.c:                              pub_data_stru->insti_code, sizeof(pub_data_stru->insti_fold_name)))
general_util.c:    if((i=get_field_data_safe(pub_data_stru,inst_field,pub_data_stru->in_msg_type,tmp,sizeof(tmp))) <=0)
general_util.c:        add_pub_field(pub_data_stru,inst_field,pub_data_stru->in_msg_type,
general_util.c:                      strlen(pub_data_stru->insti_code),pub_data_stru->insti_code, 0);
general_util.c:        if(strcmp(tmp,pub_data_stru->insti_code)!=0) {
general_util.c:                    __FUNCTION__,tmp,pub_data_stru->insti_code);
general_util.c:    snprintf(pub_data_stru->route_insti_code,9,"%s", pub_data_stru->insti_code);
general_util.c:    snprintf(pub_data_stru->route_msg_type  ,5,"%s", pub_data_stru->in_msg_type);
general_util.c:    snprintf(pub_data_stru->route_fold_name ,40,"%s", pub_data_stru->insti_fold_name);
general_util.c:    snprintf(pub_data_stru->route_mac_index ,6 ,"%s",pub_data_stru->in_mac_index);
general_util.c:    snprintf(pub_data_stru->route_mac_key   ,33 ,"%s",pub_data_stru->in_mac_key);
general_util.c:    snprintf(pub_data_stru->route_trans_type, 5,"%s",pub_data_stru->in_trans_type);
general_util.c:    pub_data_stru->route_is_check_mac=pub_data_stru->is_check_mac;
general_util.c:    pub_data_stru->route_insti_work_type=pub_data_stru->insti_work_type;
general_util.c:    if(pub_data_stru->center_result_code[0] == 0)
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
general_util.c:        i=get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, card_no,sizeof(card_no));
general_util.c:            add_pub_field(pub_data_stru,FIELD_AMOUNT_REAL,pub_data_stru->in_msg_type,12,begin_amount, 0);
general_util.c:        if(pub_data_stru->switch_src_flag == 0)
general_util.c:        strcpy(pub_data_stru->center_result_code, CODE_CUPS_NOT_OPERATE);
general_util.c:    snprintf(msgkey,sizeof(msgkey),"%s", pub_data_stru->timeout_table.first_key);
general_util.c:        dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
general_util.c:    pub_data_stru->switch_src_flag=1;
general_util.c:                             DB_MSG_TYPE, pub_data_stru->route_insti_code, 2,9);
general_util.c:                             DB_MSG_TYPE, pub_data_stru->route_trans_type, 2,5);
general_util.c:    if(memcmp(pub_data_stru->in_msg_type, "TPOS", 4)) {
general_util.c:                                  pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c:                                pub_data_stru->in_msg_type, TransLog.acq_insti_code,9);
general_util.c:            strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
general_util.c:        if(11 >= (len = get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "3B"),
general_util.c:                                            pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal)))) {
general_util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c:        add_pub_field(pub_data_stru, FIELD_IC_DATA, pub_data_stru->in_msg_type, len - 11, fieldVal + 11, 1);
general_util.c:        get_field_data_safe(pub_data_stru, FIELD_PSAM_NO, pub_data_stru->in_msg_type, TransLog.acq_term_id1,17);
general_util.c:            strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
general_util.c:    if(pub_data_stru->req_flag) {
general_util.c:    		msg_type = pub_data_stru->in_msg_type;
general_util.c:    if(flag && memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) == 0)
general_util.c:        return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c:    return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c.bak:    pub_data_stru->src_buffer=NULL;
general_util.c.bak:    pub_data_stru->src_len=0;
general_util.c.bak:    pub_data_stru->req_flag=0; //1为请求交易，其他为应答交易
general_util.c.bak:    pub_data_stru->switch_src_flag = 0; // 1为转接到原受理机构，其他为转接到其他目的机构
general_util.c.bak:    pub_data_stru->insti_code[0]=0x00;    //发送报文的机构代码
general_util.c.bak:    pub_data_stru->insti_fold_name[0] = 0x00;//发送报文通信用的fold名字
general_util.c.bak:    pub_data_stru->insti_open_flag = 0x00;  //发送机构打开标识,0关闭,1打开
general_util.c.bak:    pub_data_stru->insti_link_type =0x00;  //发送机构链路标识，0,长连接 1,短连接
general_util.c.bak:    pub_data_stru->insti_work_type =0x00;  //发送机构交易接入模式 0,机构 ,1 终端
general_util.c.bak:    pub_data_stru->in_priv_def = NULL;    //进入报文种类数据域定义指针
general_util.c.bak:    pub_data_stru->in_msg_type[0] = 0x00; //进入报文的报文类型
general_util.c.bak:    pub_data_stru->in_mastkey[0] = 0x00;
general_util.c.bak:    pub_data_stru->in_mac_index[0] = 0x00;
general_util.c.bak:    pub_data_stru->in_mac_key[0] = 0x00;
general_util.c.bak:    pub_data_stru->in_pin_index[0] = 0x00;
general_util.c.bak:    pub_data_stru->in_pin_key[0] = 0x00 ;
general_util.c.bak:    pub_data_stru->in_data_index[0] = 0x00;
general_util.c.bak:    pub_data_stru->in_data_key[0] = 0x00 ;
general_util.c.bak:    pub_data_stru->is_check_mac = 0x00 ;//是否校验mac
general_util.c.bak:    pub_data_stru->msg_key[0] = 0x00 ; //报文关键字
general_util.c.bak:    pub_data_stru->app_type[0] = 0x00 ; //业务类型
general_util.c.bak:    pub_data_stru->in_trans_type[0] = 0x00;//进入交易类型
general_util.c.bak:    pub_data_stru->open_flag =0x00;//业务打开标识 0关闭，1打开
general_util.c.bak:    pub_data_stru->is_route = 0x00;//是否路由 0：转发初始接入点，1：业务下一路由节点，2：处理结束,3:原始交易路由节点
general_util.c.bak:    pub_data_stru->route_num = 0; //交易被路由的次数
general_util.c.bak:    pub_data_stru->step_type = 1; // 1 支付渠道，2业务渠道
general_util.c.bak:    pub_data_stru->route_insti_code[0] = 0x00;// 路由机构代码
general_util.c.bak:    pub_data_stru->route_fold_name[0] = 0x00;//路由报文通信用的fold名字
general_util.c.bak:    pub_data_stru->route_is_make_mac=0x00;//是否产生mac
general_util.c.bak:    pub_data_stru->route_insti_open_flag=0x00;//路由机构打开标识 0关闭,1打开
general_util.c.bak:    pub_data_stru->route_insti_link_type=0x00;  //路由机构链路标识，0,长连接 1,短连接
general_util.c.bak:    pub_data_stru->route_insti_work_type = 0x00;  //路由机构交易接入模式 0,机构 ,1 终端
general_util.c.bak:    pub_data_stru->route_is_check_mac = 0x00;
general_util.c.bak:    pub_data_stru->route_msg_type[0] = 0x00;//路由转换的报文类型
general_util.c.bak:    pub_data_stru->route_trans_type[0] = 0x00; //路由转换的交易类型
general_util.c.bak:    pub_data_stru->route_priv_def = NULL;       //路由的报文种类数据域定义指针
general_util.c.bak:    pub_data_stru->route_set.num=0;//转发的报文数据域ID集合
general_util.c.bak:    pub_data_stru->route_mastkey[0] = 0x00;
general_util.c.bak:    pub_data_stru->route_mac_index[0] =0x00;
general_util.c.bak:    pub_data_stru->route_mac_key[0]= 0x00;
general_util.c.bak:    pub_data_stru->route_pin_index[0] = 0x00;
general_util.c.bak:    pub_data_stru->route_pin_key[0] =0x00 ;
general_util.c.bak:    pub_data_stru->route_data_index[0] = 0x00;
general_util.c.bak:    pub_data_stru->route_data_key[0] = 0x00;
general_util.c.bak:    pub_data_stru->center_result_code[0] = 0x00;//中心处理结果代码
general_util.c.bak:    pub_data_stru->is_void = 0x00;             //是否需要冲正处理 ,0不冲正，1需要
general_util.c.bak:    pub_data_stru->permit_void = 0x00;         // 应用是否许可受理方发起冲正
general_util.c.bak:    pub_data_stru->use_timeout = 0x00 ;         //使用超时表标志
general_util.c.bak:    pub_data_stru->timeout_table.foldname[0]=0x00;//超时表存放的数据
general_util.c.bak:    pub_data_stru->timeout_table.sys_date[0]=0x00;
general_util.c.bak:    pub_data_stru->timeout_table.sys_time[0]=0x00;
general_util.c.bak:    pub_data_stru->timeout_table.key[0]=0x00;
general_util.c.bak:    pub_data_stru->timeout_table.flag[0]=0x00;
general_util.c.bak:    pub_data_stru->timeout_table.num=0;
general_util.c.bak:    pub_data_stru->timeout_table.invalid_time=0;
general_util.c.bak:    pub_data_stru->timeout_table.first_key[0]=0x00;
general_util.c.bak:    pub_data_stru->timeout_table.trans_type[0]=0x00;
general_util.c.bak:    pub_data_stru->timeout_table.remark[0] = 0x00;
general_util.c.bak:    pub_data_stru->filed_key_num=0; //关键域字段个数
general_util.c.bak:    pub_data_stru->msg_field_num = 0; //报文域总数
general_util.c.bak:    pub_data_stru->timeout = 0;
general_util.c.bak://  memset(&pub_data_stru->data_rec[0],0x00,sizeof(field_data)*MAX_FIELD) ; //报文域数据解析
general_util.c.bak:    memset(pub_data_stru->tmp_order,0x00,5);         //特殊报文使用的指令表示区
general_util.c.bak:    pub_data_stru->in_cry_flag=0x00; // 进入国密算法应用标识 默认0不应用，1应用
general_util.c.bak:    pub_data_stru->out_cry_flag=0x00; //出去国密算法应用标识 默认0不应用，1应用
general_util.c.bak:    pub_data_stru->off_set=0;         //buffer使用偏移量
general_util.c.bak:    pub_data_stru->buffer[0]=0x00; //数据存放区
general_util.c.bak:    if((data_len <0) || ((MAX_BUFFER - pub_data_stru->off_set) < data_len)) {
general_util.c.bak:    if(pub_data_stru->msg_field_num >=MAX_FIELD || id <0) {
general_util.c.bak:    for(i=0 ; i<pub_data_stru->msg_field_num ; i++) {
general_util.c.bak:        if(id == pub_data_stru->data_rec[i].field_id &&
general_util.c.bak:           from == pub_data_stru->data_rec[i].from &&
general_util.c.bak:           memcmp(msg_type,pub_data_stru->data_rec[i].msg_type,4)==0 &&
general_util.c.bak:           pub_data_stru->data_rec[i].Off ==1) {
general_util.c.bak:                pub_data_stru->data_rec[i].len=0;
general_util.c.bak:                if(pub_data_stru->data_rec[i].data_addr+pub_data_stru->data_rec[i].len != pub_data_stru->buffer+pub_data_stru->off_set) {
general_util.c.bak:                    if((MAX_BUFFER - pub_data_stru->off_set) <= (pub_data_stru->data_rec[i].len+1+data_len)) {
general_util.c.bak:                    if(pub_data_stru->data_rec[i].len <2048) {
general_util.c.bak:						//dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->data_rec[i].len);
general_util.c.bak:                        memcpy(caBuf,pub_data_stru->data_rec[i].data_addr,pub_data_stru->data_rec[i].len);
general_util.c.bak:                                __FUNCTION__,pub_data_stru->data_rec[i].len);
general_util.c.bak:                    pub_data_stru->data_rec[i].data_addr= pub_data_stru->buffer+pub_data_stru->off_set;
general_util.c.bak:                    pub_data_stru->off_set= pub_data_stru->off_set+pub_data_stru->data_rec[i].len;
general_util.c.bak:					//dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->data_rec[i].len);
general_util.c.bak:                    memcpy(pub_data_stru->data_rec[i].data_addr,caBuf,pub_data_stru->data_rec[i].len);
general_util.c.bak:                pub_data_stru->buffer[pub_data_stru->off_set]=0x00;
general_util.c.bak:                pub_data_stru->off_set++;
general_util.c.bak:                pub_data_stru->data_rec[i].len++;
general_util.c.bak:            pub_data_stru->msg_field_num--;
general_util.c.bak:    if(s <0)  i=pub_data_stru->msg_field_num;
general_util.c.bak:    pub_data_stru->data_rec[i].field_id = id;
general_util.c.bak:        pub_data_stru->data_rec[i].data_addr=pub_data_stru->buffer+pub_data_stru->off_set;
general_util.c.bak:    pub_data_stru->data_rec[i].Off=1;
general_util.c.bak:    pub_data_stru->data_rec[i].from=from;
general_util.c.bak:    memcpy(pub_data_stru->data_rec[i].data_addr+pub_data_stru->data_rec[i].len,data,data_len);
general_util.c.bak:    memcpy(pub_data_stru->data_rec[i].msg_type, msg_type, 4); //2016/7/20 星期三 下午 4:54:48 data_rec.msg_type
general_util.c.bak:    pub_data_stru->data_rec[i].len=pub_data_stru->data_rec[i].len+data_len;
general_util.c.bak:    pub_data_stru->off_set=pub_data_stru->off_set+data_len;
general_util.c.bak:    pub_data_stru->msg_field_num++;
general_util.c.bak:    return pub_data_stru->data_rec[i].len;
general_util.c.bak:    if((data_len <0) || ((MAX_BUFFER - pub_data_stru->off_set) < data_len)) {
general_util.c.bak:    for(i=0 ; i<pub_data_stru->msg_field_num ; i++) {
general_util.c.bak:        if(id == pub_data_stru->data_rec[i].field_id &&
general_util.c.bak:           from == pub_data_stru->data_rec[i].from &&
general_util.c.bak:           memcmp(msg_type,pub_data_stru->data_rec[i].msg_type,4)==0 &&
general_util.c.bak:           pub_data_stru->data_rec[i].Off ==1) {
general_util.c.bak:                pub_data_stru->data_rec[i].len=0;
general_util.c.bak:            if(data_len > pub_data_stru->data_rec[i].len) {
general_util.c.bak:                if(pub_data_stru->data_rec[i].data_addr+pub_data_stru->data_rec[i].len != pub_data_stru->buffer+pub_data_stru->off_set) {
general_util.c.bak:        pub_data_stru->data_rec[i].data_addr=pub_data_stru->buffer+pub_data_stru->off_set;
general_util.c.bak:    memcpy(pub_data_stru->data_rec[i].data_addr,data,data_len);
general_util.c.bak:    pub_data_stru->data_rec[i].len=data_len;
general_util.c.bak:        pub_data_stru->off_set=pub_data_stru->off_set+data_len;
general_util.c.bak:        pub_data_stru->off_set= pub_data_stru->data_rec[i].data_addr - pub_data_stru->buffer+data_len;
general_util.c.bak:    for(i=0 ; i<pub_data_stru->msg_field_num ; i++) {
general_util.c.bak:        if(id == pub_data_stru->data_rec[i].field_id &&
general_util.c.bak:           from == pub_data_stru->data_rec[i].from &&
general_util.c.bak:           memcmp(msg_type,pub_data_stru->data_rec[i].msg_type,4)==0 &&
general_util.c.bak:           pub_data_stru->data_rec[i].Off ==1) {
general_util.c.bak://          pub_data_stru->data_rec[i].Off=0;                       // 2016/7/21 星期四 下午 2:37:58 modified
general_util.c.bak:            if(i != pub_data_stru->msg_field_num-1) {            // 2016/7/21 星期四 下午 2:37:51 modified
general_util.c.bak:                memcpy(&pub_data_stru->data_rec[i],
general_util.c.bak:                       &pub_data_stru->data_rec[pub_data_stru->msg_field_num-1],
general_util.c.bak:            pub_data_stru->data_rec[pub_data_stru->msg_field_num-1].len=0;
general_util.c.bak:            pub_data_stru->msg_field_num--;
general_util.c.bak:    for(i=0; i<pub_data_stru->msg_field_num; i++) {
general_util.c.bak:        if(field_id == pub_data_stru->data_rec[i].field_id &&
general_util.c.bak:           memcmp(msg_type, pub_data_stru->data_rec[i].msg_type,4)==0 &&
general_util.c.bak:           pub_data_stru->data_rec[i].Off) {
general_util.c.bak:            //dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,MIN(pub_data_stru->data_rec[i].len,size-1));
general_util.c.bak:            memcpy(data,pub_data_stru->data_rec[i].data_addr,
general_util.c.bak:                   MIN(pub_data_stru->data_rec[i].len,size-1));
general_util.c.bak:            data[MIN(pub_data_stru->data_rec[i].len,size-1)]=0x00;
general_util.c.bak:            return MIN(pub_data_stru->data_rec[i].len,size-1);
general_util.c.bak:    for(i=0; i<pub_data_stru->msg_field_num; i++) {
general_util.c.bak:        if(field_id == pub_data_stru->data_rec[i].field_id &&
general_util.c.bak:           memcmp(msg_type,pub_data_stru->data_rec[i].msg_type,4)==0 &&
general_util.c.bak:           pub_data_stru->data_rec[i].Off &&
general_util.c.bak:           pub_data_stru->data_rec[i].from== flag) {
general_util.c.bak:            //dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,MIN(pub_data_stru->data_rec[i].len,size-1));
general_util.c.bak:            memcpy(data,pub_data_stru->data_rec[i].data_addr,
general_util.c.bak:                   MIN(pub_data_stru->data_rec[i].len,size-1));
general_util.c.bak:            data[MIN(pub_data_stru->data_rec[i].len,size-1)]=0x00;
general_util.c.bak:            return MIN(pub_data_stru->data_rec[i].len,size-1);
general_util.c.bak:    return snprintf(msg_type,size,"%s",pub_data_stru->in_msg_type);
general_util.c.bak:    return snprintf(pub_data_stru->center_result_code,5,"%s",ret_code);
general_util.c.bak:    return !pub_data_stru->route_insti_open_flag;
general_util.c.bak:    return pub_data_stru->route_insti_link_type;
general_util.c.bak:    return pub_data_stru->insti_open_flag;
general_util.c.bak:        dcs_log(0, 0, "<%s>接收机构[%s]已关闭！",   __FUNCTION__, pub_data_stru->route_insti_code);
general_util.c.bak:    iDescFid = fold_locate_folder(pub_data_stru->route_fold_name);
general_util.c.bak:        dcs_log(0, 0, "<%s>取接收机构fold name[%s]出错！",  __FUNCTION__, pub_data_stru->route_fold_name);
general_util.c.bak:        if(IsReady((const char *)pub_data_stru->route_fold_name) < 0) {
general_util.c.bak:        pub_data_stru->in_cry_flag =1;
general_util.c.bak:        pub_data_stru->in_cry_flag =0;
general_util.c.bak:        pub_data_stru->out_cry_flag =1;
general_util.c.bak:        pub_data_stru->out_cry_flag =0;
general_util.c.bak:    set = &pub_data_stru->route_set;
general_util.c.bak:    set = &pub_data_stru->route_set;
general_util.c.bak:    switch(pub_data_stru->timeout_table.flag[0]) {
general_util.c.bak:            pub_data_stru->timeout_table.flag[0]++;
general_util.c.bak:    write_voidtrans_to_fold(&pub_data_stru->timeout_table);
general_util.c.bak://  add_pub_field(pub_data_stru,FIELD_DATE_TIME_Y, pub_data_stru->route_msg_type,
general_util.c.bak:            add_pub_field(pub_data_stru,fldid, pub_data_stru->route_msg_type,
general_util.c.bak:            add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c.bak:            add_pub_field(pub_data_stru,fldid, pub_data_stru->route_msg_type,
general_util.c.bak:            add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c.bak:    if(0 <= get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,para),
general_util.c.bak:                                pub_data_stru->in_msg_type, tmpBuf,2)) {
general_util.c.bak:                                       pub_data_stru->in_msg_type, tmpBuf,1)) {
general_util.c.bak:                                       pub_data_stru->in_msg_type,tmpBuf,1)) {
general_util.c.bak:                                pub_data_stru->route_msg_type, tmpBuf,1)) {
general_util.c.bak:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type, 3,
general_util.c.bak:                    msgtype = pub_data_stru->route_msg_type;
general_util.c.bak:                    msgtype = pub_data_stru->in_msg_type;
general_util.c.bak:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c.bak:                                   get_pub_field_id(pub_data_stru->in_msg_type,para),
general_util.c.bak:                                   pub_data_stru->in_msg_type,fieldVal,sizeof(fieldVal));
general_util.c.bak:    if(flag && memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) == 0)
general_util.c.bak:        return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c.bak:    return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c.bak:    if(pub_data_stru->route_num == 0 && pub_data_stru->switch_src_flag == 1)
general_util.c.bak:            return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c.bak:    return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c.bak:    return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c.bak:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c.bak:    if((flag && pub_data_stru->out_cry_flag) ||
general_util.c.bak:       (!flag && pub_data_stru->in_cry_flag)) {
general_util.c.bak:        if(pub_data_stru->out_cry_flag)
general_util.c.bak:            i = GenMacSM(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, buf, bufLen, macAsc);
general_util.c.bak:            i = GenMac3Des(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, buf, bufLen, macAsc);
general_util.c.bak:        if(pub_data_stru->in_cry_flag)
general_util.c.bak:            i= GenMacSM(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc);
general_util.c.bak:            i = GenMac3Des(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc);
general_util.c.bak:    if(pub_data_stru->out_cry_flag) {
general_util.c.bak:        i = GenMac(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, buf, bufLen, macAsc);
general_util.c.bak:        i = GenMac(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc);
general_util.c.bak:    dcs_debug(0,0,"<%s> POS_ENTRY_MD_CD=%d, req_flag=%d,fldid=%d",__FUNCTION__,POS_ENTRY_MD_CD,pub_data_stru->req_flag,fldid);
general_util.c.bak:    if(pub_data_stru->req_flag) {
general_util.c.bak:        if(0>=get_field_data_safe(pub_data_stru,POS_ENTRY_MD_CD,  pub_data_stru->in_msg_type,
general_util.c.bak:        l = get_field_data_safe(pub_data_stru,inFldid, pub_data_stru->in_msg_type,
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c.bak:            l = get_field_data_safe(pub_data_stru,FIELD_CARD_NO,  pub_data_stru->in_msg_type,
general_util.c.bak:                strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c.bak:        if(0>DESTRANSPIN2(reCode,  pub_data_stru->in_pin_index, pub_data_stru->route_pin_index, pub_data_stru->in_pin_key, pub_data_stru->route_pin_key, pinBin, inPan, pinNewBuf, outPan)) {
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_PIN_ERR);
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_PIN_ERR);
general_util.c.bak:            add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,16,
general_util.c.bak:            add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c.bak:    len = _get_field_data_safe(pub_data_stru,fieldid,pub_data_stru->route_msg_type,
general_util.c.bak:            i=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, tmp),
general_util.c.bak:                                  pub_data_stru->in_msg_type,
general_util.c.bak:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c.bak:    if(strcmp(pub_data_stru->in_msg_type,"TPOS")==0 &&
general_util.c.bak:                              pub_data_stru->in_msg_type,fieldVal,sizeof(fieldVal))) >0) {
general_util.c.bak:            return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c.bak:            i=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, tmp),
general_util.c.bak:                                  pub_data_stru->in_msg_type,
general_util.c.bak:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c.bak:            i=get_field_data_safe(pub_data_stru,atoi(tmp), pub_data_stru->in_msg_type,
general_util.c.bak:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c.bak:            return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c.bak:            return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c.bak:        else return add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
general_util.c.bak:    len=get_field_data_safe(pub_data_stru,POS_ENTRY_MD_CD, pub_data_stru->route_msg_type,
general_util.c.bak:        add_pub_field(pub_data_stru,fldid,pub_data_stru->route_msg_type,
general_util.c.bak:        add_pub_field(pub_data_stru,fldid,pub_data_stru->route_msg_type,
general_util.c.bak:    if(pub_data_stru->route_num == 0 && pub_data_stru->switch_src_flag == 1) return 1;
general_util.c.bak:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
general_util.c.bak:    len=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "3D"),
general_util.c.bak:                            pub_data_stru->in_msg_type,tmp,sizeof(tmp));
general_util.c.bak:        del_pub_field(pub_data_stru,fldid,pub_data_stru->in_msg_type,1);
general_util.c.bak:    i=get_field_data_safe(pub_data_stru, 917, pub_data_stru->in_msg_type,
general_util.c.bak:    if(memcmp(pub_data_stru->route_insti_code,tmp,8)==0) {
general_util.c.bak:        memcpy(pub_data_stru->route_trans_type,tmp,4);
general_util.c.bak:    i=get_field_data_safe(pub_data_stru, POS_ENTRY_MD_CD, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf));
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c.bak:        l = get_field_data_safe(pub_data_stru, FIELD_TRACK2, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf));
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c.bak:        add_pub_field(pub_data_stru, FIELD_CARD_NO, pub_data_stru->route_msg_type, i, tmpBuf, 1);
general_util.c.bak:        l = get_field_data_safe(pub_data_stru, FIELD_IC_DATA, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf));
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c.bak:                      pub_data_stru->route_msg_type, strlen(tmpBuf), tmpBuf, 1);
general_util.c.bak:        if(0 < (l = get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf)))) {
general_util.c.bak:            add_pub_field(pub_data_stru, FIELD_CARD_NO, pub_data_stru->route_msg_type, l, tmpBuf, 1);
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c.bak:        if(0 < (l = get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf)))) {
general_util.c.bak:            add_pub_field(pub_data_stru, FIELD_CARD_NO, pub_data_stru->route_msg_type, l, tmpBuf, 1);
general_util.c.bak:    if(0 <(l= get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf)))) {
general_util.c.bak:    if(0 >(ret= get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, cardno,sizeof(cardno)))) {
general_util.c.bak:                                     pub_data_stru->route_msg_type, card_attr, 2,sizeof(card_attr)))) {
general_util.c.bak:    if(0 >(ret= get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type, tmpBuf,sizeof(tmpBuf)))) {
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_CARD_NO_ALLOW);
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_CARD_NO_ALLOW);
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
general_util.c.bak:            if(0 > AddUpTrans(cardno, &addup_amount, &addup_count, pub_data_stru->app_type, 0))
general_util.c.bak:                strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
general_util.c.bak:                strcpy(pub_data_stru->center_result_code, CODE_COUNT_LIMIT);
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
general_util.c.bak:            if(0 > AddUpTrans(cardno, &addup_amount, &addup_count, pub_data_stru->app_type, 0))
general_util.c.bak:                strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
general_util.c.bak:                strcpy(pub_data_stru->center_result_code, CODE_COUNT_LIMIT);
general_util.c.bak:    if(!pub_data_stru->is_check_mac) return 1;
general_util.c.bak:    macLen = _get_field_data_safe(pub_data_stru, FIELD_MAC, pub_data_stru->in_msg_type, inMacBuf, 0,sizeof(inMacBuf));
general_util.c.bak:        if(0 == strcmp(pub_data_stru->center_result_code, "00") || pub_data_stru->center_result_code[0] == 0) {
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c.bak:    def=get_priv_field_def_for_id(FIELD_MAC,match_priv_stru(pub_data_stru->in_msg_type,&gl_def_set));
general_util.c.bak:    headLen = _get_field_data_safe(pub_data_stru, FIELD_TPDU, pub_data_stru->in_msg_type, tmpBuf, 0,sizeof(tmpBuf));
general_util.c.bak:    def=get_priv_field_def_for_id(FIELD_TPDU,match_priv_stru(pub_data_stru->in_msg_type,&gl_def_set));
general_util.c.bak:        bufLen = pub_data_stru->src_len;
general_util.c.bak:        buf = pub_data_stru->src_buffer;
general_util.c.bak:        bufLen = pub_data_stru->src_len;
general_util.c.bak:        buf = pub_data_stru->src_buffer;
general_util.c.bak:    if(0 > GenMac(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc)) {
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c.bak:    def=get_priv_field_def_for_id(FIELD_MAC,match_priv_stru(pub_data_stru->in_msg_type,&gl_def_set));
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c.bak:    if(!pub_data_stru->is_check_mac) return 1;
general_util.c.bak:    macLen = _get_field_data_safe(pub_data_stru, FIELD_MAC, pub_data_stru->in_msg_type, inMacBuf, 0,sizeof(inMacBuf));
general_util.c.bak:        if(0 == strcmp(pub_data_stru->center_result_code, "00") || pub_data_stru->center_result_code[0] == 0) {
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c.bak:    def=get_priv_field_def_for_id(FIELD_MAC,match_priv_stru(pub_data_stru->in_msg_type,&gl_def_set));
general_util.c.bak:    if(0<(headLen = _get_field_data_safe(pub_data_stru, FIELD_TPDU, pub_data_stru->in_msg_type, tmpBuf, 0,sizeof(tmpBuf)))) {
general_util.c.bak:        def=get_priv_field_def_for_id(FIELD_TPDU,match_priv_stru(pub_data_stru->in_msg_type,&gl_def_set));
general_util.c.bak:    bufLen = pub_data_stru->src_len - headLen;
general_util.c.bak:    buf = pub_data_stru->src_buffer+headLen;
general_util.c.bak:    if(pub_data_stru->in_cry_flag) {
general_util.c.bak:    if(pub_data_stru->in_cry_flag) {
general_util.c.bak:        if(0 > GenMacSM(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc)) {
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c.bak:        if(0 > GenMac3Des(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc)) {
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c.bak:    if(!pub_data_stru->is_check_mac) return 1;
general_util.c.bak:    macLen = _get_field_data_safe(pub_data_stru, FIELD_MAC, pub_data_stru->in_msg_type, inMacBuf, 0,sizeof(inMacBuf));
general_util.c.bak:        if(0 == strcmp(pub_data_stru->center_result_code, "00") || pub_data_stru->center_result_code[0] == 0) {
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c.bak:    headLen = _get_field_data_safe(pub_data_stru, FIELD_TPDU, pub_data_stru->in_msg_type, tmpBuf, 0,sizeof(tmpBuf));
general_util.c.bak:    bufLen = pub_data_stru->src_len;
general_util.c.bak:        buf = pub_data_stru->src_buffer + headLen;
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
general_util.c.bak:    len = get_field_data_safe(pub_data_stru, FIELD_ORG_TRANS_INFO, pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
general_util.c.bak:    get_field_data_safe(pub_data_stru, FIELD_INSTI_CODE, pub_data_stru->in_msg_type, TransLog.acq_insti_code,9);
general_util.c.bak:        len=get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
general_util.c.bak:        if(0>(len=get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal)))) {
general_util.c.bak:                strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
general_util.c.bak:    if(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) != 0 &&
general_util.c.bak:       strcmp(pub_data_stru->center_result_code, CODE_NOT_EXIST) != 0) {
general_util.c.bak:        if(0 < pub_data_stru->timeout_table.num--) {
general_util.c.bak:            pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
general_util.c.bak:        dcs_debug(0,0,"<%s> timeout num=[%d]",__FUNCTION__,pub_data_stru->timeout_table.num);
general_util.c.bak:                strcpy(msgkey, pub_data_stru->timeout_table.first_key);
general_util.c.bak:                    dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
general_util.c.bak:    snprintf(msgkey,sizeof(msgkey),"%s", pub_data_stru->timeout_table.first_key);
general_util.c.bak:        dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
general_util.c.bak:    if(!(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) == 0 ||
general_util.c.bak:         strcmp(pub_data_stru->center_result_code, CODE_NOT_EXIST) == 0)) {
general_util.c.bak:            pub_data_stru->timeout_table.flag[0]  = '2';
general_util.c.bak:            write_voidtrans_to_fold(&pub_data_stru->timeout_table);
general_util.c.bak:    if(64 > get_field_data_safe(pub_data_stru, FIELD_KEY, pub_data_stru->in_msg_type, tmpbuf,sizeof(tmpbuf))) {
general_util.c.bak:    memcpy(pub_data_stru->in_mac_key, tmpbuf, 32);
general_util.c.bak:    memcpy(pub_data_stru->in_pin_key, tmpbuf, 32);
general_util.c.bak:    return update_key(pub_data_stru->insti_code, pub_data_stru->in_mac_key, pub_data_stru->in_pin_key);
general_util.c.bak:    i=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "121"),
general_util.c.bak:                          pub_data_stru->in_msg_type, tmp,sizeof(tmp));
general_util.c.bak:    dcs_debug(0,0,"<%s> flag=[%c],center_result_code=[%s]",__FUNCTION__,flag,pub_data_stru->center_result_code);
general_util.c.bak:    if(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) != 0 ||
general_util.c.bak:        if(0 < pub_data_stru->timeout_table.num--) {
general_util.c.bak:            pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
general_util.c.bak:        snprintf(msgkey,sizeof(msgkey),"%s", pub_data_stru->timeout_table.first_key);
general_util.c.bak:            dcs_log(0, 0, "<FILE:%s,LINE:%d %s>解析first_key[%s]失败！", __FILE__, __LINE__, __FUNCTION__,pub_data_stru->timeout_table.first_key);
general_util.c.bak:        i=_get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "15"),
general_util.c.bak:                               pub_data_stru->in_msg_type, tmp,0 ,sizeof(tmp));
general_util.c.bak:            if(0 < pub_data_stru->timeout_table.num--) {
general_util.c.bak:                pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
general_util.c.bak:    strcpy(ret_code,pub_data_stru->center_result_code);
general_util.c.bak:    if(memcmp(pub_data_stru->center_result_code, "FC", strlen(pub_data_stru->center_result_code)) ==0) {
general_util.c.bak:        if(0 < pub_data_stru->timeout_table.num--) {
general_util.c.bak:            pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
general_util.c.bak:        strcpy(msgkey, pub_data_stru->timeout_table.first_key);
general_util.c.bak:            dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
general_util.c.bak:        i=_get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "15"),
general_util.c.bak:                               pub_data_stru->in_msg_type, tmp,0 ,sizeof(tmp));
general_util.c.bak:            if(0 < pub_data_stru->timeout_table.num--) {
general_util.c.bak:                pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
general_util.c.bak:    if(strcmp(pub_data_stru->in_msg_type,"ZPOS")==0) {
general_util.c.bak:        snprintf(pub_data_stru->route_msg_type,5,"%s",pub_data_stru->in_msg_type);
general_util.c.bak:        snprintf(pub_data_stru->route_insti_code,9,"%s",pub_data_stru->insti_code);
general_util.c.bak:        snprintf(pub_data_stru->route_fold_name,40,"%s",pub_data_stru->insti_fold_name);
general_util.c.bak:        snprintf(pub_data_stru->route_trans_type,5,"%s",pub_data_stru->in_trans_type);
general_util.c.bak:        pub_data_stru->tmp_order[0]=0x30;
general_util.c.bak:    len = get_field_data_safe(pub_data_stru, FIELD_ORG_TRANS_INFO, pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
general_util.c.bak:    if(strcmp(pub_data_stru->in_msg_type,"ZPOS")==0) {
general_util.c.bak:        get_field_data_safe(pub_data_stru, 20, pub_data_stru->in_msg_type, TransLog.acq_term_id1,17);
general_util.c.bak:    } else if(strcmp(pub_data_stru->in_msg_type,"LINS")==0) {
general_util.c.bak:        get_field_data_safe(pub_data_stru, 41, pub_data_stru->in_msg_type, TransLog.acq_term_id1,17);
general_util.c.bak:        get_field_data_safe(pub_data_stru, 42, pub_data_stru->in_msg_type, TransLog.acq_term_id2,17);
general_util.c.bak:    get_field_data_safe(pub_data_stru, FIELD_INSTI_CODE, pub_data_stru->in_msg_type, TransLog.acq_insti_code,9);
general_util.c.bak:        len=get_field_data_safe(pub_data_stru, FIELD_AMOUNT, pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
general_util.c.bak:        memset(pub_data_stru->timeout_table.first_key, 0, sizeof(pub_data_stru->timeout_table.first_key));
general_util.c.bak:        snprintf(pub_data_stru->timeout_table.first_key,sizeof(pub_data_stru->timeout_table.first_key), "%s,%s,%s,%s,%s,%s,%s",
general_util.c.bak:                 pub_data_stru->in_msg_type, TransLog.sys_date,TransLog.acq_insti_code,TransLog.acq_tra_no,TransLog.acq_date,TransLog.acq_term_id1,TransLog.acq_term_id2);
general_util.c.bak://      sprintf(pub_data_stru->timeout_table.first_key, "%s,%s,%s,%s,%s,%s", TransLog.
general_util.c.bak:        memcpy(pub_data_stru->timeout_table.sys_date, tmp, 8);
general_util.c.bak:        memcpy(pub_data_stru->timeout_table.sys_time, tmp + 8, 6);
general_util.c.bak:        strcpy(pub_data_stru->timeout_table.foldname, SYSTEM_FOLDNAME);
general_util.c.bak:        snprintf(pub_data_stru->timeout_table.key,sizeof(pub_data_stru->timeout_table.key) ,"%s",pub_data_stru->timeout_table.first_key);
general_util.c.bak:        pub_data_stru->timeout_table.num = 30;
general_util.c.bak:        strcpy(pub_data_stru->timeout_table.flag, "2");
general_util.c.bak:        write_voidtrans_to_fold(&pub_data_stru->timeout_table);
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, "00");
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_PROCESSING);
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_NOT_EXIST);
general_util.c.bak:    if(0 > get_key_info(pub_data_stru->insti_code, mac_tek_indx, sizeof(mac_tek_indx), mac_tm_key, sizeof(mac_tm_key),
general_util.c.bak:    if(0 > DESTMKGETPIKMAK2(return_code, pub_data_stru->in_mac_index, mac_tek_indx, mac_tm_key, key_data1, key_data2, check_value, "Y", "Y")) {
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c.bak:    memcpy(pub_data_stru->in_mac_key, key_data1, 32);
general_util.c.bak:    if(0 > DESTMKGETPIKMAK2(return_code, pub_data_stru->in_pin_index, pin_tek_indx, pin_tm_key, key_data1, key_data2, check_value, "Y", "Y")) {
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
general_util.c.bak:    memcpy(pub_data_stru->in_pin_key, key_data1, 32);
general_util.c.bak:    add_pub_field(pub_data_stru, FIELD_KEY, pub_data_stru->in_msg_type, 64, tmpbuf, 1);
general_util.c.bak:    return update_key(pub_data_stru->insti_code, pub_data_stru->in_mac_key, pub_data_stru->in_pin_key);
general_util.c.bak:    f_len = _get_field_data_safe(pub_data_stru, d_fldid, pub_data_stru->in_msg_type, buff, d_flag,sizeof(buff));
general_util.c.bak:    return SetFieldData(pub_data_stru->timeout_table.remark, fldid, t_buf, sizeof(pub_data_stru->timeout_table.remark), 1);
general_util.c.bak:    f_len = GetFieldData(pub_data_stru->timeout_table.remark, d_fldid, buff, sizeof(buff), 1);
general_util.c.bak:    return add_pub_field(pub_data_stru, fldid, pub_data_stru->in_msg_type, f_len, t_buf, 1);
general_util.c.bak:    msg_type = flag ? pub_data_stru->route_msg_type : pub_data_stru->in_msg_type;
general_util.c.bak:        ret = GenMac3Des(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, macBuf, mac_offset, mac);
general_util.c.bak:        ret = GenMac3Des(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, macBuf, mac_offset, mac);
general_util.c.bak:    if(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code))) {
general_util.c.bak:            pub_data_stru->timeout_table.flag[0] = '2';
general_util.c.bak:            pub_data_stru->timeout_table.flag[0] = '0';
general_util.c.bak:    strcpy(TransLog.resp_cd_rcv, pub_data_stru->center_result_code);
general_util.c.bak:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_RECODE, pub_data_stru->in_msg_type,
general_util.c.bak:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_AUTH_ID, pub_data_stru->in_msg_type,
general_util.c.bak:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_SYS_REF_NO, pub_data_stru->in_msg_type,
general_util.c.bak:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_SETTLE_DATE, pub_data_stru->in_msg_type,
general_util.c.bak:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
general_util.c.bak:    if(pub_data_stru->timeout_table.flag[0] == '1' ||  pub_data_stru->timeout_table.flag[0] == '2')
general_util.c.bak:        SetTransLog(&TransLog, "APP_MSG_TYPE", pub_data_stru->route_msg_type, 0, pub_data_stru);
general_util.c.bak:        SetTransLog(&TransLog, "APP_TRANS_TYPE", pub_data_stru->route_trans_type, 0, pub_data_stru);
general_util.c.bak:        if(0 <(len=_get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 <(len= _get_field_data_safe(pub_data_stru, FIELD_INSTI_CODE, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 < (len= _get_field_data_safe(pub_data_stru, FIELD_TERM_ID1, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TERM_ID2, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_DATE, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TIME, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 <(len= _get_field_data_safe(pub_data_stru, FIELD_TRA_NO, pub_data_stru->in_msg_type,
general_util.c.bak:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_RECODE, pub_data_stru->in_msg_type,
general_util.c.bak:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_AUTH_ID, pub_data_stru->in_msg_type,
general_util.c.bak:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_SYS_REF_NO, pub_data_stru->in_msg_type,
general_util.c.bak:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_SETTLE_DATE, pub_data_stru->in_msg_type,
general_util.c.bak:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
general_util.c.bak:    if(pub_data_stru->timeout_table.flag[0] == '1' ||  pub_data_stru->timeout_table.flag[0] == '2')
general_util.c.bak:        strcpy(TransLog.resp_cd_rcv, pub_data_stru->center_result_code);
general_util.c.bak:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_RECODE, pub_data_stru->in_msg_type,
general_util.c.bak:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
general_util.c.bak:        SetTransLog(&TransLog, "PAY_MSG_TYPE", pub_data_stru->route_msg_type, 0, pub_data_stru);
general_util.c.bak:        SetTransLog(&TransLog, "PAY_TRANS_TYPE", pub_data_stru->route_trans_type, 0, pub_data_stru);
general_util.c.bak:        if(0 <(len=_get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_INSTI_CODE, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TERM_ID1, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TERM_ID2, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_DATE, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TIME, pub_data_stru->in_msg_type,
general_util.c.bak:        if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_TRA_NO, pub_data_stru->in_msg_type,
general_util.c.bak:    if(0 < (len=_get_field_data_safe(pub_data_stru, FIELD_RECODE, pub_data_stru->in_msg_type,
general_util.c.bak:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
general_util.c.bak:    if(0>folder_to_insti_code(pub_data_stru->insti_fold_name,
general_util.c.bak:                              pub_data_stru->insti_code, sizeof(pub_data_stru->insti_fold_name)))
general_util.c.bak:    if((i=get_field_data_safe(pub_data_stru,inst_field,pub_data_stru->in_msg_type,tmp,sizeof(tmp))) <=0)
general_util.c.bak:        add_pub_field(pub_data_stru,inst_field,pub_data_stru->in_msg_type,
general_util.c.bak:                      strlen(pub_data_stru->insti_code),pub_data_stru->insti_code, 0);
general_util.c.bak:        if(strcmp(tmp,pub_data_stru->insti_code)!=0) {
general_util.c.bak:                    __FUNCTION__,tmp,pub_data_stru->insti_code);
general_util.c.bak:    snprintf(pub_data_stru->route_insti_code,9,"%s", pub_data_stru->insti_code);
general_util.c.bak:    snprintf(pub_data_stru->route_msg_type  ,5,"%s", pub_data_stru->in_msg_type);
general_util.c.bak:    snprintf(pub_data_stru->route_fold_name ,40,"%s", pub_data_stru->insti_fold_name);
general_util.c.bak:    snprintf(pub_data_stru->route_mac_index ,6 ,"%s",pub_data_stru->in_mac_index);
general_util.c.bak:    snprintf(pub_data_stru->route_mac_key   ,33 ,"%s",pub_data_stru->in_mac_key);
general_util.c.bak:    snprintf(pub_data_stru->route_trans_type, 5,"%s",pub_data_stru->in_trans_type);
general_util.c.bak:    pub_data_stru->route_is_check_mac=pub_data_stru->is_check_mac;
general_util.c.bak:    pub_data_stru->route_insti_work_type=pub_data_stru->insti_work_type;
general_util.c.bak:    if(pub_data_stru->center_result_code[0] == 0)
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
general_util.c.bak:        i=get_field_data_safe(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type, card_no,sizeof(card_no));
general_util.c.bak:            add_pub_field(pub_data_stru,FIELD_AMOUNT_REAL,pub_data_stru->in_msg_type,12,begin_amount, 0);
general_util.c.bak:        if(pub_data_stru->switch_src_flag == 0)
general_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_CUPS_NOT_OPERATE);
general_util.c.bak:    snprintf(msgkey,sizeof(msgkey),"%s", pub_data_stru->timeout_table.first_key);
general_util.c.bak:        dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
general_util.c.bak:    pub_data_stru->switch_src_flag=1;
general_util.c.bak:                             DB_MSG_TYPE, pub_data_stru->route_insti_code, 2,9);
general_util.c.bak:                             DB_MSG_TYPE, pub_data_stru->route_trans_type, 2,5);
general_util.c.bak:    if(memcmp(pub_data_stru->in_msg_type, "TPOS", 4)) {
general_util.c.bak:                                  pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c.bak:                                pub_data_stru->in_msg_type, TransLog.acq_insti_code,9);
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
general_util.c.bak:        if(11 >= (len = get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type, "3B"),
general_util.c.bak:                                            pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal)))) {
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
general_util.c.bak:        add_pub_field(pub_data_stru, FIELD_IC_DATA, pub_data_stru->in_msg_type, len - 11, fieldVal + 11, 1);
general_util.c.bak:        get_field_data_safe(pub_data_stru, FIELD_PSAM_NO, pub_data_stru->in_msg_type, TransLog.acq_term_id1,17);
general_util.c.bak:            strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
iso_pack.c:    msg_type= pub_data_stru->route_msg_type;
iso_pack.c:    priv_def = pub_data_stru->route_priv_def;
iso_pack.c:                  strlen(pub_data_stru->center_result_code),
iso_pack.c:                  pub_data_stru->center_result_code, 1);
iso_pack.c:    p_set=&pub_data_stru->route_set;
iso_pack.c:            if(pub_data_stru->route_num==0)
iso_pack.c:        if(pub_data_stru->route_num==0) {
iso_unpack.c:    priv_def = pub_data_stru->in_priv_def;
iso_unpack.c:    msg_type = pub_data_stru->in_msg_type;
iso_unpack.c:                                     pub_data_stru->in_msg_type,len, tmp_buf, 0))
iso_unpack.c:                                   pub_data_stru->in_msg_type,len, buf + len_len, 0))
pack.c:        if(strcmp(pub_data_stru->route_msg_type ,pack_func_proc[i].msg_type)==0)
request_proc.c:    if(!pub_data_stru->open_flag) { //业务被关闭
request_proc.c:        pub_data_stru->switch_src_flag=1;
request_proc.c:        pub_data_stru->switch_src_flag=1;
request_proc.c:        pub_data_stru->switch_src_flag=1;
request_proc.c:        if(pub_data_stru->in_cry_flag) pub_data_stru->out_cry_flag =1;
request_proc.c:            strcpy(pub_data_stru->center_result_code,"94");
request_proc.c:            strcpy(pub_data_stru->center_result_code,"96");
request_proc.c:        pub_data_stru->switch_src_flag=1;
request_proc.c:        if(pub_data_stru->in_cry_flag) pub_data_stru->out_cry_flag =1;
request_proc.c:        pub_data_stru->switch_src_flag=1;
request_proc.c:        if(pub_data_stru->in_cry_flag) pub_data_stru->out_cry_flag =1;
request_proc.c:        pub_data_stru->switch_src_flag=1;
request_proc.c:    pub_data_stru->use_timeout = 1;
request_proc.c:    if(0>get_direct_name(pub_data_stru->in_msg_type,pub_data_stru->app_type,
request_proc.c:    pub_data_stru->switch_src_flag=1;
request_proc.c:    pub_data_stru->out_cry_flag = pub_data_stru->in_cry_flag;
request_proc.c:    strcpy_s(pub_data_stru->route_insti_code, pub_data_stru->insti_code, sizeof(pub_data_stru->route_insti_code));
request_proc.c:    strcpy_s(pub_data_stru->route_trans_type, pub_data_stru->in_trans_type, sizeof(pub_data_stru->route_trans_type));
request_proc.c:    strcpy_s(pub_data_stru->route_msg_type, pub_data_stru->in_msg_type, sizeof(pub_data_stru->route_msg_type));
request_proc.c:    strcpy_s(pub_data_stru->route_fold_name, pub_data_stru->insti_fold_name, sizeof(pub_data_stru->route_fold_name));
request_proc.c:    strcpy_s(pub_data_stru->route_mac_index, pub_data_stru->in_mac_index, sizeof(pub_data_stru->route_mac_index));
request_proc.c:    strcpy_s(pub_data_stru->route_mac_key, pub_data_stru->in_mac_key, sizeof(pub_data_stru->route_mac_key));
request_proc.c:            pub_data_stru->in_msg_type,pub_data_stru->app_type,
respose_proc.c:            strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
respose_proc.c:    if(pub_data_stru->switch_src_flag) {
respose_proc.c:        snprintf(pub_data_stru->route_insti_code,9,"%s", acq_insti_code);
respose_proc.c:            strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
respose_proc.c://      if(pub_data_stru->switch_src_flag)
respose_proc.c:        strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
respose_proc.c:    if(!pub_data_stru->switch_src_flag) {
respose_proc.c:            strcpy(pub_data_stru->center_result_code, CODE_CUPS_NOT_OPERATE);
respose_proc.c:            strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
respose_proc.c:        strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
respose_proc.c:        strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
respose_proc.c:    if(pub_data_stru->switch_src_flag) { // 在交易返回来源处时系统想干的事情
respose_proc.c:    pub_data_stru->use_timeout = !pub_data_stru->switch_src_flag;
timeout_proc.c://  dcs_log(0, 0, "<FILE:%s,LINE:%d>begin flag=%d", __FILE__, __LINE__,pub_data_stru->timeout_table.flag[0]);
timeout_proc.c:    if(pub_data_stru->timeout_table.flag[0] == '0') return 0; //不处理
timeout_proc.c:    c=pub_data_stru->timeout_table.flag[0];
timeout_proc.c:    switch(pub_data_stru->timeout_table.flag[0]) {
timeout_proc.c:            strcpy(pub_data_stru->center_result_code, CODE_TIME_OUT);
timeout_proc.c:            pub_data_stru->timeout_table.flag[0]++;
timeout_proc.c:                                 DB_MSG_TYPE,pub_data_stru->route_insti_code, 2,9);
timeout_proc.c:                                 DB_MSG_TYPE, pub_data_stru->route_trans_type, 2,5);
timeout_proc.c:            strcpy(pub_data_stru->center_result_code, CODE_INQUIRY);
timeout_proc.c:            pub_data_stru->timeout_table.flag[0]++;
timeout_proc.c:                                 DB_MSG_TYPE,pub_data_stru->route_insti_code, 2,9);
timeout_proc.c:                                 DB_MSG_TYPE,pub_data_stru->route_trans_type, 2,5);
timeout_proc.c:            pub_data_stru->use_timeout = 1;
timeout_proc.c:            strcpy(pub_data_stru->timeout_table.trans_type, pub_data_stru->route_trans_type);
timeout_proc.c:            pub_data_stru->use_timeout = 1;
timeout_proc.c:            strcpy(pub_data_stru->timeout_table.trans_type, pub_data_stru->route_trans_type);
timeout_proc.c:            strcpy(pub_data_stru->center_result_code, CODE_TIME_OUT);
timeout_proc.c:                                 DB_MSG_TYPE,pub_data_stru->route_insti_code, 2,9);
timeout_proc.c:                                 DB_MSG_TYPE, pub_data_stru->route_trans_type, 2,5);
timeout_proc.c:            pub_data_stru->use_timeout = 1;
timeout_proc.c:            memcpy(pub_data_stru->route_insti_code,pub_data_stru->timeout_table.remark,8);
timeout_proc.c:            memcpy(pub_data_stru->route_trans_type,pub_data_stru->timeout_table.trans_type,4);
timeout_proc.c:            dcs_debug(0,0,"<%s>交易结果通知inist=[%s],trans_type=[%s]",__FUNCTION__,pub_data_stru->route_insti_code,pub_data_stru->route_trans_type);
timeout_proc.c:            dcs_log(0, 0,  "<FILE:%s,LINE:%d>timeout_table.flag[%s]定义出错", __FILE__, __LINE__, pub_data_stru->timeout_table.flag);
timeout_proc.c:	dcs_debug(0,0,"at %s(%s:%d) route_insti_code=[%s]",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->route_insti_code);
timeout_proc.c:        dcs_log(0, 0, "<FILE:%s,LINE:%d>域转换失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.flag);
timeout_proc.c:    if(c =='1') _update_db_voidflag(pub_data_stru->timeout_table.first_key,'1');
timeout_proc.c:    pub_data_stru->route_num=1;
tpos_pack.c:    msg_type = pub_data_stru->route_msg_type;
tpos_pack.c:    priv_def = pub_data_stru->route_priv_def;
tpos_pack.c:		dcs_log(0, 0, "at %s(%s:%d) order=%c, code=%s, update", __func__, __FILE__, __LINE__, pub_data_stru->tmp_order[1],pub_data_stru->center_result_code);
tpos_pack.c:    if(pub_data_stru->tmp_order[1]==0x31 &&
tpos_pack.c:       memcmp(pub_data_stru->center_result_code,"00",2) ==0) {
tpos_pack.c:                update_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"FUNC_CODE"),
tpos_pack.c:    p_set=&pub_data_stru->route_set;
tpos_pack.c:    if(pub_data_stru->out_cry_flag) {
tpos_pack.c:                                       memcmp(pub_data_stru->center_result_code,"00",2) ==0)) {
tpos_pack.c:                  pub_data_stru->route_mac_index,pub_data_stru->route_mac_key);
tpos_pack.c:        if(pub_data_stru->out_cry_flag) {
tpos_pack.c:        if(pub_data_stru->out_cry_flag)
tpos_pack.c:            n=CALCMAC(return_code, pub_data_stru->route_mac_index,
tpos_pack.c:                      pub_data_stru->route_mac_key, 0, 16, tmp, data_buf);
tpos_pack.c:            n=DESCALCMAC(return_code,pub_data_stru->route_mac_index,
tpos_pack.c:                         pub_data_stru->route_mac_key,8,tmp,data_buf);
tpos_pack.c:                    pub_data_stru->route_mac_index);
tpos_pack.c:        if(pub_data_stru->out_cry_flag) {
tpos_pack.c:    if( pub_data_stru->route_num==0)
tpos_unpack.c:    msg_type = pub_data_stru->in_msg_type;
tpos_unpack.c:    priv_def = pub_data_stru->in_priv_def;
tpos_unpack.c:                    add_pub_field(pub_data_stru,p_def->fld_def[i].id,pub_data_stru->in_msg_type,
tpos_unpack.c:                    if(0>add_pub_field(pub_data_stru, p_def->fld_def[i].id, pub_data_stru->in_msg_type,
tpos_unpack.c:                    add_pub_field(pub_data_stru,p_def->fld_def[i].id,pub_data_stru->in_msg_type,len*2,tmp_buf,0);
tpos_unpack.c:                    add_pub_field(pub_data_stru,p_def->fld_def[i].id,pub_data_stru->in_msg_type,len,buf+1,0);
tpos_unpack.c:                    add_pub_field(pub_data_stru,p_def->fld_def[i].id,pub_data_stru->in_msg_type,len*2,tmp_buf,0);
tpos_unpack.c:                    add_pub_field(pub_data_stru,p_def->fld_def[i].id,pub_data_stru->in_msg_type,len,buf+2,0);
tpos_util.c:                           get_pub_field_id(pub_data_stru->in_msg_type,"TPDU"),
tpos_util.c:                           pub_data_stru->in_msg_type,tmp,sizeof(tmp))>0) {
tpos_util.c:                           get_pub_field_id(pub_data_stru->in_msg_type,"TEL_NO"),
tpos_util.c:                           pub_data_stru->in_msg_type,
tpos_util.c:    if(get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"0D"),
tpos_util.c:                           pub_data_stru->in_msg_type,tmp,sizeof(tmp))<=0) {
tpos_util.c:    if(pub_data_stru->in_cry_flag) {
tpos_util.c:        assert((pub_data_stru->src_len-16-len-1)<= sizeof(tmp));
tpos_util.c:		//dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->src_len-16-len-1);
tpos_util.c:        memcpy(tmp,pub_data_stru->src_buffer+len,pub_data_stru->src_len-16-len-1);
tpos_util.c:        p=(unsigned char *)pub_data_stru->src_buffer+len;
tpos_util.c:            if(((pub_data_stru->src_len-16-len-1)%16))
tpos_util.c:              n=pub_data_stru->src_len-16-len-1 +(16-((pub_data_stru->src_len-16-len-1)%16));
tpos_util.c:        n=pub_data_stru->src_len-16-len-1;
tpos_util.c:        assert((pub_data_stru->src_len-8-len-1) <= sizeof(tmp));
tpos_util.c:		//dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->src_len-8-len-1);
tpos_util.c:        memcpy(tmp,pub_data_stru->src_buffer+len,pub_data_stru->src_len-8-len-1);
tpos_util.c:        p=(unsigned char *)pub_data_stru->src_buffer+len;
tpos_util.c:        if(((pub_data_stru->src_len-8-len-1)%8))
tpos_util.c:         n=pub_data_stru->src_len-8-len-1 +(8-((pub_data_stru->src_len-8-len-1)%8));
tpos_util.c:        n=pub_data_stru->src_len-8-len-1;
tpos_util.c:    if(pub_data_stru->in_cry_flag) {
tpos_util.c:    if(pub_data_stru->in_cry_flag) {
tpos_util.c:        if(CALCMAC(return_code, pub_data_stru->in_mac_index,
tpos_util.c:                   pub_data_stru->in_mac_key, 0, 16, tmp, tmp)<0) {
tpos_util.c:                    pub_data_stru->in_mac_index);
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:        if(DESCALCMAC(return_code,pub_data_stru->in_mac_index,
tpos_util.c:                      pub_data_stru->in_mac_key,8,tmp,tmp) < 0) {
tpos_util.c:                    pub_data_stru->in_mac_index);
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:    if(pub_data_stru->in_cry_flag) {
tpos_util.c:        if(memcmp(pub_data_stru->src_buffer+pub_data_stru->src_len-16-1,mac,16)!=0) {
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"A0");
tpos_util.c:            dcs_log(pub_data_stru->src_buffer+pub_data_stru->src_len-16-1,16,
tpos_util.c:        if(memcmp(pub_data_stru->src_buffer+pub_data_stru->src_len-8-1,mac,8)!=0) {
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"A0");
tpos_util.c:            dcs_log(pub_data_stru->src_buffer+pub_data_stru->src_len-8-1,8,
tpos_util.c:    if(pub_data_stru->insti_work_type) {
tpos_util.c:        if(0>tpos_get_work_key(psam,pub_data_stru->in_pin_index,
tpos_util.c:                               pub_data_stru->in_mac_index,
tpos_util.c:                               pub_data_stru->in_data_index,
tpos_util.c:                               pub_data_stru->in_pin_key,
tpos_util.c:                               pub_data_stru->in_mac_key,
tpos_util.c:                               pub_data_stru->in_data_key)) {
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                  __FUNCTION__,pub_data_stru->in_pin_index,
tpos_util.c:                  pub_data_stru->in_pin_key,pub_data_stru->in_mac_index,
tpos_util.c:                  pub_data_stru->in_mac_key,pub_data_stru->in_data_index,
tpos_util.c:                  pub_data_stru->in_data_key);
tpos_util.c:        snprintf(pub_data_stru->route_mac_index,6,"%s",pub_data_stru->in_pin_index);
tpos_util.c:        snprintf(pub_data_stru->route_mac_key,33,"%s",pub_data_stru->in_mac_key);
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"TZ1");
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"TZ1");
tpos_util.c:        id=get_pub_field_id(pub_data_stru->in_msg_type,"TEL_NO");
tpos_util.c:        if(0>get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"TZ4");
tpos_util.c:                    strcpy(pub_data_stru->center_result_code,"TZ4");
tpos_util.c:                pub_data_stru->tmp_order[2] =0x31; // 安全线路不校验终端sn
tpos_util.c:        id=get_pub_field_id(pub_data_stru->in_msg_type,"TEL_NO");
tpos_util.c:        if(0<get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,
tpos_util.c:            if(is_trust_tel(p))  pub_data_stru->tmp_order[2] =0x31; // 安全线路不校验终端sn
tpos_util.c:    pub_data_stru->tmp_order[1]=terminfo.menu_update_flag[0];
tpos_util.c:    id=get_pub_field_id(pub_data_stru->in_msg_type,"PROG_VER");
tpos_util.c:    if(0>get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,
tpos_util.c:    strcpy(pub_data_stru->center_result_code,"TZ2");
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"DATE"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"TIME"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                           get_pub_field_id(pub_data_stru->in_msg_type,"02"),
tpos_util.c:                           pub_data_stru->in_msg_type,tmp1,sizeof(tmp1))<=0) {
tpos_util.c:    if(pub_data_stru->tmp_order[2] !=0x31) { // 安全线路不交易终端sn
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"TZ1");
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"TZ3");
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                             get_pub_field_id(pub_data_stru->in_msg_type,
tpos_util.c:                             pub_data_stru->in_msg_type,menu_ver,sizeof(menu_ver))) {
tpos_util.c:                  get_pub_field_id(pub_data_stru->route_msg_type,"DATE"),
tpos_util.c:                  pub_data_stru->route_msg_type,
tpos_util.c:                  get_pub_field_id(pub_data_stru->route_msg_type,"TIME"),
tpos_util.c:                  pub_data_stru->route_msg_type,
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c:                          get_pub_field_id(pub_data_stru->route_msg_type,"18"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                          get_pub_field_id(pub_data_stru->route_msg_type,"24"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                          get_pub_field_id(pub_data_stru->route_msg_type,"25"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                             get_pub_field_id(pub_data_stru->route_msg_type,"MENU_VER"),
tpos_util.c:                             pub_data_stru->route_msg_type,
tpos_util.c:                         get_pub_field_id(pub_data_stru->route_msg_type,"MENU_VER"),
tpos_util.c:                         pub_data_stru->route_msg_type,
tpos_util.c:                            get_pub_field_id(pub_data_stru->in_msg_type,"MENU_VER"),
tpos_util.c:                            pub_data_stru->in_msg_type,menu_ver,sizeof(menu_ver));
tpos_util.c:        if((n=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type,"18"),
tpos_util.c:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"18"),
tpos_util.c:                              pub_data_stru->in_msg_type, 0);
tpos_util.c:        if((n=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type,"19"),
tpos_util.c:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"19"),
tpos_util.c:                              pub_data_stru->in_msg_type,0);
tpos_util.c:        if((n=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type,"1B"),
tpos_util.c:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1B"),
tpos_util.c:                              pub_data_stru->in_msg_type,0);
tpos_util.c:        if((n=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type,"1A"),
tpos_util.c:                                  pub_data_stru->in_msg_type, tmp, sizeof(tmp)))>0) {
tpos_util.c:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1A"),
tpos_util.c:                              pub_data_stru->in_msg_type,0);
tpos_util.c:        if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1F"),
tpos_util.c:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1F"),
tpos_util.c:                              pub_data_stru->in_msg_type,0);
tpos_util.c:        if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1C"),
tpos_util.c:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1C"),
tpos_util.c:                              pub_data_stru->in_msg_type,0);
tpos_util.c:        if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"16"),
tpos_util.c:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"16"),
tpos_util.c:                              pub_data_stru->in_msg_type,0);
tpos_util.c:        if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"17"),
tpos_util.c:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"17"),
tpos_util.c:                              pub_data_stru->in_msg_type,0);
tpos_util.c:        if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"3C"),
tpos_util.c:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"3C"),
tpos_util.c:                              pub_data_stru->in_msg_type,0);
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c:                      get_pub_field_id(pub_data_stru->in_msg_type,"24"),
tpos_util.c:                      pub_data_stru->in_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->in_msg_type,"25"),
tpos_util.c:                      pub_data_stru->in_msg_type,
tpos_util.c:                    strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                          get_pub_field_id(pub_data_stru->route_msg_type,"18"),
tpos_util.c:                          pub_data_stru->route_msg_type,n,tmp,1);
tpos_util.c:            n=_get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"18"),pub_data_stru->route_msg_type,tmp,1,sizeof(tmp));
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                          get_pub_field_id(pub_data_stru->route_msg_type,"19"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                          get_pub_field_id(pub_data_stru->route_msg_type,"1A"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                          get_pub_field_id(pub_data_stru->route_msg_type,"1B"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                          get_pub_field_id(pub_data_stru->route_msg_type,"1C"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                          get_pub_field_id(pub_data_stru->route_msg_type,"16"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                          get_pub_field_id(pub_data_stru->route_msg_type,"17"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c:                          get_pub_field_id(pub_data_stru->in_msg_type,"24"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                          get_pub_field_id(pub_data_stru->in_msg_type,"25"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                          get_pub_field_id(pub_data_stru->in_msg_type,"24"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                          get_pub_field_id(pub_data_stru->in_msg_type,"25"),
tpos_util.c:                          pub_data_stru->route_msg_type,
tpos_util.c:                          get_pub_field_id(pub_data_stru->in_msg_type,"0D"),
tpos_util.c:                          pub_data_stru->in_msg_type,
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                    strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                    strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"18"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:        n=_get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"18"),
tpos_util.c:                               pub_data_stru->route_msg_type,tmp,1,sizeof(tmp));
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"24"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"25"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                  get_pub_field_id(pub_data_stru->route_msg_type,"DATE"),
tpos_util.c:                  pub_data_stru->route_msg_type,
tpos_util.c:                  get_pub_field_id(pub_data_stru->route_msg_type,"TIME"),
tpos_util.c:                  pub_data_stru->route_msg_type,
tpos_util.c:    strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c:    if(NULL== get_priv_field_def("PSAM_NO", &id, pub_data_stru->in_priv_def)) {
tpos_util.c:    n=get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,psam,size);
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"3C"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"18"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"19"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"1A"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"1B"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"1C"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"16"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"17"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:	                              pub_data_stru->in_msg_type,
tpos_util.c:                              get_pub_field_id(pub_data_stru->in_msg_type,"04"),
tpos_util.c:                              pub_data_stru->in_msg_type,
tpos_util.c:            if(pub_data_stru->in_cry_flag)
tpos_util.c:                i=Track_Decryption(return_code, pub_data_stru->in_data_index, pub_data_stru->in_data_key,0, n-1-8, tmp+1, &outlen, tmp);
tpos_util.c:                i=DecTrackPrg(return_code, pub_data_stru->in_data_index, pub_data_stru->in_data_key, n-1-8, tmp+1, &outlen, tmp);
tpos_util.c:                              pub_data_stru->in_msg_type,
tpos_util.c:                                      pub_data_stru->in_msg_type,
tpos_util.c:                                      pub_data_stru->in_msg_type,
tpos_util.c:                                  pub_data_stru->in_msg_type,
tpos_util.c:                              pub_data_stru->in_msg_type,
tpos_util.c:                                  pub_data_stru->in_msg_type,
tpos_util.c:                          pub_data_stru->in_msg_type,
tpos_util.c:                          pub_data_stru->in_msg_type,
tpos_util.c:                          pub_data_stru->in_msg_type,
tpos_util.c:            if(pub_data_stru->in_cry_flag)
tpos_util.c:                i=Track_Decryption(return_code, pub_data_stru->in_data_index, pub_data_stru->in_data_key,0, *p, (char *)p+1, &outlen, tmp1);
tpos_util.c:                i= DecTrackPrg(return_code, pub_data_stru->in_data_index, pub_data_stru->in_data_key, *p, (char *)p+1, &outlen, tmp1);
tpos_util.c:                              pub_data_stru->in_msg_type,
tpos_util.c:          	add_pub_field(pub_data_stru, 60, pub_data_stru->in_msg_type, 15, "000005100900000", 1);
tpos_util.c:                                   pub_data_stru->in_msg_type,
tpos_util.c:                              pub_data_stru->in_msg_type,
tpos_util.c:        del_pub_field(pub_data_stru, FIELD_PIN,pub_data_stru->in_msg_type,0);
tpos_util.c:        dcs_debug(0,0,"<%s> route_pin_index=[%s]",__FUNCTION__,pub_data_stru->route_pin_index);
tpos_util.c:        if(pub_data_stru->in_cry_flag && pub_data_stru->out_cry_flag) {
tpos_util.c:            if(TRANS_PIN(return_code,pub_data_stru->in_pin_index,pub_data_stru->route_pin_index,pub_data_stru->in_pin_key,pub_data_stru->route_pin_key, 0,0, tmp, card_no,tmp, outPan)<0) {
tpos_util.c:        } else if(pub_data_stru->in_cry_flag && !pub_data_stru->out_cry_flag) {
tpos_util.c:            if(TRANS_PIN(return_code,pub_data_stru->in_pin_index,pub_data_stru->route_pin_index,pub_data_stru->in_pin_key,pub_data_stru->route_pin_key, 0,2, tmp, card_no,tmp, outPan)<0) {
tpos_util.c:        } else if(!pub_data_stru->in_cry_flag && pub_data_stru->out_cry_flag) {
tpos_util.c:            if(TRANS_PIN(return_code,pub_data_stru->in_pin_index,pub_data_stru->route_pin_index,pub_data_stru->in_pin_key,pub_data_stru->route_pin_key, 2,0, tmp, card_no,tmp, outPan)<0) {
tpos_util.c:            if(DESTRANSPIN2(return_code,pub_data_stru->in_pin_index,pub_data_stru->route_pin_index,pub_data_stru->in_pin_key,pub_data_stru->route_pin_key,tmp,card_no,tmp,outPan) < 0) {
tpos_util.c:            if(!pub_data_stru->out_cry_flag) {
tpos_util.c:                                  pub_data_stru->route_msg_type,
tpos_util.c:                                  pub_data_stru->route_msg_type,
tpos_util.c:                                  pub_data_stru->route_msg_type,
tpos_util.c:                                  pub_data_stru->route_msg_type,
tpos_util.c://  i=_get_field_data(get_pub_field_id(pub_data_stru->route_msg_type, "PSAM_NO"),pub_data_stru,psam, pub_data_stru->route_num == 0 ? 0 : 1);
tpos_util.c:    if(pub_data_stru->route_num == 0) {
tpos_util.c:        id = get_pub_field_id(pub_data_stru->in_msg_type, "PSAM_NO");
tpos_util.c:        memcpy(msg_type, pub_data_stru->in_msg_type, 4);
tpos_util.c:        pub_data_stru->tmp_order[1]=terminfo.menu_update_flag[0];
tpos_util.c:    return tpos_get_work_key(psam,pub_data_stru->route_pin_index,
tpos_util.c:                             pub_data_stru->route_mac_index,
tpos_util.c:                             pub_data_stru->route_data_index,
tpos_util.c:                             pub_data_stru->route_pin_key,
tpos_util.c:                             pub_data_stru->route_mac_key,
tpos_util.c:                             pub_data_stru->route_data_key);
tpos_util.c:                              get_pub_field_id(pub_data_stru->in_msg_type, "09"),
tpos_util.c:                              pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
tpos_util.c:                        get_pub_field_id(pub_data_stru->in_msg_type, "PSAM_NO"),
tpos_util.c:                        pub_data_stru->in_msg_type, tPosLog.acq_term_id1,17);
tpos_util.c:                        pub_data_stru->in_msg_type, tPosLog.acq_insti_code,9);
tpos_util.c:                            pub_data_stru->in_msg_type,
tpos_util.c:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
tpos_util.c:                         pub_data_stru->in_msg_type,
tpos_util.c:                                pub_data_stru->in_msg_type,
tpos_util.c:                strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
tpos_util.c:            strcpy(pub_data_stru->center_result_code, "96");
tpos_util.c:        memcpy(pub_data_stru->route_insti_code,fieldVal,8);
tpos_util.c:            strcpy(pub_data_stru->center_result_code, "96");
tpos_util.c:        pub_data_stru->is_route=3;
tpos_util.c:        strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
tpos_util.c:    snprintf(pub_data_stru->route_insti_code,9,"%s",pub_data_stru->insti_code);
tpos_util.c:    snprintf(pub_data_stru->route_trans_type,5,"%s",pub_data_stru->in_trans_type);
tpos_util.c:    if(0 > (field_id = get_pub_field_id(pub_data_stru->in_msg_type, "0F"))) {
tpos_util.c:                              pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
tpos_util.c:                        pub_data_stru->in_msg_type,
tpos_util.c:                        pub_data_stru->in_msg_type,
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:        memset(pub_data_stru->timeout_table.first_key, 0, sizeof(pub_data_stru->timeout_table.first_key));
tpos_util.c:        snprintf(pub_data_stru->timeout_table.first_key,sizeof(pub_data_stru->timeout_table.first_key), "%s,%s,%s,%s,%s,%s,%s",
tpos_util.c:                 pub_data_stru->in_msg_type, tPosLog.sys_date,tPosLog.acq_insti_code,tPosLog.acq_tra_no,tPosLog.acq_date,tPosLog.acq_term_id1,tPosLog.acq_term_id2);
tpos_util.c:        memcpy(pub_data_stru->timeout_table.sys_date, tmp, 8);
tpos_util.c:        memcpy(pub_data_stru->timeout_table.sys_time, tmp + 8, 6);
tpos_util.c:        strcpy(pub_data_stru->timeout_table.foldname, SYSTEM_FOLDNAME);
tpos_util.c:        snprintf(pub_data_stru->timeout_table.key,sizeof(pub_data_stru->timeout_table.key),"%s", pub_data_stru->timeout_table.first_key);
tpos_util.c:        pub_data_stru->timeout_table.num = 30;
tpos_util.c:        strcpy(pub_data_stru->timeout_table.flag, "2");
tpos_util.c:        write_voidtrans_to_fold(&pub_data_stru->timeout_table);
tpos_util.c:            strcpy(pub_data_stru->center_result_code, "00");
tpos_util.c:            strcpy(pub_data_stru->center_result_code, CODE_PROCESSING);
tpos_util.c:        strcpy(pub_data_stru->center_result_code, CODE_NOT_EXIST);
tpos_util.c:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c:            if(strcmp(pub_data_stru->route_msg_type,"TPOS")==0) {
tpos_util.c:		                    msgtype = pub_data_stru->route_msg_type;
tpos_util.c:		                    msgtype = pub_data_stru->in_msg_type;
tpos_util.c:                                pub_data_stru->route_num);
tpos_util.c:                  pub_data_stru->route_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type, "3C"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:    if(pub_data_stru->in_cry_flag)
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type,"3C"),
tpos_util.c:                      pub_data_stru->route_msg_type,l, buf, 1);
tpos_util.c:    fid = get_pub_field_id(pub_data_stru->in_msg_type, para);
tpos_util.c:    fieldLen = get_field_data_safe(pub_data_stru, fid, pub_data_stru->in_msg_type,
tpos_util.c:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c:    memcpy(tmpBuf + l, pub_data_stru->center_result_code, 3);
tpos_util.c:            i = get_pub_field_id(pub_data_stru->route_msg_type, "2F");
tpos_util.c:                dcs_log(0, 0, "<%s>取报文%s[2F]ID失败！", __FUNCTION__, pub_data_stru->route_msg_type);
tpos_util.c:            add_pub_field(pub_data_stru, i, pub_data_stru->route_msg_type,
tpos_util.c:    add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
tpos_util.c:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c:    memcpy(fmtMsgBuf + len, pub_data_stru->center_result_code, 3);
tpos_util.c:		                    msgtype = pub_data_stru->route_msg_type;
tpos_util.c:		                    msgtype = pub_data_stru->in_msg_type;
tpos_util.c:        add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
tpos_util.c:    if(0 > get_field_data_safe(pub_data_stru, FIELD_TRA_NO, pub_data_stru->in_msg_type,
tpos_util.c:    if(0 > get_field_data_safe(pub_data_stru, FIELD_PSAM_NO, pub_data_stru->in_msg_type,
tpos_util.c:                               pub_data_stru->in_msg_type,
tpos_util.c:    if(NULL== get_priv_field_def(field_name, &id,pub_data_stru->in_priv_def)) {
tpos_util.c:    if(get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,psam,17)<=0) {
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"03");
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"03");
tpos_util.c:    if(pub_data_stru->insti_work_type) {
tpos_util.c:        if(0>tpos_get_work_key(psam,pub_data_stru->in_pin_index,
tpos_util.c:                               pub_data_stru->in_mac_index,
tpos_util.c:                               pub_data_stru->in_data_index,
tpos_util.c:                               pub_data_stru->in_pin_key,
tpos_util.c:                               pub_data_stru->in_mac_key,
tpos_util.c:                               pub_data_stru->in_data_key)) {
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                  pub_data_stru->in_pin_index,pub_data_stru->in_pin_key,
tpos_util.c:                  pub_data_stru->in_mac_index,pub_data_stru->in_mac_key,
tpos_util.c:                  pub_data_stru->in_data_index,pub_data_stru->in_data_key);
tpos_util.c:                                   get_pub_field_id(pub_data_stru->in_msg_type,
tpos_util.c:                                   pub_data_stru->in_msg_type,
tpos_util.c:    if(memcmp(pub_data_stru->center_result_code, "00000",
tpos_util.c:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
tpos_util.c:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c:                                            get_pub_field_id(pub_data_stru->route_msg_type,
tpos_util.c:                                            pub_data_stru->route_msg_type, tmp,sizeof(tmp));
tpos_util.c:                                            get_pub_field_id(pub_data_stru->route_msg_type,
tpos_util.c:                                            pub_data_stru->route_msg_type,
tpos_util.c:                      get_pub_field_id(pub_data_stru->route_msg_type, "2F"),
tpos_util.c:                      pub_data_stru->route_msg_type,
tpos_util.c:                              get_pub_field_id(pub_data_stru->in_msg_type,
tpos_util.c:                              pub_data_stru->in_msg_type, discnt_info.term_id,17);
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"30");
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:                                     pub_data_stru->in_msg_type,
tpos_util.c:        strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c:    strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c:                              get_pub_field_id(pub_data_stru->in_msg_type, "09"),
tpos_util.c:                              pub_data_stru->in_msg_type,
tpos_util.c:                        get_pub_field_id(pub_data_stru->in_msg_type, "PSAM_NO"),
tpos_util.c:                        pub_data_stru->in_msg_type, tPosLog.acq_term_id1,17);
tpos_util.c:                        pub_data_stru->in_msg_type, tPosLog.acq_insti_code,9);
tpos_util.c:                            pub_data_stru->in_msg_type,
tpos_util.c:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
tpos_util.c:                                pub_data_stru->in_msg_type,
tpos_util.c:                strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
tpos_util.c:        strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
tpos_util.c:        add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type, 0, para, 1);
tpos_util.c:        add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type, strlen(tmp), tmp, 1);
tpos_util.c:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c:            if(strcmp(pub_data_stru->route_msg_type,"TPOS")==0) {
tpos_util.c:                    msgtype = pub_data_stru->route_msg_type;
tpos_util.c:                    msgtype = pub_data_stru->in_msg_type;
tpos_util.c:                            pub_data_stru->route_num);
tpos_util.c:                  pub_data_stru->route_msg_type,
tpos_util.c:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c:    memcpy(fmtMsgBuf + len, pub_data_stru->center_result_code, 3);
tpos_util.c:                    msgtype = pub_data_stru->route_msg_type;
tpos_util.c:                    msgtype = pub_data_stru->in_msg_type;
tpos_util.c:        add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
tpos_util.c.bak:                           get_pub_field_id(pub_data_stru->in_msg_type,"TPDU"),
tpos_util.c.bak:                           pub_data_stru->in_msg_type,tmp,sizeof(tmp))>0) {
tpos_util.c.bak:                           get_pub_field_id(pub_data_stru->in_msg_type,"TEL_NO"),
tpos_util.c.bak:                           pub_data_stru->in_msg_type,
tpos_util.c.bak:    if(get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"0D"),
tpos_util.c.bak:                           pub_data_stru->in_msg_type,tmp,sizeof(tmp))<=0) {
tpos_util.c.bak:    if(pub_data_stru->in_cry_flag) {
tpos_util.c.bak:        assert((pub_data_stru->src_len-16-len-1)<= sizeof(tmp));
tpos_util.c.bak:		//dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->src_len-16-len-1);
tpos_util.c.bak:        memcpy(tmp,pub_data_stru->src_buffer+len,pub_data_stru->src_len-16-len-1);
tpos_util.c.bak:        p=(unsigned char *)pub_data_stru->src_buffer+len;
tpos_util.c.bak:            if(((pub_data_stru->src_len-16-len-1)%16))
tpos_util.c.bak:              n=pub_data_stru->src_len-16-len-1 +(16-((pub_data_stru->src_len-16-len-1)%16));
tpos_util.c.bak:        n=pub_data_stru->src_len-16-len-1;
tpos_util.c.bak:        assert((pub_data_stru->src_len-8-len-1) <= sizeof(tmp));
tpos_util.c.bak:		//dcs_debug(0,0,"at %s(%s:%d) memcpy[%d]",__FUNCTION__,__FILE__,__LINE__,pub_data_stru->src_len-8-len-1);
tpos_util.c.bak:        memcpy(tmp,pub_data_stru->src_buffer+len,pub_data_stru->src_len-8-len-1);
tpos_util.c.bak:        p=(unsigned char *)pub_data_stru->src_buffer+len;
tpos_util.c.bak:        if(((pub_data_stru->src_len-8-len-1)%8))
tpos_util.c.bak:         n=pub_data_stru->src_len-8-len-1 +(8-((pub_data_stru->src_len-8-len-1)%8));
tpos_util.c.bak:        n=pub_data_stru->src_len-8-len-1;
tpos_util.c.bak:    if(pub_data_stru->in_cry_flag) {
tpos_util.c.bak:    if(pub_data_stru->in_cry_flag) {
tpos_util.c.bak:        if(CALCMAC(return_code, pub_data_stru->in_mac_index,
tpos_util.c.bak:                   pub_data_stru->in_mac_key, 0, 16, tmp, tmp)<0) {
tpos_util.c.bak:                    pub_data_stru->in_mac_index);
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:        if(DESCALCMAC(return_code,pub_data_stru->in_mac_index,
tpos_util.c.bak:                      pub_data_stru->in_mac_key,8,tmp,tmp) < 0) {
tpos_util.c.bak:                    pub_data_stru->in_mac_index);
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:    if(pub_data_stru->in_cry_flag) {
tpos_util.c.bak:        if(memcmp(pub_data_stru->src_buffer+pub_data_stru->src_len-16-1,mac,16)!=0) {
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"A0");
tpos_util.c.bak:            dcs_log(pub_data_stru->src_buffer+pub_data_stru->src_len-16-1,16,
tpos_util.c.bak:        if(memcmp(pub_data_stru->src_buffer+pub_data_stru->src_len-8-1,mac,8)!=0) {
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"A0");
tpos_util.c.bak:            dcs_log(pub_data_stru->src_buffer+pub_data_stru->src_len-8-1,8,
tpos_util.c.bak:    if(pub_data_stru->insti_work_type) {
tpos_util.c.bak:        if(0>tpos_get_work_key(psam,pub_data_stru->in_pin_index,
tpos_util.c.bak:                               pub_data_stru->in_mac_index,
tpos_util.c.bak:                               pub_data_stru->in_data_index,
tpos_util.c.bak:                               pub_data_stru->in_pin_key,
tpos_util.c.bak:                               pub_data_stru->in_mac_key,
tpos_util.c.bak:                               pub_data_stru->in_data_key)) {
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                  __FUNCTION__,pub_data_stru->in_pin_index,
tpos_util.c.bak:                  pub_data_stru->in_pin_key,pub_data_stru->in_mac_index,
tpos_util.c.bak:                  pub_data_stru->in_mac_key,pub_data_stru->in_data_index,
tpos_util.c.bak:                  pub_data_stru->in_data_key);
tpos_util.c.bak:        snprintf(pub_data_stru->route_mac_index,6,"%s",pub_data_stru->in_pin_index);
tpos_util.c.bak:        snprintf(pub_data_stru->route_mac_key,33,"%s",pub_data_stru->in_mac_key);
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"TZ1");
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"TZ1");
tpos_util.c.bak:        id=get_pub_field_id(pub_data_stru->in_msg_type,"TEL_NO");
tpos_util.c.bak:        if(0>get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"TZ4");
tpos_util.c.bak:                    strcpy(pub_data_stru->center_result_code,"TZ4");
tpos_util.c.bak:                pub_data_stru->tmp_order[2] =0x31; // 安全线路不校验终端sn
tpos_util.c.bak:        id=get_pub_field_id(pub_data_stru->in_msg_type,"TEL_NO");
tpos_util.c.bak:        if(0<get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,
tpos_util.c.bak:            if(is_trust_tel(p))  pub_data_stru->tmp_order[2] =0x31; // 安全线路不校验终端sn
tpos_util.c.bak:    pub_data_stru->tmp_order[1]=terminfo.menu_update_flag[0];
tpos_util.c.bak:    id=get_pub_field_id(pub_data_stru->in_msg_type,"PROG_VER");
tpos_util.c.bak:    if(0>get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,
tpos_util.c.bak:    strcpy(pub_data_stru->center_result_code,"TZ2");
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"DATE"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"TIME"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                           get_pub_field_id(pub_data_stru->in_msg_type,"02"),
tpos_util.c.bak:                           pub_data_stru->in_msg_type,tmp1,sizeof(tmp1))<=0) {
tpos_util.c.bak:    if(pub_data_stru->tmp_order[2] !=0x31) { // 安全线路不交易终端sn
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"TZ1");
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"TZ3");
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                             get_pub_field_id(pub_data_stru->in_msg_type,
tpos_util.c.bak:                             pub_data_stru->in_msg_type,menu_ver,sizeof(menu_ver))) {
tpos_util.c.bak:                  get_pub_field_id(pub_data_stru->route_msg_type,"DATE"),
tpos_util.c.bak:                  pub_data_stru->route_msg_type,
tpos_util.c.bak:                  get_pub_field_id(pub_data_stru->route_msg_type,"TIME"),
tpos_util.c.bak:                  pub_data_stru->route_msg_type,
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->route_msg_type,"18"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->route_msg_type,"24"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->route_msg_type,"25"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                             get_pub_field_id(pub_data_stru->route_msg_type,"MENU_VER"),
tpos_util.c.bak:                             pub_data_stru->route_msg_type,
tpos_util.c.bak:                         get_pub_field_id(pub_data_stru->route_msg_type,"MENU_VER"),
tpos_util.c.bak:                         pub_data_stru->route_msg_type,
tpos_util.c.bak:                            get_pub_field_id(pub_data_stru->in_msg_type,"MENU_VER"),
tpos_util.c.bak:                            pub_data_stru->in_msg_type,menu_ver,sizeof(menu_ver));
tpos_util.c.bak:        if((n=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type,"18"),
tpos_util.c.bak:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c.bak:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"18"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type, 0);
tpos_util.c.bak:        if((n=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type,"19"),
tpos_util.c.bak:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c.bak:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"19"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type,0);
tpos_util.c.bak:        if((n=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type,"1B"),
tpos_util.c.bak:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c.bak:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1B"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type,0);
tpos_util.c.bak:        if((n=get_field_data_safe(pub_data_stru, get_pub_field_id(pub_data_stru->in_msg_type,"1A"),
tpos_util.c.bak:                                  pub_data_stru->in_msg_type, tmp, sizeof(tmp)))>0) {
tpos_util.c.bak:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1A"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type,0);
tpos_util.c.bak:        if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1F"),
tpos_util.c.bak:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c.bak:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1F"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type,0);
tpos_util.c.bak:        if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1C"),
tpos_util.c.bak:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c.bak:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"1C"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type,0);
tpos_util.c.bak:        if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"16"),
tpos_util.c.bak:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c.bak:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"16"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type,0);
tpos_util.c.bak:        if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"17"),
tpos_util.c.bak:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c.bak:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"17"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type,0);
tpos_util.c.bak:        if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"3C"),
tpos_util.c.bak:                                  pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
tpos_util.c.bak:                del_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"3C"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type,0);
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->in_msg_type,"24"),
tpos_util.c.bak:                      pub_data_stru->in_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->in_msg_type,"25"),
tpos_util.c.bak:                      pub_data_stru->in_msg_type,
tpos_util.c.bak:                    strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->route_msg_type,"18"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,n,tmp,1);
tpos_util.c.bak:            n=_get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"18"),pub_data_stru->route_msg_type,tmp,1,sizeof(tmp));
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->route_msg_type,"19"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->route_msg_type,"1A"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->route_msg_type,"1B"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->route_msg_type,"1C"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->route_msg_type,"16"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->route_msg_type,"17"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->in_msg_type,"24"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->in_msg_type,"25"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->in_msg_type,"24"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->in_msg_type,"25"),
tpos_util.c.bak:                          pub_data_stru->route_msg_type,
tpos_util.c.bak:                          get_pub_field_id(pub_data_stru->in_msg_type,"0D"),
tpos_util.c.bak:                          pub_data_stru->in_msg_type,
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                    strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                    strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"18"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:        n=_get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"18"),
tpos_util.c.bak:                               pub_data_stru->route_msg_type,tmp,1,sizeof(tmp));
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"24"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"25"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                  get_pub_field_id(pub_data_stru->route_msg_type,"DATE"),
tpos_util.c.bak:                  pub_data_stru->route_msg_type,
tpos_util.c.bak:                  get_pub_field_id(pub_data_stru->route_msg_type,"TIME"),
tpos_util.c.bak:                  pub_data_stru->route_msg_type,
tpos_util.c.bak:    strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c.bak:    if(NULL== get_priv_field_def("PSAM_NO", &id, pub_data_stru->in_priv_def)) {
tpos_util.c.bak:    n=get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,psam,size);
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"3C"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"18"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"19"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"1A"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"1B"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"1C"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"16"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"17"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:	                              pub_data_stru->in_msg_type,
tpos_util.c.bak:                              get_pub_field_id(pub_data_stru->in_msg_type,"04"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type,
tpos_util.c.bak:            if(pub_data_stru->in_cry_flag)
tpos_util.c.bak:                i=Track_Decryption(return_code, pub_data_stru->in_data_index, pub_data_stru->in_data_key,0, n-1-8, tmp+1, &outlen, tmp);
tpos_util.c.bak:                i=DecTrackPrg(return_code, pub_data_stru->in_data_index, pub_data_stru->in_data_key, n-1-8, tmp+1, &outlen, tmp);
tpos_util.c.bak:                              pub_data_stru->in_msg_type,
tpos_util.c.bak:                                      pub_data_stru->in_msg_type,
tpos_util.c.bak:                                      pub_data_stru->in_msg_type,
tpos_util.c.bak:                                  pub_data_stru->in_msg_type,
tpos_util.c.bak:                              pub_data_stru->in_msg_type,
tpos_util.c.bak:                                  pub_data_stru->in_msg_type,
tpos_util.c.bak:                          pub_data_stru->in_msg_type,
tpos_util.c.bak:                          pub_data_stru->in_msg_type,
tpos_util.c.bak:                          pub_data_stru->in_msg_type,
tpos_util.c.bak:            if(pub_data_stru->in_cry_flag)
tpos_util.c.bak:                i=Track_Decryption(return_code, pub_data_stru->in_data_index, pub_data_stru->in_data_key,0, *p, (char *)p+1, &outlen, tmp1);
tpos_util.c.bak:                i= DecTrackPrg(return_code, pub_data_stru->in_data_index, pub_data_stru->in_data_key, *p, (char *)p+1, &outlen, tmp1);
tpos_util.c.bak:                              pub_data_stru->in_msg_type,
tpos_util.c.bak:          	add_pub_field(pub_data_stru, 60, pub_data_stru->in_msg_type, 15, "000005100900000", 1);
tpos_util.c.bak:                                   pub_data_stru->in_msg_type,
tpos_util.c.bak:                              pub_data_stru->in_msg_type,
tpos_util.c.bak:        del_pub_field(pub_data_stru, FIELD_PIN,pub_data_stru->in_msg_type,0);
tpos_util.c.bak:        dcs_debug(0,0,"<%s> route_pin_index=[%s]",__FUNCTION__,pub_data_stru->route_pin_index);
tpos_util.c.bak:        if(pub_data_stru->in_cry_flag && pub_data_stru->out_cry_flag) {
tpos_util.c.bak:            if(TRANS_PIN(return_code,pub_data_stru->in_pin_index,pub_data_stru->route_pin_index,pub_data_stru->in_pin_key,pub_data_stru->route_pin_key, 0,0, tmp, card_no,tmp, outPan)<0) {
tpos_util.c.bak:        } else if(pub_data_stru->in_cry_flag && !pub_data_stru->out_cry_flag) {
tpos_util.c.bak:            if(TRANS_PIN(return_code,pub_data_stru->in_pin_index,pub_data_stru->route_pin_index,pub_data_stru->in_pin_key,pub_data_stru->route_pin_key, 0,2, tmp, card_no,tmp, outPan)<0) {
tpos_util.c.bak:        } else if(!pub_data_stru->in_cry_flag && pub_data_stru->out_cry_flag) {
tpos_util.c.bak:            if(TRANS_PIN(return_code,pub_data_stru->in_pin_index,pub_data_stru->route_pin_index,pub_data_stru->in_pin_key,pub_data_stru->route_pin_key, 2,0, tmp, card_no,tmp, outPan)<0) {
tpos_util.c.bak:            if(DESTRANSPIN2(return_code,pub_data_stru->in_pin_index,pub_data_stru->route_pin_index,pub_data_stru->in_pin_key,pub_data_stru->route_pin_key,tmp,card_no,tmp,outPan) < 0) {
tpos_util.c.bak:            if(!pub_data_stru->out_cry_flag) {
tpos_util.c.bak:                                  pub_data_stru->route_msg_type,
tpos_util.c.bak:                                  pub_data_stru->route_msg_type,
tpos_util.c.bak:                                  pub_data_stru->route_msg_type,
tpos_util.c.bak:                                  pub_data_stru->route_msg_type,
tpos_util.c.bak://  i=_get_field_data(get_pub_field_id(pub_data_stru->route_msg_type, "PSAM_NO"),pub_data_stru,psam, pub_data_stru->route_num == 0 ? 0 : 1);
tpos_util.c.bak:    if(pub_data_stru->route_num == 0) {
tpos_util.c.bak:        id = get_pub_field_id(pub_data_stru->in_msg_type, "PSAM_NO");
tpos_util.c.bak:        memcpy(msg_type, pub_data_stru->in_msg_type, 4);
tpos_util.c.bak:        pub_data_stru->tmp_order[1]=terminfo.menu_update_flag[0];
tpos_util.c.bak:    return tpos_get_work_key(psam,pub_data_stru->route_pin_index,
tpos_util.c.bak:                             pub_data_stru->route_mac_index,
tpos_util.c.bak:                             pub_data_stru->route_data_index,
tpos_util.c.bak:                             pub_data_stru->route_pin_key,
tpos_util.c.bak:                             pub_data_stru->route_mac_key,
tpos_util.c.bak:                             pub_data_stru->route_data_key);
tpos_util.c.bak:                              get_pub_field_id(pub_data_stru->in_msg_type, "09"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
tpos_util.c.bak:                        get_pub_field_id(pub_data_stru->in_msg_type, "PSAM_NO"),
tpos_util.c.bak:                        pub_data_stru->in_msg_type, tPosLog.acq_term_id1,17);
tpos_util.c.bak:                        pub_data_stru->in_msg_type, tPosLog.acq_insti_code,9);
tpos_util.c.bak:                            pub_data_stru->in_msg_type,
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
tpos_util.c.bak:                         pub_data_stru->in_msg_type,
tpos_util.c.bak:                                pub_data_stru->in_msg_type,
tpos_util.c.bak:                strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code, "96");
tpos_util.c.bak:        memcpy(pub_data_stru->route_insti_code,fieldVal,8);
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code, "96");
tpos_util.c.bak:        pub_data_stru->is_route=3;
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
tpos_util.c.bak:    snprintf(pub_data_stru->route_insti_code,9,"%s",pub_data_stru->insti_code);
tpos_util.c.bak:    snprintf(pub_data_stru->route_trans_type,5,"%s",pub_data_stru->in_trans_type);
tpos_util.c.bak:    if(0 > (field_id = get_pub_field_id(pub_data_stru->in_msg_type, "0F"))) {
tpos_util.c.bak:                              pub_data_stru->in_msg_type, fieldVal,sizeof(fieldVal));
tpos_util.c.bak:                        pub_data_stru->in_msg_type,
tpos_util.c.bak:                        pub_data_stru->in_msg_type,
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:        memset(pub_data_stru->timeout_table.first_key, 0, sizeof(pub_data_stru->timeout_table.first_key));
tpos_util.c.bak:        snprintf(pub_data_stru->timeout_table.first_key,sizeof(pub_data_stru->timeout_table.first_key), "%s,%s,%s,%s,%s,%s,%s",
tpos_util.c.bak:                 pub_data_stru->in_msg_type, tPosLog.sys_date,tPosLog.acq_insti_code,tPosLog.acq_tra_no,tPosLog.acq_date,tPosLog.acq_term_id1,tPosLog.acq_term_id2);
tpos_util.c.bak:        memcpy(pub_data_stru->timeout_table.sys_date, tmp, 8);
tpos_util.c.bak:        memcpy(pub_data_stru->timeout_table.sys_time, tmp + 8, 6);
tpos_util.c.bak:        strcpy(pub_data_stru->timeout_table.foldname, SYSTEM_FOLDNAME);
tpos_util.c.bak:        snprintf(pub_data_stru->timeout_table.key,sizeof(pub_data_stru->timeout_table.key),"%s", pub_data_stru->timeout_table.first_key);
tpos_util.c.bak:        pub_data_stru->timeout_table.num = 30;
tpos_util.c.bak:        strcpy(pub_data_stru->timeout_table.flag, "2");
tpos_util.c.bak:        write_voidtrans_to_fold(&pub_data_stru->timeout_table);
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code, "00");
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_PROCESSING);
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code, CODE_NOT_EXIST);
tpos_util.c.bak:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c.bak:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c.bak:            if(strcmp(pub_data_stru->route_msg_type,"TPOS")==0) {
tpos_util.c.bak:                                pub_data_stru->route_num);
tpos_util.c.bak:                                                           pub_data_stru->in_msg_type,
tpos_util.c.bak:                                                                 pub_data_stru->in_msg_type,
tpos_util.c.bak:                                              pub_data_stru->route_msg_type,
tpos_util.c.bak:                                                           pub_data_stru->in_msg_type,
tpos_util.c.bak:                                                           pub_data_stru->in_msg_type,
tpos_util.c.bak:                  pub_data_stru->route_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type, "3C"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:    if(pub_data_stru->in_cry_flag)
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type,"3C"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,l, buf, 1);
tpos_util.c.bak:    fid = get_pub_field_id(pub_data_stru->in_msg_type, para);
tpos_util.c.bak:    fieldLen = get_field_data_safe(pub_data_stru, fid, pub_data_stru->in_msg_type,
tpos_util.c.bak:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c.bak:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c.bak:    memcpy(tmpBuf + l, pub_data_stru->center_result_code, 3);
tpos_util.c.bak:            i = get_pub_field_id(pub_data_stru->route_msg_type, "2F");
tpos_util.c.bak:                dcs_log(0, 0, "<%s>取报文%s[2F]ID失败！", __FUNCTION__, pub_data_stru->route_msg_type);
tpos_util.c.bak:            add_pub_field(pub_data_stru, i, pub_data_stru->route_msg_type,
tpos_util.c.bak:    add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type,
tpos_util.c.bak:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c.bak:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c.bak:    memcpy(fmtMsgBuf + len, pub_data_stru->center_result_code, 3);
tpos_util.c.bak:                                                           pub_data_stru->in_msg_type,
tpos_util.c.bak:                                                           pub_data_stru->in_msg_type,
tpos_util.c.bak:                                                           pub_data_stru->in_msg_type,
tpos_util.c.bak:                                                           pub_data_stru->in_msg_type,
tpos_util.c.bak:        add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
tpos_util.c.bak:    if(0 > get_field_data_safe(pub_data_stru, FIELD_TRA_NO, pub_data_stru->in_msg_type,
tpos_util.c.bak:    if(0 > get_field_data_safe(pub_data_stru, FIELD_PSAM_NO, pub_data_stru->in_msg_type,
tpos_util.c.bak:                               pub_data_stru->in_msg_type,
tpos_util.c.bak:    if(NULL== get_priv_field_def(field_name, &id,pub_data_stru->in_priv_def)) {
tpos_util.c.bak:    if(get_field_data_safe(pub_data_stru,id,pub_data_stru->in_msg_type,psam,17)<=0) {
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"03");
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"03");
tpos_util.c.bak:    if(pub_data_stru->insti_work_type) {
tpos_util.c.bak:        if(0>tpos_get_work_key(psam,pub_data_stru->in_pin_index,
tpos_util.c.bak:                               pub_data_stru->in_mac_index,
tpos_util.c.bak:                               pub_data_stru->in_data_index,
tpos_util.c.bak:                               pub_data_stru->in_pin_key,
tpos_util.c.bak:                               pub_data_stru->in_mac_key,
tpos_util.c.bak:                               pub_data_stru->in_data_key)) {
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                  pub_data_stru->in_pin_index,pub_data_stru->in_pin_key,
tpos_util.c.bak:                  pub_data_stru->in_mac_index,pub_data_stru->in_mac_key,
tpos_util.c.bak:                  pub_data_stru->in_data_index,pub_data_stru->in_data_key);
tpos_util.c.bak:                                   get_pub_field_id(pub_data_stru->in_msg_type,
tpos_util.c.bak:                                   pub_data_stru->in_msg_type,
tpos_util.c.bak:    if(memcmp(pub_data_stru->center_result_code, "00000",
tpos_util.c.bak:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c.bak:    return add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
tpos_util.c.bak:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c.bak:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c.bak:                                            get_pub_field_id(pub_data_stru->route_msg_type,
tpos_util.c.bak:                                            pub_data_stru->route_msg_type, tmp,sizeof(tmp));
tpos_util.c.bak:                                            get_pub_field_id(pub_data_stru->route_msg_type,
tpos_util.c.bak:                                            pub_data_stru->route_msg_type,
tpos_util.c.bak:                      get_pub_field_id(pub_data_stru->route_msg_type, "2F"),
tpos_util.c.bak:                      pub_data_stru->route_msg_type,
tpos_util.c.bak:                              get_pub_field_id(pub_data_stru->in_msg_type,
tpos_util.c.bak:                              pub_data_stru->in_msg_type, discnt_info.term_id,17);
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"30");
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:                                     pub_data_stru->in_msg_type,
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"96");
tpos_util.c.bak:    strcpy(pub_data_stru->center_result_code,"00");
tpos_util.c.bak:                              get_pub_field_id(pub_data_stru->in_msg_type, "09"),
tpos_util.c.bak:                              pub_data_stru->in_msg_type,
tpos_util.c.bak:                        get_pub_field_id(pub_data_stru->in_msg_type, "PSAM_NO"),
tpos_util.c.bak:                        pub_data_stru->in_msg_type, tPosLog.acq_term_id1,17);
tpos_util.c.bak:                        pub_data_stru->in_msg_type, tPosLog.acq_insti_code,9);
tpos_util.c.bak:                            pub_data_stru->in_msg_type,
tpos_util.c.bak:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
tpos_util.c.bak:                                pub_data_stru->in_msg_type,
tpos_util.c.bak:                strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
tpos_util.c.bak:        strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
tpos_util.c.bak:        add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type, 0, para, 1);
tpos_util.c.bak:        add_pub_field(pub_data_stru, fldid, pub_data_stru->route_msg_type, strlen(tmp), tmp, 1);
tpos_util.c.bak:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c.bak:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c.bak:            if(strcmp(pub_data_stru->route_msg_type,"TPOS")==0) {
tpos_util.c.bak:		                    msgtype = pub_data_stru->route_msg_type;
tpos_util.c.bak:		                    msgtype = pub_data_stru->in_msg_type;
tpos_util.c.bak:                                pub_data_stru->route_num);
tpos_util.c.bak:                  pub_data_stru->route_msg_type,
tpos_util.c.bak:    if(memcmp("00000", pub_data_stru->center_result_code,
tpos_util.c.bak:              strlen(pub_data_stru->center_result_code))) return 1;
tpos_util.c.bak:    memcpy(fmtMsgBuf + len, pub_data_stru->center_result_code, 3);
tpos_util.c.bak:		                    msgtype = pub_data_stru->route_msg_type;
tpos_util.c.bak:		                    msgtype = pub_data_stru->in_msg_type;
tpos_util.c.bak:        add_pub_field(pub_data_stru, fldid,pub_data_stru->route_msg_type,
util.c:    if(0>folder_to_insti_code(pub_data_stru->insti_code)) return -1;
util.c:        add_pub_field(pub_data_stru,33,strlen(pub_data_stru->insti_code),
util.c:                      pub_data_stru->insti_code, 0 ,NULL);
util.c:        if(strcmp(tmp,pub_data_stru->insti_code)!=0) {
util.c:                    __FUNCTION__,tmp,pub_data_stru->insti_code);
util.c:        strcpy(pub_data_stru->center_result_code, CODE_CUPS_NOT_OPERATE);
util.c:        if(pub_data_stru->switch_src_flag == 0)
util.c:    if((data_len <0) || ((MAX_BUFFER - pub_data_stru->off_set) < data_len)) {
util.c:    if(pub_data_stru->msg_field_num >=MAX_FIELD || id <0) {
util.c:    for(i=0 ; i<pub_data_stru->msg_field_num ; i++) {
util.c:        if(id == pub_data_stru->data_rec[i].field_id &&
util.c:           from == pub_data_stru->data_rec[i].from &&
util.c:           pub_data_stru->data_rec[i].Off ==1) {
util.c:                pub_data_stru->data_rec[i].len=0;
util.c:                if(pub_data_stru->data_rec[i].data_addr+pub_data_stru->data_rec[i].len != pub_data_stru->buffer+pub_data_stru->off_set) {
util.c:                    if((MAX_BUFFER - pub_data_stru->off_set) <= (pub_data_stru->data_rec[i].len+1+data_len)) {
util.c:                    if(pub_data_stru->data_rec[i].len <2048)
util.c:                        memcpy(caBuf,pub_data_stru->data_rec[i].data_addr,pub_data_stru->data_rec[i].len);
util.c:                        dcs_log(0,0,"<%s> data_len[%d] limited",__FUNCTION__,pub_data_stru->data_rec[i].len);
util.c:                    pub_data_stru->data_rec[i].data_addr= pub_data_stru->buffer+pub_data_stru->off_set;
util.c:                    pub_data_stru->off_set= pub_data_stru->off_set+pub_data_stru->data_rec[i].len;
util.c:                    memcpy(pub_data_stru->data_rec[i].data_addr,caBuf,pub_data_stru->data_rec[i].len);
util.c:                pub_data_stru->buffer[pub_data_stru->off_set]=0x00;
util.c:                pub_data_stru->off_set++;
util.c:                pub_data_stru->data_rec[i].len++;
util.c:            pub_data_stru->msg_field_num--;
util.c:        i=pub_data_stru->msg_field_num;
util.c:    pub_data_stru->data_rec[i].field_id = id;
util.c:        pub_data_stru->data_rec[i].control_info[0]=0x00;
util.c:            memcpy(pub_data_stru->data_rec[i].control_info,control_info,strlen(control_info));
util.c:            memcpy(pub_data_stru->data_rec[i].control_info,control_info,5);
util.c:        pub_data_stru->data_rec[i].data_addr=pub_data_stru->buffer+pub_data_stru->off_set;
util.c:    pub_data_stru->data_rec[i].Off=1;
util.c:    pub_data_stru->data_rec[i].from=from;
util.c:    memcpy(pub_data_stru->data_rec[i].data_addr+pub_data_stru->data_rec[i].len,data,data_len);
util.c:    pub_data_stru->data_rec[i].len=pub_data_stru->data_rec[i].len+data_len;
util.c:    pub_data_stru->off_set=pub_data_stru->off_set+data_len;
util.c:    pub_data_stru->msg_field_num++;
util.c:    return pub_data_stru->data_rec[i].len;
util.c:    if((data_len <0) || ((MAX_BUFFER - pub_data_stru->off_set) < data_len)) {
util.c:    for(i=0 ; i<pub_data_stru->msg_field_num ; i++) {
util.c:        if(id == pub_data_stru->data_rec[i].field_id &&
util.c:           from == pub_data_stru->data_rec[i].from &&
util.c:           pub_data_stru->data_rec[i].Off ==1) {
util.c:                pub_data_stru->data_rec[i].len=0;
util.c:            if(data_len > pub_data_stru->data_rec[i].len) {
util.c:                if(pub_data_stru->data_rec[i].data_addr+pub_data_stru->data_rec[i].len != pub_data_stru->buffer+pub_data_stru->off_set) {
util.c:        pub_data_stru->data_rec[i].control_info[0]=0x00;
util.c:            memcpy(pub_data_stru->data_rec[i].control_info,control_info,strlen(control_info));
util.c:            memcpy(pub_data_stru->data_rec[i].control_info,control_info,5);
util.c:        pub_data_stru->data_rec[i].data_addr=pub_data_stru->buffer+pub_data_stru->off_set;
util.c:    memcpy(pub_data_stru->data_rec[i].data_addr,data,data_len);
util.c:    pub_data_stru->data_rec[i].len=data_len;
util.c:        pub_data_stru->off_set=pub_data_stru->off_set+data_len;
util.c:        pub_data_stru->off_set= pub_data_stru->data_rec[i].data_addr - pub_data_stru->buffer+data_len;
util.c:    for(i=0 ; i<pub_data_stru->msg_field_num ; i++) {
util.c:        if(id == pub_data_stru->data_rec[i].field_id &&
util.c:           from == pub_data_stru->data_rec[i].from &&
util.c:           pub_data_stru->data_rec[i].Off ==1) {
util.c:            pub_data_stru->data_rec[i].Off=0;
util.c://          pub_data_stru->msg_field_num--;
util.c:    switch(pub_data_stru->timeout_table.flag[0]) {
util.c:            pub_data_stru->timeout_table.flag[0]++;
util.c:    write_voidtrans_to_fold(&pub_data_stru->timeout_table);
util.c:    for(i=0; i<pub_data_stru->msg_field_num; i++) {
util.c:        if(field_id == pub_data_stru->data_rec[i].field_id && pub_data_stru->data_rec[i].Off) {
util.c:            memcpy(data,pub_data_stru->data_rec[i].data_addr,pub_data_stru->data_rec[i].len);
util.c:            data[pub_data_stru->data_rec[i].len]=0x00;
util.c:            return pub_data_stru->data_rec[i].len;
util.c:    for(i=0; i<pub_data_stru->msg_field_num; i++) {
util.c:        if(field_id == pub_data_stru->data_rec[i].field_id && pub_data_stru->data_rec[i].Off) {
util.c:            if(pub_data_stru->data_rec[i].len > size)
util.c:                memcpy(data,pub_data_stru->data_rec[i].data_addr,size);
util.c:                memcpy(data,pub_data_stru->data_rec[i].data_addr,pub_data_stru->data_rec[i].len);
util.c:            return pub_data_stru->data_rec[i].len;
util.c://  dcs_debug(0,0,"<get_field_data> begin num=%d",pub_data_stru->msg_field_num);
util.c:    for(i=0; i<pub_data_stru->msg_field_num; i++) {
util.c://        memcpy(tmp,pub_data_stru->data_rec[i].data_addr,pub_data_stru->data_rec[i].len);
util.c://        dcs_debug(0,0,"field_id[%d]=%.*s,off=%d",pub_data_stru->data_rec[i].field_id,pub_data_stru->data_rec[i].len,pub_data_stru->data_rec[i].data_addr,pub_data_stru->data_rec[i].Off);
util.c:        if(field_id == pub_data_stru->data_rec[i].field_id && pub_data_stru->data_rec[i].Off && pub_data_stru->data_rec[i].from== flag) {
util.c:            memcpy(data,pub_data_stru->data_rec[i].data_addr,pub_data_stru->data_rec[i].len);
util.c:            data[pub_data_stru->data_rec[i].len]=0x00;
util.c:            return pub_data_stru->data_rec[i].len;
util.c:    for(i=0; i<pub_data_stru->msg_field_num; i++) {
util.c:        if(field_id == pub_data_stru->data_rec[i].field_id && pub_data_stru->data_rec[i].Off && pub_data_stru->data_rec[i].from== flag) {
util.c:            if(size >pub_data_stru->data_rec[i].len)
util.c:                memcpy(data,pub_data_stru->data_rec[i].data_addr,pub_data_stru->data_rec[i].len);
util.c:                memcpy(data,pub_data_stru->data_rec[i].data_addr,size);
util.c:            return pub_data_stru->data_rec[i].len;
util.c:    if(pub_data_stru->route_insti_open_flag == 0) {
util.c:        dcs_log(0, 0, "<%s>接收机构[%s]已关闭！",   __FUNCTION__, pub_data_stru->route_insti_code);
util.c:        strcpy(pub_data_stru->center_result_code, CODE_CUPS_NOT_OPERATE);
util.c:    rtrim(pub_data_stru->route_fold_name);
util.c:    iDescFid = fold_locate_folder(pub_data_stru->route_fold_name);
util.c:        dcs_log(0, 0, "<%s>取接收机构fold name[%s]出错！",  __FUNCTION__, pub_data_stru->route_fold_name);
util.c:        strcpy(pub_data_stru->center_result_code, CODE_CUPS_NOT_OPERATE);
util.c:    if(pub_data_stru->route_insti_link_type == 1) {
util.c:        if(IsReady(pub_data_stru->route_fold_name) < 0) {
util.c:            strcpy(pub_data_stru->center_result_code, CODE_CUPS_NOT_OPERATE);
util.c:        if(strcmp(gl_pre_field_conver[i].name, pub_data_stru->in_msg_type) == 0)
util.c:    if(0 < get_field_data_safe(get_pub_field_id(pub_data_stru->in_msg_type,"04"), pub_data_stru, tmpBuf,2)) {
util.c:    return SetFieldData(pub_data_stru->timeout_table.remark, fldid, t_buf, sizeof(pub_data_stru->timeout_table.remark), 1);
util.c:    f_len = GetFieldData(pub_data_stru->timeout_table.remark, d_fldid, buff, sizeof(buff), 1);
util.c:                    msgtype = pub_data_stru->route_msg_type;
util.c:                    msgtype = pub_data_stru->in_msg_type;
util.c:    fieldLen = get_field_data_safe(get_pub_field_id(pub_data_stru->in_msg_type, para), pub_data_stru, fieldVal,sizeof(fieldVal));
util.c:    if(flag && memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) == 0)
util.c:    if(pub_data_stru->route_num == 0 && pub_data_stru->switch_src_flag == 1) return 1;
util.c:    pub_data_stru->switch_src_flag=1;
util.c:    len=_get_field_data_safe(get_pub_field_id(DB_MSG_TYPE, "ACQ_INSTI_CODE"), pub_data_stru, pub_data_stru->route_insti_code, 2,8);
util.c:    if(len >0) pub_data_stru->route_insti_code[len]=0x00;
util.c:    len=_get_field_data_safe(get_pub_field_id(DB_MSG_TYPE, "ACQ_TRANS_TYPE"), pub_data_stru, pub_data_stru->route_trans_type, 2,4);
util.c:    if(len >0) pub_data_stru->route_trans_type[len]=0x00;
util.c:        SetTransLog(&TransLog, "APP_MSG_TYPE", pub_data_stru->route_msg_type, 0, pub_data_stru);
util.c:        SetTransLog(&TransLog, "APP_TRANS_TYPE", pub_data_stru->route_trans_type, 0, pub_data_stru);
util.c:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
util.c:    if(pub_data_stru->timeout_table.flag[0] == '1' ||  pub_data_stru->timeout_table.flag[0] == '2')
util.c:    strcpy(TransLog.resp_cd_rcv, pub_data_stru->center_result_code);
util.c:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
util.c:    if(pub_data_stru->timeout_table.flag[0] == '1' ||  pub_data_stru->timeout_table.flag[0] == '2')
util.c:        strcpy(TransLog.resp_cd_rcv, pub_data_stru->center_result_code);
util.c:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
util.c:        SetTransLog(&TransLog, "PAY_MSG_TYPE", pub_data_stru->route_msg_type, 0, pub_data_stru);
util.c:        SetTransLog(&TransLog, "PAY_TRANS_TYPE", pub_data_stru->route_trans_type, 0, pub_data_stru);
util.c:    sprintf(TransLog.step, "%d", pub_data_stru->route_num);
util.c:    if((flag && pub_data_stru->out_cry_flag) ||
util.c:       (!flag && pub_data_stru->in_cry_flag)) {
util.c:        if(pub_data_stru->out_cry_flag)
util.c:            i = GenMacSM(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, buf, bufLen, macAsc);
util.c:            i = GenMac3Des(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, buf, bufLen, macAsc);
util.c:        if(pub_data_stru->in_cry_flag)
util.c:            i= GenMacSM(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc);
util.c:            i = GenMac3Des(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc);
util.c:    if(pub_data_stru->out_cry_flag) {
util.c:        i = GenMac(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, buf, bufLen, macAsc);
util.c:        i = GenMac(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc);
util.c:    snprintf(msgkey,sizeof(msgkey),"%s", pub_data_stru->timeout_table.first_key);
util.c:        dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
util.c:    dcs_debug(0,0,"<%s> POS_ENTRY_MD_CD=%d, req_flag=%d,fldid=%d",__FUNCTION__,POS_ENTRY_MD_CD,pub_data_stru->req_flag,fldid);
util.c:    if(pub_data_stru->req_flag) {
util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
util.c:                strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
util.c:        if(0>DESTRANSPIN2(reCode,  pub_data_stru->in_pin_index, pub_data_stru->route_pin_index, pub_data_stru->in_pin_key, pub_data_stru->route_pin_key, pinBin, inPan, pinNewBuf, outPan))
util.c://    if (0 >   DESPINTR(reCode, pinNewBin, pub_data_stru->in_pin_index, pub_data_stru->in_pin_key, pub_data_stru->route_pin_index, pub_data_stru->route_pin_key, pinBin, inPan, outPan))
util.c:            strcpy(pub_data_stru->center_result_code, CODE_PIN_ERR);
util.c:            strcpy(pub_data_stru->center_result_code, CODE_PIN_ERR);
util.c:    snprintf(pub_data_stru->route_insti_code,9,"%s", pub_data_stru->insti_code);
util.c:    snprintf(pub_data_stru->route_msg_type  ,5,"%s", pub_data_stru->in_msg_type);
util.c:    snprintf(pub_data_stru->route_fold_name ,40,"%s", pub_data_stru->insti_fold_name);
util.c:    snprintf(pub_data_stru->route_mac_index ,6 ,"%s",pub_data_stru->in_mac_index);
util.c:    snprintf(pub_data_stru->route_mac_key   ,33 ,"%s",pub_data_stru->in_mac_key);
util.c:    snprintf(pub_data_stru->route_trans_type, 5,"%s",pub_data_stru->in_trans_type);
util.c:    if(pub_data_stru->center_result_code[0] == 0)
util.c:        strcpy(pub_data_stru->center_result_code, CODE_SYSTEM_ERR);
util.c:        if(0 == strcmp(pub_data_stru->center_result_code, "00") || pub_data_stru->center_result_code[0] == 0) {
util.c:            strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
util.c:    def=get_priv_field_def_for_id(FIELD_MAC,match_priv_stru(pub_data_stru->in_msg_type));
util.c:    def=get_priv_field_def_for_id(FIELD_TPDU,match_priv_stru(pub_data_stru->in_msg_type));
util.c:        bufLen = pub_data_stru->src_len;
util.c:        buf = pub_data_stru->src_buffer;
util.c:        bufLen = pub_data_stru->src_len;
util.c:        buf = pub_data_stru->src_buffer;
util.c:    if(0 > GenMac(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc)) {
util.c:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
util.c:    def=get_priv_field_def_for_id(FIELD_MAC,match_priv_stru(pub_data_stru->in_msg_type));
util.c:        strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
util.c:        if(0 == strcmp(pub_data_stru->center_result_code, "00") || pub_data_stru->center_result_code[0] == 0) {
util.c:            strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
util.c:    def=get_priv_field_def_for_id(FIELD_MAC,match_priv_stru(pub_data_stru->in_msg_type));
util.c:        def=get_priv_field_def_for_id(FIELD_TPDU,match_priv_stru(pub_data_stru->in_msg_type));
util.c:    bufLen = pub_data_stru->src_len - headLen;
util.c:    buf = pub_data_stru->src_buffer+headLen;
util.c:    if(pub_data_stru->in_cry_flag) {
util.c:    if(pub_data_stru->in_cry_flag) {
util.c:        if(0 > GenMacSM(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc)) {
util.c:            strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
util.c:        if(0 > GenMac3Des(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, buf, bufLen, macAsc)) {
util.c:            strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
util.c:        strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
util.c:    if(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code))) {
util.c:            pub_data_stru->timeout_table.flag[0] = '2';
util.c:            pub_data_stru->timeout_table.flag[0] = '0';
util.c:    snprintf(msgkey,sizeof(msgkey),"%s", pub_data_stru->timeout_table.first_key);
util.c:        dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
util.c:    if(!(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) == 0 ||
util.c:         strcmp(pub_data_stru->center_result_code, CODE_NOT_EXIST) == 0)) {
util.c:            pub_data_stru->timeout_table.flag[0]  = '2';
util.c:            write_voidtrans_to_fold(&pub_data_stru->timeout_table);
util.c:    memcpy(pub_data_stru->in_mac_key, tmpbuf, 32);
util.c:    memcpy(pub_data_stru->in_pin_key, tmpbuf, 32);
util.c:    return update_key(pub_data_stru->insti_code, pub_data_stru->in_mac_key, pub_data_stru->in_pin_key);
util.c:    if(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) != 0 &&
util.c:       strcmp(pub_data_stru->center_result_code, CODE_NOT_EXIST) != 0) {
util.c:        if(0 < pub_data_stru->timeout_table.num--) {
util.c:            pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
util.c:        dcs_debug(0,0,"<%s> timeout num=[%d]",__FUNCTION__,pub_data_stru->timeout_table.num);
util.c:                strcpy(msgkey, pub_data_stru->timeout_table.first_key);
util.c:                    dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
util.c:    if(0 > get_key_info(pub_data_stru->insti_code, mac_tek_indx, mac_tm_key, pin_tek_indx, pin_tm_key))
util.c:    if(0 > DESTMKGETPIKMAK2(return_code, pub_data_stru->in_mac_index, mac_tek_indx, mac_tm_key, key_data1, key_data2, check_value, "Y", "Y")) {
util.c:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
util.c:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
util.c:    memcpy(pub_data_stru->in_mac_key, key_data1, 32);
util.c:    if(0 > DESTMKGETPIKMAK2(return_code, pub_data_stru->in_pin_index, pin_tek_indx, pin_tm_key, key_data1, key_data2, check_value, "Y", "Y")) {
util.c:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
util.c:        strcpy(pub_data_stru->center_result_code, CODE_SAFE_ERR);
util.c:    memcpy(pub_data_stru->in_pin_key, key_data1, 32);
util.c:    return update_key(pub_data_stru->insti_code, pub_data_stru->in_mac_key, pub_data_stru->in_pin_key);
util.c:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
util.c:                strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
util.c:        strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
util.c:    if(strcmp(pub_data_stru->in_msg_type,"ZPOS")==0) {
util.c:        snprintf(pub_data_stru->route_msg_type,5,"%s",pub_data_stru->in_msg_type);
util.c:        snprintf(pub_data_stru->route_insti_code,9,"%s",pub_data_stru->insti_code);
util.c:        snprintf(pub_data_stru->route_fold_name,40,"%s",pub_data_stru->insti_fold_name);
util.c:        snprintf(pub_data_stru->route_trans_type,5,"%s",pub_data_stru->in_trans_type);
util.c:        pub_data_stru->tmp_order[0]=0x30;
util.c:    if(strcmp(pub_data_stru->in_msg_type,"ZPOS")==0) {
util.c:    } else if(strcmp(pub_data_stru->in_msg_type,"LINS")==0) {
util.c:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
util.c:            strcpy(pub_data_stru->center_result_code, CODE_INVALID_TRANS);
util.c:        memset(pub_data_stru->timeout_table.first_key, 0, sizeof(pub_data_stru->timeout_table.first_key));
util.c:        snprintf(pub_data_stru->timeout_table.first_key,sizeof(pub_data_stru->timeout_table.first_key), "%s,%s,%s,%s,%s,%s,%s",
util.c:                 pub_data_stru->in_msg_type, TransLog.sys_date,TransLog.acq_insti_code,TransLog.acq_tra_no,TransLog.acq_date,TransLog.acq_term_id1,TransLog.acq_term_id2);
util.c://      sprintf(pub_data_stru->timeout_table.first_key, "%s,%s,%s,%s,%s,%s", TransLog.
util.c:        memcpy(pub_data_stru->timeout_table.sys_date, tmp, 8);
util.c:        memcpy(pub_data_stru->timeout_table.sys_time, tmp + 8, 6);
util.c:        strcpy(pub_data_stru->timeout_table.foldname, SYSTEM_FOLDNAME);
util.c:        snprintf(pub_data_stru->timeout_table.key,sizeof(pub_data_stru->timeout_table.key) ,"%s",pub_data_stru->timeout_table.first_key);
util.c:        pub_data_stru->timeout_table.num = 30;
util.c:        strcpy(pub_data_stru->timeout_table.flag, "2");
util.c:        write_voidtrans_to_fold(&pub_data_stru->timeout_table);
util.c:            strcpy(pub_data_stru->center_result_code, "00");
util.c:            strcpy(pub_data_stru->center_result_code, CODE_PROCESSING);
util.c:        strcpy(pub_data_stru->center_result_code, CODE_NOT_EXIST);
util.c:        if(0 == strcmp(pub_data_stru->center_result_code, "00") || pub_data_stru->center_result_code[0] == 0) {
util.c:            strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
util.c:    bufLen = pub_data_stru->src_len;
util.c:        buf = pub_data_stru->src_buffer + headLen;
util.c:        strcpy(pub_data_stru->center_result_code, CODE_MAC_ERR);
util.c:    msg_type = flag ? pub_data_stru->route_msg_type : pub_data_stru->in_msg_type;
util.c:        ret = GenMac3Des(pub_data_stru->route_mac_index, pub_data_stru->route_mac_key, macBuf, mac_offset, mac);
util.c:        ret = GenMac3Des(pub_data_stru->in_mac_index, pub_data_stru->in_mac_key, macBuf, mac_offset, mac);
util.c:        strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
util.c:            strcpy(pub_data_stru->center_result_code, CODE_CARD_NO_ALLOW);
util.c:        strcpy(pub_data_stru->center_result_code, CODE_CARD_NO_ALLOW);
util.c:            strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
util.c:            if(0 > AddUpTrans(cardno, &addup_amount, &addup_count, pub_data_stru->app_type, 0))
util.c:                strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
util.c:                strcpy(pub_data_stru->center_result_code, CODE_COUNT_LIMIT);
util.c:            strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
util.c:            if(0 > AddUpTrans(cardno, &addup_amount, &addup_count, pub_data_stru->app_type, 0))
util.c:                strcpy(pub_data_stru->center_result_code, CODE_AMOUNT_LIMIT);
util.c:                strcpy(pub_data_stru->center_result_code, CODE_COUNT_LIMIT);
util.c:    if(memcmp(pub_data_stru->in_msg_type, "TPOS", 4)) {
util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
util.c:            strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
util.c:        if(11 >= (len = get_field_data_safe(get_pub_field_id(pub_data_stru->in_msg_type, "3B"), pub_data_stru, fieldVal,sizeof(fieldVal)))) {
util.c:            strcpy(pub_data_stru->center_result_code, CODE_PACK_ERR);
util.c:            strcpy(pub_data_stru->center_result_code, ret == 1 ? CODE_PROCESSING : CODE_INVALID_TRANS);
util.c:            i=get_field_data_safe(get_pub_field_id(pub_data_stru->in_msg_type, tmp), pub_data_stru, fieldVal,sizeof(fieldVal)-1);
util.c:    if(strcmp(pub_data_stru->in_msg_type,"TPOS")==0 &&
util.c:            i=get_field_data_safe(get_pub_field_id(pub_data_stru->in_msg_type, tmp), pub_data_stru, fieldVal,sizeof(fieldVal)-1);
util.c:    i=get_field_data_safe(get_pub_field_id(pub_data_stru->in_msg_type, "121"), pub_data_stru, tmp,sizeof(tmp)-1);
util.c:    dcs_debug(0,0,"<%s> flag=[%c],center_result_code=[%s]",__FUNCTION__,flag,pub_data_stru->center_result_code);
util.c:    if(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code)) != 0 ||
util.c:        if(0 < pub_data_stru->timeout_table.num--) {
util.c:            pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
util.c:        snprintf(msgkey,sizeof(msgkey),"%s", pub_data_stru->timeout_table.first_key);
util.c:            dcs_log(0, 0, "<FILE:%s,LINE:%d %s>解析first_key[%s]失败！", __FILE__, __LINE__, __FUNCTION__,pub_data_stru->timeout_table.first_key);
util.c:        i=_get_field_data_safe(get_pub_field_id(pub_data_stru->in_msg_type, "15"), pub_data_stru, tmp,0 ,sizeof(tmp)-1);
util.c:            if(0 < pub_data_stru->timeout_table.num--) {
util.c:                pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
util.c:    if(pub_data_stru->route_num == 0 && pub_data_stru->switch_src_flag == 1) return 1;
util.c:    strcpy(ret_code,pub_data_stru->center_result_code);
util.c:    if(memcmp(pub_data_stru->center_result_code, "FC", strlen(pub_data_stru->center_result_code)) ==0) {
util.c:        if(0 < pub_data_stru->timeout_table.num--) {
util.c:            pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
util.c:        strcpy(msgkey, pub_data_stru->timeout_table.first_key);
util.c:            dcs_log(0, 0, "<FILE:%s,LINE:%d>解析first_key[%s]失败！", __FILE__, __LINE__, pub_data_stru->timeout_table.first_key);
util.c:        i=_get_field_data_safe(get_pub_field_id(pub_data_stru->in_msg_type, "15"), pub_data_stru, tmp,0 ,sizeof(tmp)-1);
util.c:            if(0 < pub_data_stru->timeout_table.num--) {
util.c:                pub_data_stru->timeout_table.invalid_time = time(NULL)+(30-pub_data_stru->timeout_table.num)*SYS_TIME_OUT;
util.c:    len=get_field_data_safe(get_pub_field_id(pub_data_stru->in_msg_type, "3D"), pub_data_stru, tmp,sizeof(tmp)-1);
util.c:    if(memcmp(pub_data_stru->route_insti_code,tmp,8)==0) {
util.c:        memcpy(pub_data_stru->route_trans_type,tmp,4);
xml_pack.c:    p_set=&pub_data_stru->route_set;
xml_pack.c:    pub_data_stru->route_priv_def=priv_def;
zpos_util.c:    snprintf(pub_data_stru->route_msg_type,5,"%s",pub_data_stru->in_msg_type);
zpos_util.c:    snprintf(pub_data_stru->route_insti_code,9,"%s",pub_data_stru->insti_code);
zpos_util.c:    snprintf(pub_data_stru->route_fold_name,40,"%s",pub_data_stru->insti_fold_name);
zpos_util.c:    snprintf(pub_data_stru->route_trans_type,5,"%s",pub_data_stru->in_trans_type);
zpos_util.c:    pub_data_stru->tmp_order[0]=0x30;
zpos_util.c:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"DATE"),
zpos_util.c:                  pub_data_stru->route_msg_type,8,tmp,1);
zpos_util.c:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"TIME"),
zpos_util.c:                  pub_data_stru->route_msg_type,6,tmp+8,1);
zpos_util.c:    if(0>(i=get_field_data_safe(pub_data_stru,20,pub_data_stru->in_msg_type,psam,17))) {
zpos_util.c:        strcpy(pub_data_stru->center_result_code,"96");
zpos_util.c:    if(0>(i=get_field_data_safe(pub_data_stru,20,pub_data_stru->in_msg_type,psam,17))) {
zpos_util.c:        dcs_log(0,0,"<%s> get terminal no fail! field_num=%d",__FUNCTION__,pub_data_stru->msg_field_num);
zpos_util.c:    if(pub_data_stru->insti_work_type) {
zpos_util.c:        if(0>tpos_get_work_key(psam,pub_data_stru->in_pin_index,pub_data_stru->in_mac_index,pub_data_stru->in_data_index,pub_data_stru->in_pin_key,pub_data_stru->in_mac_key,pub_data_stru->in_data_key)) {
zpos_util.c:            strcpy(pub_data_stru->center_result_code,"96");
zpos_util.c:                  pub_data_stru->in_pin_index,pub_data_stru->in_pin_key,pub_data_stru->in_mac_index,pub_data_stru->in_mac_key,pub_data_stru->in_data_index,pub_data_stru->in_data_key);
zpos_util.c:        snprintf(pub_data_stru->route_mac_index,5,"%s",pub_data_stru->in_pin_index);
zpos_util.c:        snprintf(pub_data_stru->route_mac_key,33,"%s",pub_data_stru->in_mac_key);
zpos_util.c:        strcpy(pub_data_stru->center_result_code,"Z1");
zpos_util.c:        strcpy(pub_data_stru->center_result_code,"Z1");
zpos_util.c:    n= get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "60"),
zpos_util.c:                           pub_data_stru->in_msg_type,tmp,sizeof(tmp));
zpos_util.c:        strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c:            add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type, "62"),
zpos_util.c:                          pub_data_stru->route_msg_type, n+1, buf, 1);
zpos_util.c:            if(n >0)   add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type, "60"),
zpos_util.c:                                         pub_data_stru->route_msg_type, 2, "11", 1);
zpos_util.c:            else if(n==0) add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type, "60"),
zpos_util.c:                                            pub_data_stru->route_msg_type, 2, "10", 1);
zpos_util.c:            add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"62"),
zpos_util.c:                          pub_data_stru->route_msg_type, n+1, buf, 1);
zpos_util.c:            if(n >0) add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type, "60"),
zpos_util.c:                                       pub_data_stru->route_msg_type, 2, "21", 1);
zpos_util.c:            else if(n==0) add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type, "60"),
zpos_util.c:                                            pub_data_stru->route_msg_type, 2, "20", 1);
zpos_util.c:    snprintf(pub_data_stru->route_msg_type,5,"%s",pub_data_stru->in_msg_type);
zpos_util.c:    snprintf(pub_data_stru->route_insti_code,9,"%s",pub_data_stru->insti_code);
zpos_util.c:    snprintf(pub_data_stru->route_fold_name,40,"%s",pub_data_stru->insti_fold_name);
zpos_util.c:    snprintf(pub_data_stru->route_trans_type,5,"%s",pub_data_stru->in_trans_type);
zpos_util.c:    pub_data_stru->tmp_order[0]=0x30;
zpos_util.c:    n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "20"),
zpos_util.c:                          pub_data_stru->in_msg_type,psam,17);
zpos_util.c:        strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c:    n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "60"),
zpos_util.c:                          pub_data_stru->in_msg_type,tmp,sizeof(tmp));
zpos_util.c:        strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c:        n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "39"),
zpos_util.c:                              pub_data_stru->in_msg_type,tmp,sizeof(tmp));
zpos_util.c:                add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"62"),
zpos_util.c:                              pub_data_stru->route_msg_type, n+1, tmp, 1);
zpos_util.c:            strcpy(pub_data_stru->center_result_code,"96");
zpos_util.c:    if(n >=0) strcpy(pub_data_stru->center_result_code,"00");
zpos_util.c:    else strcpy(pub_data_stru->center_result_code,"96");
zpos_util.c:    if(!pub_data_stru->switch_src_flag) return 1;
zpos_util.c:    if(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code))) {
zpos_util.c:    n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "20"),
zpos_util.c:                          pub_data_stru->in_msg_type,psam,17);
zpos_util.c:        strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c:    return add_pub_field(pub_data_stru,fldid, pub_data_stru->route_msg_type,
zpos_util.c:	                              pub_data_stru->in_msg_type,
zpos_util.c:    if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"36"),
zpos_util.c:                              pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
zpos_util.c:        i=DecTrackPrg(return_code, pub_data_stru->in_data_index, pub_data_stru->in_data_key, n, tmp, &outlen, tmp);
zpos_util.c:                strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c:                add_pub_field(pub_data_stru, FIELD_TRACK2,pub_data_stru->in_msg_type,n,tmp1+2,1);
zpos_util.c:                    add_pub_field(pub_data_stru, 60, pub_data_stru->in_msg_type, 15, "000005200900000", 1);
zpos_util.c:                    add_pub_field(pub_data_stru, 60, pub_data_stru->in_msg_type, 15, "000005000900000", 1);
zpos_util.c:                add_pub_field(pub_data_stru, 60, pub_data_stru->in_msg_type, 15, "000005000900000", 1);
zpos_util.c:                add_pub_field(pub_data_stru, FIELD_CARD_NO, pub_data_stru->in_msg_type,
zpos_util.c:                    strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c:                add_pub_field(pub_data_stru,FIELD_TRACK3,pub_data_stru->in_msg_type,i,tmp1+2+3+n,1);
zpos_util.c:            del_pub_field(pub_data_stru,FIELD_TRACK3,pub_data_stru->in_msg_type,0);
zpos_util.c:            strcpy(pub_data_stru->center_result_code,"91");
zpos_util.c:        add_pub_field(pub_data_stru, 60, pub_data_stru->in_msg_type, 15, "000000000300000", 1);
zpos_util.c:    return tpos_get_work_key(psam,pub_data_stru->route_pin_index,pub_data_stru->route_mac_index,pub_data_stru->route_data_index,pub_data_stru->route_pin_key,pub_data_stru->route_mac_key,pub_data_stru->route_data_key);
zpos_util.c:    snprintf(pub_data_stru->route_msg_type,5,"%s",pub_data_stru->in_msg_type);
zpos_util.c:    snprintf(pub_data_stru->route_insti_code,9,"%s",pub_data_stru->insti_code);
zpos_util.c:    snprintf(pub_data_stru->route_fold_name,40,"%s",pub_data_stru->insti_fold_name);
zpos_util.c:    snprintf(pub_data_stru->route_trans_type,5,"%s",pub_data_stru->in_trans_type);
zpos_util.c:    pub_data_stru->tmp_order[0]=0x30;
zpos_util.c:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"DATE"),
zpos_util.c:                  pub_data_stru->route_msg_type,8,tmp,1);
zpos_util.c:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"TIME"),
zpos_util.c:                  pub_data_stru->route_msg_type,6,tmp+8,1);
zpos_util.c:        strcpy(pub_data_stru->center_result_code,"96");
zpos_util.c:        strcpy(pub_data_stru->center_result_code,"00");
zpos_util.c.bak:    snprintf(pub_data_stru->route_msg_type,5,"%s",pub_data_stru->in_msg_type);
zpos_util.c.bak:    snprintf(pub_data_stru->route_insti_code,9,"%s",pub_data_stru->insti_code);
zpos_util.c.bak:    snprintf(pub_data_stru->route_fold_name,40,"%s",pub_data_stru->insti_fold_name);
zpos_util.c.bak:    snprintf(pub_data_stru->route_trans_type,5,"%s",pub_data_stru->in_trans_type);
zpos_util.c.bak:    pub_data_stru->tmp_order[0]=0x30;
zpos_util.c.bak:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"DATE"),
zpos_util.c.bak:                  pub_data_stru->route_msg_type,8,tmp,1);
zpos_util.c.bak:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"TIME"),
zpos_util.c.bak:                  pub_data_stru->route_msg_type,6,tmp+8,1);
zpos_util.c.bak:    if(0>(i=get_field_data_safe(pub_data_stru,20,pub_data_stru->in_msg_type,psam,17))) {
zpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"96");
zpos_util.c.bak:    if(0>(i=get_field_data_safe(pub_data_stru,20,pub_data_stru->in_msg_type,psam,17))) {
zpos_util.c.bak:        dcs_log(0,0,"<%s> get terminal no fail! field_num=%d",__FUNCTION__,pub_data_stru->msg_field_num);
zpos_util.c.bak:    if(pub_data_stru->insti_work_type) {
zpos_util.c.bak:        if(0>tpos_get_work_key(psam,pub_data_stru->in_pin_index,pub_data_stru->in_mac_index,pub_data_stru->in_data_index,pub_data_stru->in_pin_key,pub_data_stru->in_mac_key,pub_data_stru->in_data_key)) {
zpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"96");
zpos_util.c.bak:                  pub_data_stru->in_pin_index,pub_data_stru->in_pin_key,pub_data_stru->in_mac_index,pub_data_stru->in_mac_key,pub_data_stru->in_data_index,pub_data_stru->in_data_key);
zpos_util.c.bak:        snprintf(pub_data_stru->route_mac_index,5,"%s",pub_data_stru->in_pin_index);
zpos_util.c.bak:        snprintf(pub_data_stru->route_mac_key,33,"%s",pub_data_stru->in_mac_key);
zpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"Z1");
zpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"Z1");
zpos_util.c.bak:    n= get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "60"),
zpos_util.c.bak:                           pub_data_stru->in_msg_type,tmp,sizeof(tmp));
zpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c.bak:            add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type, "62"),
zpos_util.c.bak:                          pub_data_stru->route_msg_type, n+1, buf, 1);
zpos_util.c.bak:            if(n >0)   add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type, "60"),
zpos_util.c.bak:                                         pub_data_stru->route_msg_type, 2, "11", 1);
zpos_util.c.bak:            else if(n==0) add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type, "60"),
zpos_util.c.bak:                                            pub_data_stru->route_msg_type, 2, "10", 1);
zpos_util.c.bak:            add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"62"),
zpos_util.c.bak:                          pub_data_stru->route_msg_type, n+1, buf, 1);
zpos_util.c.bak:            if(n >0) add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type, "60"),
zpos_util.c.bak:                                       pub_data_stru->route_msg_type, 2, "21", 1);
zpos_util.c.bak:            else if(n==0) add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type, "60"),
zpos_util.c.bak:                                            pub_data_stru->route_msg_type, 2, "20", 1);
zpos_util.c.bak:    snprintf(pub_data_stru->route_msg_type,5,"%s",pub_data_stru->in_msg_type);
zpos_util.c.bak:    snprintf(pub_data_stru->route_insti_code,9,"%s",pub_data_stru->insti_code);
zpos_util.c.bak:    snprintf(pub_data_stru->route_fold_name,40,"%s",pub_data_stru->insti_fold_name);
zpos_util.c.bak:    snprintf(pub_data_stru->route_trans_type,5,"%s",pub_data_stru->in_trans_type);
zpos_util.c.bak:    pub_data_stru->tmp_order[0]=0x30;
zpos_util.c.bak:    n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "20"),
zpos_util.c.bak:                          pub_data_stru->in_msg_type,psam,17);
zpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c.bak:    n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "60"),
zpos_util.c.bak:                          pub_data_stru->in_msg_type,tmp,sizeof(tmp));
zpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c.bak:        n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type, "39"),
zpos_util.c.bak:                              pub_data_stru->in_msg_type,tmp,sizeof(tmp));
zpos_util.c.bak:                add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"62"),
zpos_util.c.bak:                              pub_data_stru->route_msg_type, n+1, tmp, 1);
zpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"96");
zpos_util.c.bak:    if(n >=0) strcpy(pub_data_stru->center_result_code,"00");
zpos_util.c.bak:    else strcpy(pub_data_stru->center_result_code,"96");
zpos_util.c.bak:    if(!pub_data_stru->switch_src_flag) return 1;
zpos_util.c.bak:    if(memcmp(pub_data_stru->center_result_code, "00000", strlen(pub_data_stru->center_result_code))) {
zpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c.bak:    return add_pub_field(pub_data_stru,fldid, pub_data_stru->route_msg_type,
zpos_util.c.bak:	                              pub_data_stru->in_msg_type,
zpos_util.c.bak:    if((n=get_field_data_safe(pub_data_stru,get_pub_field_id(pub_data_stru->in_msg_type,"36"),
zpos_util.c.bak:                              pub_data_stru->in_msg_type,tmp,sizeof(tmp)))>0) {
zpos_util.c.bak:        i=DecTrackPrg(return_code, pub_data_stru->in_data_index, pub_data_stru->in_data_key, n, tmp, &outlen, tmp);
zpos_util.c.bak:                strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c.bak:                add_pub_field(pub_data_stru, FIELD_TRACK2,pub_data_stru->route_msg_type,n,tmp1+2,1);
zpos_util.c.bak:                    add_pub_field(pub_data_stru, 60, pub_data_stru->route_msg_type, 15, "000005200900000", 1);
zpos_util.c.bak:                    add_pub_field(pub_data_stru, 60, pub_data_stru->route_msg_type, 15, "000005000900000", 1);
zpos_util.c.bak:                add_pub_field(pub_data_stru, 60, pub_data_stru->route_msg_type, 15, "000005000900000", 1);
zpos_util.c.bak:                add_pub_field(pub_data_stru, FIELD_CARD_NO, pub_data_stru->route_msg_type,
zpos_util.c.bak:                    strcpy(pub_data_stru->center_result_code,"30");
zpos_util.c.bak:                add_pub_field(pub_data_stru,FIELD_TRACK3,pub_data_stru->route_msg_type,i,tmp1+2+3+n,1);
zpos_util.c.bak:            del_pub_field(pub_data_stru,FIELD_TRACK3,pub_data_stru->in_msg_type,0);
zpos_util.c.bak:            strcpy(pub_data_stru->center_result_code,"91");
zpos_util.c.bak:        add_pub_field(pub_data_stru, 60, pub_data_stru->route_msg_type, 15, "000000000300000", 1);
zpos_util.c.bak:                           DB_MSG_TYPE,psam, pub_data_stru->route_num == 0 ? 0 : 1,17);
zpos_util.c.bak:    return tpos_get_work_key(psam,pub_data_stru->route_pin_index,pub_data_stru->route_mac_index,pub_data_stru->route_data_index,pub_data_stru->route_pin_key,pub_data_stru->route_mac_key,pub_data_stru->route_data_key);
zpos_util.c.bak:    snprintf(pub_data_stru->route_msg_type,5,"%s",pub_data_stru->in_msg_type);
zpos_util.c.bak:    snprintf(pub_data_stru->route_insti_code,9,"%s",pub_data_stru->insti_code);
zpos_util.c.bak:    snprintf(pub_data_stru->route_fold_name,40,"%s",pub_data_stru->insti_fold_name);
zpos_util.c.bak:    snprintf(pub_data_stru->route_trans_type,5,"%s",pub_data_stru->in_trans_type);
zpos_util.c.bak:    pub_data_stru->tmp_order[0]=0x30;
zpos_util.c.bak:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"DATE"),
zpos_util.c.bak:                  pub_data_stru->route_msg_type,8,tmp,1);
zpos_util.c.bak:    add_pub_field(pub_data_stru,get_pub_field_id(pub_data_stru->route_msg_type,"TIME"),
zpos_util.c.bak:                  pub_data_stru->route_msg_type,6,tmp+8,1);
zpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"96");
zpos_util.c.bak:        strcpy(pub_data_stru->center_result_code,"00");
